<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>网络服务 | Dragon's Blog</title><meta name="keywords" content="服务运维"><meta name="author" content="Dragon"><meta name="copyright" content="Dragon"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="网络服务网络服务概述OpenStack网络服务为OpenStack环境中的虚拟网络基础架构（VNI）和物理网络接触架构接入层方面（PNI）管理所有的网络现状。OpenStack网络允许租户创建高级的虚拟网络拓扑，包括firewalls、load balancers和virtual private networks（VPNs)等服务。 网络提供了以下对象抽象：网络、子网和路由器。每一个都有模仿其">
<meta property="og:type" content="article">
<meta property="og:title" content="网络服务">
<meta property="og:url" content="https://github.com/HKingDragon/hkingdragon.github.io/2022/06/07/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1/index.html">
<meta property="og:site_name" content="Dragon&#39;s Blog">
<meta property="og:description" content="网络服务网络服务概述OpenStack网络服务为OpenStack环境中的虚拟网络基础架构（VNI）和物理网络接触架构接入层方面（PNI）管理所有的网络现状。OpenStack网络允许租户创建高级的虚拟网络拓扑，包括firewalls、load balancers和virtual private networks（VPNs)等服务。 网络提供了以下对象抽象：网络、子网和路由器。每一个都有模仿其">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2022/04/26/8YVJyX1nmaQuhrB.jpg">
<meta property="article:published_time" content="2022-06-07T08:08:11.000Z">
<meta property="article:modified_time" content="2022-06-07T11:51:33.328Z">
<meta property="article:author" content="Dragon">
<meta property="article:tag" content="服务运维">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2022/04/26/8YVJyX1nmaQuhrB.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://github.com/HKingDragon/hkingdragon.github.io/2022/06/07/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Dragon","link":"链接: ","source":"来源: Dragon's Blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '网络服务',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-06-07 19:51:33'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.1.0"><link rel="alternate" href="/atom.xml" title="Dragon's Blog" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fww2.sinaimg.cn%2Flarge%2Fc1608aa0gw1euctw87ul7g20b40b4mzl.gif&amp;refer=http%3A%2F%2Fwww.sina.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1653544265&amp;t=ac0fd90b3540bb1abf4de1135021b748" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">18</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Dragon's Blog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">网络服务</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-06-07T08:08:11.000Z" title="发表于 2022-06-07 16:08:11">2022-06-07</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-06-07T11:51:33.328Z" title="更新于 2022-06-07 19:51:33">2022-06-07</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/OpenStack/">OpenStack</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>25分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="网络服务"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div><article class="post-content" id="article-container"><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="https://music.163.com/outchain/player?type=2&id=1947948874&auto=1&height=66"></iframe>

<h1 id="网络服务"><a href="#网络服务" class="headerlink" title="网络服务"></a>网络服务</h1><h2 id="网络服务概述"><a href="#网络服务概述" class="headerlink" title="网络服务概述"></a>网络服务概述</h2><p>OpenStack网络服务为OpenStack环境中的虚拟网络基础架构（VNI）和物理网络接触架构接入层方面（PNI）管理所有的网络现状。OpenStack网络允许租户创建高级的虚拟网络拓扑，包括firewalls、load balancers和virtual private networks（VPNs)等服务。</p>
<p>网络提供了以下对象抽象：网络、子网和路由器。每一个都有模仿其物理副本的功能：网络包含子网，路由器在不同的子网和网络之间进行路由通信。</p>
<p>Neutron 网络服务为 OpenStack 管理所有的网络方面的虚拟网络基础设施（Virtual  Networking Infrastructure，VNI）和访问层方面的物理网络基础设施（Physical Networking  Infrastructure，PNI）。在 OpenStack 中，计算、存储和网络是其核心内容，也是核心组件， 通过具体的功能实现和服务的访问，以实现提供于计算环境下的虚拟网络功能。Neutron 为 OpenStack 的虚拟机提供网络方面的功能；在 Havana 版本目前是没有 neutron 这个组件（G 版名称是 Quantum）的，当时网络的主要功能是在 Nova 组件里实现 的，即 Nova-network，底层采用的大多是 Linux bridge，但是无法快速组网和实现高级的网 络功能，因此 OpenStack 把 Nova 的关于网络方面的功能进行转移，成立了全新的 Neutron 组件，Neutron 组件取代了 Nova-network 的相关功能，但是 Nova 里还有些网络功能被保留，比如虚拟机的网卡方面的功能。在 OpenStack 中，网络功能是最复杂的功能，很多计算和存储方面的问题都是和网络紧密相关的。</p>
<p><img src="https://s2.loli.net/2022/06/07/lg89RFYp1LakZtS.png" alt="image-20220607180408348"></p>
<p>OpenStack 网络允许租户创建先迚的虚拟网络拓扑结构，包括服务，如防火墙、负载平 衡器和虚拟私有网络（VPN）。网络提供了以下对象抽象：网络、子网和路由器。每个都包 含它所模仿物理硬件对应的功能：网络包含子网，不同的子网和网络之间的流量由路由来 传递。</p>
<h2 id="网络服务架构介绍"><a href="#网络服务架构介绍" class="headerlink" title="网络服务架构介绍"></a>网络服务架构介绍</h2><p>Neutron 网络目的是灵活地划分物理网络，在多租户环境下提供给每个租户独立的网络 环境。它是可以被用户创建的对象，如果要和物理环境下的概念映射的话，这个对象相当 亍一个巨大的交换机，可以拥有无限多个劢态可创建和销毁的虚拟端口。</p>
<p>用户通过 OpenStack 的 Horizon GUI 不网络功能迚 行交亏，而其他的管理系统和网络则通过使用 Neutron API 不网络服务进行交互。在目前的 分布中，OpenStack Neutron 混合实施了第二层的 VLAN 和第三层的路由服务，它可为所支 持的网络提供防火墙、负载平衡以及 IPSec VPN 等扩展功能。</p>
<p>网络中的虚拟机来自亍虚拟机管理程序，其中包括 KVM、ESX、XenServer 和 Hyper-V， 它支持设计中的选择和多功能性。</p>
<p>Neutron 组 件可以分为 5 个主要子服务，分别为 neutron-server、neutron-openvswitch-agent、dhcp-aget、 l3-agent 和 metadata-agen</p>
<ul>
<li><p>Neutron Server</p>
<p>实现Neutron API和API扩展、管理Network、subnet、port</p>
</li>
<li><p>Neutron-openvswitch-agent</p>
<p>连接虚拟机到网络端口，运行在每个计算节点。</p>
</li>
<li><p>DHCP agent</p>
<p>负责DHCP配置，为虚拟机分配IP</p>
</li>
<li><p>L3-agent</p>
<p>负责公网浮动IP地址和NAT,负责其他三层特性，例如负载均衡，每个network对应一个L3 agent</p>
</li>
<li><p>Metadata-agent</p>
<p>提供元数据服务，Neutron的I3-agent、dhcp-agent、nova、metadata api server</p>
</li>
</ul>
<p>一个标准的Neutorn网络是有Network、Subnet、Router和port组成</p>
<ul>
<li><p>Network</p>
<p>二层网络单元，租户可以通过Neutron的API创建自己的网络，类似vlan的三层接口，接口则对应为二层的一个单独的隔离网络</p>
</li>
<li><p>Subnet</p>
<p>一段IPv4&#x2F;IPv6地址段，提供公网或者私网的地址，相当于在Network的基础上，二层的单独隔离网路，VM同属于一个IP端，具有同样二点网络掩码，具备相同的网络网关。</p>
</li>
<li><p>router</p>
<p>虚拟三层路由器，为私网地址提供地址转换</p>
</li>
<li><p>port</p>
<p>管理实例的网卡，虚拟机交换机的一个接口</p>
</li>
</ul>
<p>同时在 Neutron 配置文件中有 2 种不同的 Plugin，分别为 core_plugin 和 service_plugins， 其中 core_plugin 为实现二层网络中网络之间隔离和亏通，默认配置为 ml2（Modular Layer  2）；service_plugins 则提供三层及三层以上的服务，如 Router、FWaas、LBaas 和 VPNaas。</p>
<p>在 Neutron 网络拓扑中可以有 FLAT、Local、VLAN、GRE 和 VXLAN 网络模式。 Mechanism_Drivers 主要是靠 Core Plugin 来实现，直接管理底层网络和实现底层网络的隔 离。目前支持的主要有 OpenvSwitch 和 LinuxBridge 等。现在看来，ML2 的出现在网络的 可靠性以及性能方面都有显著的提高。Service_Plugin 则是对三层以上提供更高级的服务。</p>
<h2 id="底层网络"><a href="#底层网络" class="headerlink" title="底层网络"></a>底层网络</h2><p>二层到七层网络的虚拟化：L2（virtual switch）、L3（virtual Router 和 LB）、L4-7（virtual  Firewall）等。网络连通性：二层网络和三层网络、租户隔离性、网络安全性、网络扩展性、 REST API 及更高级的服务，包括 LBaaS、FWaaS、VPNaaS 等。</p>
<p>网络提供：主要提供一个隔离的二层网段，在二层网段中，内部存在一个自身内部租 户创建产生的广播域戒者对外提供的共享标记。在创建网络时，需要加上创建用户的权限， 可以分为 Provider network 和 Tenant Network 两种。</p>
<p>在租户网络（Tenant Network）中，网络均是由租户的普通用户创建，默认情况下租户 是不能创建共享的网络的，所以要保证租户之间的网络隔离，不被其他租户収现和使用。 在 tenant network 中也有 local、flat、vlan、gre 和 VXLAN 等类型。但是，tenant 普通用户 创建的 Flat 和 VLAN 的 tenant network 实际还是 Provider network（属于某一个实际物理网 段），所以真正产生 Tenant network 的为 GRE 和 VXLAN，这种和物理网络没有任何的联系。</p>
<p>Provider network 与 Tenant Network 有以下几点区别。</p>
<p>（1）Provider network 是由 admin 用户创建的，而 Tenant network 是由 tenant 普通用户 创建的。 </p>
<p>（2）Provider network 和物理网络的某段直接映射，比如对应某个 VLAN，需要预先在 物理网络中做相应的配置。而 tenant network 是虚拟化的网络，Neutron 需要负责其路由等 三层功能。 </p>
<p>（3）对 Flat 和 VLAN 类型的网络来说，只有 Provider network 才有意义。即使是这种 类型的 tenant network，其本质上也是对应一个实际的物理段。 </p>
<p>（4）对 GRE 和 VXLAN 类型的网络来说，只有 tenant network 才有意义，因为它本身 不依赖于具体的物理网络，只是需要物理网络提供 IP 和组播即可。 </p>
<p>（5）Provider network 根据 admin 用户输入的物理网络参数创建；而 tenant work 由 tenant普通用户创建，Neutron 根据其网络配置来选择具体的配置，包括网络类型、物理网络和 segmentation_id</p>
<p>（6）创建 Provider network 时允许使用丌在配置项范围内的 segmentation_id。</p>
<p><img src="https://s2.loli.net/2022/06/07/WFTflySLtxKA7pJ.png" alt="image-20220607182127106"></p>
<p>在一个实际的生产环境中，Neutron 的网络可以分为以下几种：实例通信网络、内部存储网络、内部管理网络和实例私有网络。</p>
<p>实例通信网络为外部通信网络；内部管理网络即 OpenStack 自身组件所使用的网络， 通常为管理组件之间通信所使用的网络；实例私有网络为虚拟机使用的内部网络；内部存储网络为存储服务器之间的通信网络，负责数据之间的数据交换和数据备份</p>
<p><img src="https://s2.loli.net/2022/06/07/LTHKWqhoXQb4VaY.png" alt="image-20220607182254549"></p>
<h2 id="Neutron网络模式"><a href="#Neutron网络模式" class="headerlink" title="Neutron网络模式"></a>Neutron网络模式</h2><p>FlatDHCP 模式通常指定一个子网，规定虚拟机能使用的 IP 地址范围，创建实例时从 有效 IP 地址池获叏一个 IP，分配给虚拟机实例，自劢配置好网桥、通过 DNSmasq 分配地址</p>
<p><img src="https://s2.loli.net/2022/06/07/WY8sacz9kmZRlwK.png" alt="image-20220607182416374"></p>
<p>VLAN 模式需要创建租户 VLAN，使得租户之间二层网络隔离，并自劢创建网桥，在 网络控制器上的 DHCP 为所有的 VLAN 启劢，为每个虚拟机分配私网地址（DNSmasq）， 网络控制器 NAT 转换，也解决二层隔离问题，适合私有云使用</p>
<p><img src="https://s2.loli.net/2022/06/07/ot8r9Dk43vHaYg2.png" alt="image-20220607182424500"></p>
<p>GRE 网络可以跨不同网络实现二次 IP 通 信，而且通信封装在 IP 报文中，实现点对点隧道</p>
<p><img src="https://s2.loli.net/2022/06/07/yBOVEHADgGRMQF8.png" alt="image-20220607182451254"></p>
<h2 id="数据包接受"><a href="#数据包接受" class="headerlink" title="数据包接受"></a>数据包接受</h2><p>在 Linux 网络系统中，部分网卡都是自带端口自协商的功能，设备双方通过这样的方 式建立合适的数据连接，包括连接速度和连接的方式。在数据接收方面，将数据内容放置 程序缓存部分，而后进行中断方式通知 CPU&#x2F;CPU 轮询读取数据帧；在数据发送方面，是 以软中断方式传递给发包队列，而后匹配驱劢才能让 CPU 控制使用网卡设备将数据发送出去。</p>
<p>网卡模式主要以下几种</p>
<ul>
<li><p>直接模式</p>
<p>只接收目的MAC是网卡自己的数据帧</p>
</li>
<li><p>组播模式</p>
<p>接受所有的组播报文数据帧</p>
</li>
<li><p>广播模式</p>
<p>接受广播帧</p>
</li>
<li><p>混杂模式</p>
<p>可以接收所有任意目的MAC报文、无论报文的目的和MAC是否是身的网卡MAC地址、单播或者非单播</p>
</li>
</ul>
<h2 id="Linux-Bridge-和-VLAN"><a href="#Linux-Bridge-和-VLAN" class="headerlink" title="Linux Bridge 和 VLAN"></a>Linux Bridge 和 VLAN</h2><p>Linux Bridge模拟了物理网络中的网桥的概念，将多个服务器端口加入到网桥中来，网桥端口对端相连的设备通过发送报文给Linux Bridge，并通过Linux Bridge学习报文SMAC和查找报文的DMAC转发到相应的目的地&#x2F;它既可以是物理网卡设备也可以是虚拟的端口。</p>
<p>Linux Bridge 本身是没有 VLAN 功能的，需要 VLAN 模块协作实现 VLAN 过滤的功能， 当端口加入到 Linux Bridge 中，默认是不属亍任何 VLAN 或者属于所有 VLAN 的，只有这 样才能对所有的 VLAN 的报文进行接收和转发，和普通的交换机的 trunk 口还是有区别的， 交换机的 trunk 是针对 VLAN 的端口属性，需要自己配置 VLAN 才能转发报文通过；Linux  Bridge 没有配置 VLAN 端口就会让所有的报文通过。</p>
<p>Linux Bridge 在 OpenStack 的于计算网路中也是有着非常重要和广泛的应用， nova-network就用Linux Bridge和Vlan做租户隔离，即使后面的Neutron组建在OpenvSwitch 做了 Plugin 时也大量用到了 Linux Bridge 和 VLAN。</p>
<h2 id="OpenvSwitch说明"><a href="#OpenvSwitch说明" class="headerlink" title="OpenvSwitch说明"></a>OpenvSwitch说明</h2><p>OpenvSwitch 是开源 Apache 2.0 的高质量多层次虚拟交换机软件，在某一个虚拟化的 环境中，vSwitch 的主要功能：传递 VM 之间的流量、实现 VM 和外界网络通信。最初的 虚拟机之间的隔离使用了 Nova-network，底层采用的是 Linux Bridge 技术，虚拟机网络的 组建和配置非常不灵活而且配置无法模块化，扩展非常困难，对于运维来说对错误定位也 有一定的难度，OpenvSwitch就是为了解决以上问题而出现的，支持QoS、镜像功能和netflow 功能等。OpenvSwitch 支持 vlan、vxlan 和 gre 等多种隔离方式，同时支持 OpenFlow 协议， 在后续的 SDN 技术可以延续对其管理。</p>
<h2 id="NameSpace方案"><a href="#NameSpace方案" class="headerlink" title="NameSpace方案"></a>NameSpace方案</h2><p>Linux 系统中的 namespace 称之为 container，是一种资源隔离方案，是基于容器的虚拟化技术的基础，和 C++里面的 namespace 非常类似，所以 namespace 是属亍 Linux 系统层 次资源管理和使用的技术内容，不属于网络部分的概念。</p>
<p>namespace特点</p>
<ul>
<li>在不同的namespace中资源是隔离的，信息传递只能通过网络来完成</li>
<li>部署namespace开销小，部署迅速，但是这对内核开发来说是难事</li>
<li>与其他的虚拟化技术和云计算平台相比，不能指定任意想要的操作系统并部署想要的操作软件</li>
</ul>
<h2 id="Linux-namespace的常见命令"><a href="#Linux-namespace的常见命令" class="headerlink" title="Linux namespace的常见命令"></a>Linux namespace的常见命令</h2><h3 id="显示信息，包括路由和DHCP信息"><a href="#显示信息，包括路由和DHCP信息" class="headerlink" title="显示信息，包括路由和DHCP信息"></a>显示信息，包括路由和DHCP信息</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ip netns list</span><br><span class="line">qrouter-cb43f096-5caa-4a0e-9da2-d5eba21e0d7e</span><br><span class="line">qdhcp-9c3e5199-fcaa-4eb5-80e9-94359c9a6322</span><br><span class="line">qdhcp-0bd656ba-df93-4768-b2fd-a5a499611568</span><br></pre></td></tr></table></figure>

<h3 id="显示某一个namcspace内部的信息"><a href="#显示某一个namcspace内部的信息" class="headerlink" title="显示某一个namcspace内部的信息"></a>显示某一个namcspace内部的信息</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">ip netns exec ip netns exec qdhcp-9c3e5199-fcaa-4eb5-80e9-94359c9a6322 ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN </span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">10: tap564c510c-f7: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1458 qdisc noqueue state UNKNOWN </span><br><span class="line">    link/ether fa:16:3e:b1:3c:97 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.10.0.2/24 brd 10.10.0.255 scope global tap564c510c-f7</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet 169.254.169.254/16 brd 169.254.255.255 scope global tap564c510c-f7</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::f816:3eff:feb1:3c97/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN </span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">10: tap564c510c-f7: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1458 qdisc noqueue state UNKNOWN </span><br><span class="line">    link/ether fa:16:3e:b1:3c:97 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.10.0.2/24 brd 10.10.0.255 scope global tap564c510c-f7</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet 169.254.169.254/16 brd 169.254.255.255 scope global tap564c510c-f7</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::f816:3eff:feb1:3c97/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<h3 id="查看防火墙信息"><a href="#查看防火墙信息" class="headerlink" title="查看防火墙信息"></a>查看防火墙信息</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">ip netns exec qdhcp-9c3e5199-fcaa-4eb5-80e9-94359c9a6322 iptables -nL</span><br><span class="line">Chain INPUT (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">neutron-dhcp-age-INPUT  all  --  0.0.0.0/0            0.0.0.0/0           </span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">neutron-filter-top  all  --  0.0.0.0/0            0.0.0.0/0           </span><br><span class="line">neutron-dhcp-age-FORWARD  all  --  0.0.0.0/0            0.0.0.0/0           </span><br><span class="line"></span><br><span class="line">Chain OUTPUT (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">neutron-filter-top  all  --  0.0.0.0/0            0.0.0.0/0           </span><br><span class="line">neutron-dhcp-age-OUTPUT  all  --  0.0.0.0/0            0.0.0.0/0           </span><br><span class="line"></span><br><span class="line">Chain neutron-dhcp-age-FORWARD (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">neutron-dhcp-age-scope  all  --  0.0.0.0/0            0.0.0.0/0           </span><br><span class="line"></span><br><span class="line">Chain neutron-dhcp-age-INPUT (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain neutron-dhcp-age-OUTPUT (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain neutron-dhcp-age-local (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain neutron-dhcp-age-scope (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain neutron-filter-top (2 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">neutron-dhcp-age-local  all  --  0.0.0.0/0            0.0.0.0/0       </span><br></pre></td></tr></table></figure>

<h2 id="创建测试NameSpace网桥"><a href="#创建测试NameSpace网桥" class="headerlink" title="创建测试NameSpace网桥"></a>创建测试NameSpace网桥</h2><h3 id="创建namespace1和namespace2命名空间"><a href="#创建namespace1和namespace2命名空间" class="headerlink" title="创建namespace1和namespace2命名空间"></a>创建namespace1和namespace2命名空间</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ip netns add namespace1</span><br><span class="line">ip netns add namespace2 </span><br></pre></td></tr></table></figure>

<h3 id="创建br-ns网桥"><a href="#创建br-ns网桥" class="headerlink" title="创建br-ns网桥"></a>创建br-ns网桥</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ovs-vsctl add-br br-ns</span><br></pre></td></tr></table></figure>

<h3 id="创建内部通信端口"><a href="#创建内部通信端口" class="headerlink" title="创建内部通信端口"></a>创建内部通信端口</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ovs-vsctl add-port br-ns tap1 --set interface tap1 type=internal</span><br><span class="line">ovs-vsctl add-port br-ns tap2 --set interface tap2 type=internal</span><br></pre></td></tr></table></figure>

<h3 id="将tap1和tap2分别加入命名空间"><a href="#将tap1和tap2分别加入命名空间" class="headerlink" title="将tap1和tap2分别加入命名空间"></a>将tap1和tap2分别加入命名空间</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ip link set tap1 netns namespace1</span><br><span class="line">ip link set tap2 netns namespace2</span><br></pre></td></tr></table></figure>

<h3 id="配置命名空间地址"><a href="#配置命名空间地址" class="headerlink" title="配置命名空间地址"></a>配置命名空间地址</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ip netns exec namespace1 ip addr add 192.168.0.10/24 dev tap1</span><br><span class="line">ip netns exec namespace1 ip link set tap1 up</span><br><span class="line">ip netns exec namespace1 ip link set lo up</span><br><span class="line">ip netns exec namespace2 ip addr add 192.168.0.20/24 dev tap2</span><br><span class="line">ip netns exec namespace2 ip link set tap2 up</span><br><span class="line">ip netns exec namespace  ip link set lo up</span><br></pre></td></tr></table></figure>

<h3 id="检测网络畅通"><a href="#检测网络畅通" class="headerlink" title="检测网络畅通"></a>检测网络畅通</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ip netns exec namespace1 ping 192.168.0.10</span><br><span class="line">ip netns exec namespace2 ping 192.168.0.20</span><br><span class="line">ip netns exec namespace1 ping 192.168.0.20</span><br><span class="line">ip netns exec namespace2 ping 192.168.0.10</span><br></pre></td></tr></table></figure>

<h3 id="完成创建ovs输出并查看"><a href="#完成创建ovs输出并查看" class="headerlink" title="完成创建ovs输出并查看"></a>完成创建ovs输出并查看</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">ovs-vsctl show</span><br><span class="line">2a432603-817d-449e-924d-c49759a2bb74</span><br><span class="line">    Bridge br-int</span><br><span class="line">        fail_mode: secure</span><br><span class="line">        Port &quot;qr-a73f8574-50&quot;</span><br><span class="line">            tag: 3</span><br><span class="line">            Interface &quot;qr-a73f8574-50&quot;</span><br><span class="line">                type: internal</span><br><span class="line">        Port &quot;tap9de217cb-49&quot;</span><br><span class="line">            tag: 2</span><br><span class="line">            Interface &quot;tap9de217cb-49&quot;</span><br><span class="line">                type: internal</span><br><span class="line">        Port br-int</span><br><span class="line">            Interface br-int</span><br><span class="line">                type: internal</span><br><span class="line">        Port &quot;tap564c510c-f7&quot;</span><br><span class="line">            tag: 3</span><br><span class="line">            Interface &quot;tap564c510c-f7&quot;</span><br><span class="line">                type: internal</span><br><span class="line">        Port patch-tun</span><br><span class="line">            Interface patch-tun</span><br><span class="line">                type: patch</span><br><span class="line">                options: &#123;peer=patch-int&#125;</span><br><span class="line">        Port int-br-ex</span><br><span class="line">            Interface int-br-ex</span><br><span class="line">                type: patch</span><br><span class="line">                options: &#123;peer=phy-br-ex&#125;</span><br><span class="line">    Bridge br-tun</span><br><span class="line">        fail_mode: secure</span><br><span class="line">        Port patch-int</span><br><span class="line">            Interface patch-int</span><br><span class="line">                type: patch</span><br><span class="line">                options: &#123;peer=patch-tun&#125;</span><br><span class="line">        Port &quot;gre-c0a80a14&quot;</span><br><span class="line">            Interface &quot;gre-c0a80a14&quot;</span><br><span class="line">                type: gre</span><br><span class="line">                options: &#123;df_default=&quot;true&quot;, in_key=flow, local_ip=&quot;192.168.10.10&quot;, out_key=flow, remote_ip=&quot;192.168.10.20&quot;&#125;</span><br><span class="line">        Port br-tun</span><br><span class="line">            Interface br-tun</span><br><span class="line">                type: internal</span><br><span class="line">    Bridge br-ex</span><br><span class="line">        Port br-ex</span><br><span class="line">            Interface br-ex</span><br><span class="line">                type: internal</span><br><span class="line">        Port phy-br-ex</span><br><span class="line">            Interface phy-br-ex</span><br><span class="line">                type: patch</span><br><span class="line">                options: &#123;peer=int-br-ex&#125;</span><br><span class="line">        Port &quot;qg-0f03b8f4-f3&quot;</span><br><span class="line">            Interface &quot;qg-0f03b8f4-f3&quot;</span><br><span class="line">                type: internal</span><br><span class="line">        Port &quot;eno33554960&quot;</span><br><span class="line">            Interface &quot;eno33554960&quot;</span><br><span class="line">    Bridge br-ns</span><br><span class="line">        Port &quot;tap1&quot;</span><br><span class="line">            Interface &quot;tap1&quot;</span><br><span class="line">                type: internal</span><br><span class="line">        Port &quot;tap2&quot;</span><br><span class="line">            Interface &quot;tap2&quot;</span><br><span class="line">                type: internal</span><br><span class="line">        Port br-ns</span><br><span class="line">            Interface br-ns</span><br><span class="line">                type: internal</span><br><span class="line">    ovs_version: &quot;2.5.0&quot;</span><br></pre></td></tr></table></figure>

<h3 id="查看namespace命令"><a href="#查看namespace命令" class="headerlink" title="查看namespace命令"></a>查看namespace命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ip netns list</span><br><span class="line">namespace2</span><br><span class="line">namespace1</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="查看某个namespace的地址"><a href="#查看某个namespace的地址" class="headerlink" title="查看某个namespace的地址"></a>查看某个namespace的地址</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">ip netns exec namespace1 ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN </span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">14: tap1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UNKNOWN </span><br><span class="line">    link/ether 1a:55:29:85:37:c3 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.0.10/24 scope global tap1</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::1855:29ff:fe85:37c3/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">       </span><br><span class="line">       </span><br><span class="line">ip netns exec namespace2 ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN </span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">15: tap2: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UNKNOWN </span><br><span class="line">    link/ether 82:7e:c0:1d:ff:58 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.0.20/24 scope global tap2</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::807e:c0ff:fe1d:ff58/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="DNSmasq工具"><a href="#DNSmasq工具" class="headerlink" title="DNSmasq工具"></a>DNSmasq工具</h2><p>DNSmasq 是一个小巧丏方便地用亍配置 DNS 和 DHCP 的工具，适用于小型网络，它 提供了 DNS 功能和可选择的 DHCP 功能。它服务那些只在本地适用的域名，这些域名是 不会在全球的 DNS 服务器中出现的。DHCP 服务器和 DNS 服务器结合，并且允许 DHCP 分配的地址能在 DNS 中正常解析，而这些 DHCP 分配的地址和相关命令可以配置到每台 主机中，也可以配置到一台核心设备中（比如路由器），DNSmasq 支持静态和东态两种 DHCP 配置方式。</p>
<h3 id="查看已经启动的dnsmasq进程命令"><a href="#查看已经启动的dnsmasq进程命令" class="headerlink" title="查看已经启动的dnsmasq进程命令"></a>查看已经启动的dnsmasq进程命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep dnsmasq</span><br><span class="line">nobody    24861  0.0  0.0  15548   448 ?        S    01:26   0:00 dnsmasq --no-hosts --no-resolv --strict-order --except-interface=lo --pid-file=/var/lib/neutron/dhcp/0bd656ba-df93-4768-b2fd-a5a499611568/pid --dhcp-hostsfile=/var/lib/neutron/dhcp/0bd656ba-df93-4768-b2fd-a5a499611568/host --addn-hosts=/var/lib/neutron/dhcp/0bd656ba-df93-4768-b2fd-a5a499611568/addn_hosts --dhcp-optsfile=/var/lib/neutron/dhcp/0bd656ba-df93-4768-b2fd-a5a499611568/opts --dhcp-leasefile=/var/lib/neutron/dhcp/0bd656ba-df93-4768-b2fd-a5a499611568/leases --dhcp-match=set:ipxe,175 --bind-interfaces --interface=tap9de217cb-49 --dhcp-range=set:tag0,192.168.20.0,static,86400s --dhcp-option-force=option:mtu,1458 --dhcp-lease-max=256 --conf-file= --domain=openstacklocal</span><br><span class="line">nobody    24982  0.0  0.0  15548   408 ?        S    01:27   0:00 dnsmasq --no-hosts --no-resolv --strict-order --except-interface=lo --pid-file=/var/lib/neutron/dhcp/9c3e5199-fcaa-4eb5-80e9-94359c9a6322/pid --dhcp-hostsfile=/var/lib/neutron/dhcp/9c3e5199-fcaa-4eb5-80e9-94359c9a6322/host --addn-hosts=/var/lib/neutron/dhcp/9c3e5199-fcaa-4eb5-80e9-94359c9a6322/addn_hosts --dhcp-optsfile=/var/lib/neutron/dhcp/9c3e5199-fcaa-4eb5-80e9-94359c9a6322/opts --dhcp-leasefile=/var/lib/neutron/dhcp/9c3e5199-fcaa-4eb5-80e9-94359c9a6322/leases --dhcp-match=set:ipxe,175 --bind-interfaces --interface=tap564c510c-f7 --dhcp-range=set:tag0,10.10.0.0,static,86400s --dhcp-option-force=option:mtu,1458 --dhcp-lease-max=256 --conf-file= --domain=openstacklocal</span><br><span class="line">root      54036  0.0  0.0 112664   956 pts/0    S+   08:24   0:00 grep --color=auto dnsmasq</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>通过上面的结果可以看出，它的主要作用是为虚拟机分配 IP 地址，即每一个 DNSmasq 进程提供一个 DHCP 服务，同样的每启动一个这样的 DHCP 进程，同样保存在网络节点的 &#x2F;var&#x2F;lib&#x2F;neutron&#x2F;dhcp&#x2F;目录内部，而实例对应的 MAC 和分配的 IP 则对应在网络 ID 内的 hosts 文件内。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ls -l /var/lib/neutron/dhcp</span><br><span class="line">总用量 0</span><br><span class="line">drwxr-xr-x. 2 neutron neutron 84 5月  25 01:26 0bd656ba-df93-4768-b2fd-a5a499611568</span><br><span class="line">drwxr-xr-x. 2 neutron neutron 84 5月  25 01:29 9c3e5199-fcaa-4eb5-80e9-94359c9a6322</span><br><span class="line">cat /var/lib/neutron/dhcp/0bd656ba-df93-4768-b2fd-a5a499611568/host </span><br><span class="line">fa:16:3e:ef:b7:bc,host-192-168-20-1.openstacklocal,192.168.20.1</span><br><span class="line">cat /var/lib/neutron/dhcp/9c3e5199-fcaa-4eb5-80e9-94359c9a6322/host </span><br><span class="line">fa:16:3e:b1:3c:97,host-10-10-0-2.openstacklocal,10.10.0.2</span><br><span class="line">fa:16:3e:33:ac:6a,host-10-10-0-1.openstacklocal,10.10.0.1</span><br><span class="line">fa:16:3e:ee:df:0b,host-10-10-0-3.openstacklocal,10.10.0.3</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Neutron-网络拓扑"><a href="#Neutron-网络拓扑" class="headerlink" title="Neutron 网络拓扑"></a>Neutron 网络拓扑</h2><p>多平面网络，存在实例网络和外部通信网络同为一个网络，但同时又可以共享多个网络，当两个虚拟机需要相互通信时，虚拟机内部可以通过多个网卡同时共享一个物理网段。</p>
<p><img src="https://s2.loli.net/2022/06/07/1p38Q64AD9iGnOF.png" alt="image-20220607190444754"></p>
<p>混合平面私有网络，是指每个 Tenant 拥有租户自己的实例网络，同时共享一个相同的共享实例外部网络。</p>
<p><img src="https://s2.loli.net/2022/06/07/XWr7iJbplVsPSxy.png" alt="image-20220607190506780"></p>
<p>私有网络实现运营商路由功能。通过虚拟路由功能，连接多个租户内部实例网络，同 时可以直接通过路由提供的 SNAT 功能访问外部网络</p>
<p><img src="https://s2.loli.net/2022/06/07/MsYAaWbdOEIox5Z.png" alt="image-20220607190742755"></p>
<p>通过私有网络实现每个租户创建自己与属的网络区段。每个租户对应租户路由设备， 实现每个租户创建自己的与属网络环境，每个网络连接自己与属的虚拟路由器，满足访问 外部网络</p>
<p><img src="C:/Users/HJL/AppData/Roaming/Typora/typora-user-images/image-20220607190750852.png" alt="image-20220607190750852"></p>
<h2 id="基础操作"><a href="#基础操作" class="headerlink" title="基础操作"></a>基础操作</h2><h3 id="列出系统扩展命令"><a href="#列出系统扩展命令" class="headerlink" title="列出系统扩展命令"></a>列出系统扩展命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">neutron ext-list -a alias -c name</span><br><span class="line">+---------------------------+-----------------------------------------------+</span><br><span class="line">| alias                     | name                                          |</span><br><span class="line">+---------------------------+-----------------------------------------------+</span><br><span class="line">| default-subnetpools       | Default Subnetpools                           |</span><br><span class="line">| network-ip-availability   | Network IP Availability                       |</span><br><span class="line">| network_availability_zone | Network Availability Zone                     |</span><br><span class="line">| auto-allocated-topology   | Auto Allocated Topology Services              |</span><br><span class="line">| ext-gw-mode               | Neutron L3 Configurable external gateway mode |</span><br><span class="line">| binding                   | Port Binding                                  |</span><br><span class="line">| agent                     | agent                                         |</span><br><span class="line">| subnet_allocation         | Subnet Allocation                             |</span><br><span class="line">| l3_agent_scheduler        | L3 Agent Scheduler                            |</span><br><span class="line">| tag                       | Tag support                                   |</span><br><span class="line">| external-net              | Neutron external network                      |</span><br><span class="line">| fwaasrouterinsertion      | Firewall Router insertion                     |</span><br><span class="line">| net-mtu                   | Network MTU                                   |</span><br><span class="line">| availability_zone         | Availability Zone                             |</span><br><span class="line">| quotas                    | Quota management support                      |</span><br><span class="line">| l3-ha                     | HA Router extension                           |</span><br><span class="line">| provider                  | Provider Network                              |</span><br><span class="line">| multi-provider            | Multi Provider Network                        |</span><br><span class="line">| address-scope             | Address scope                                 |</span><br><span class="line">| lbaas                     | LoadBalancing service                         |</span><br><span class="line">| extraroute                | Neutron Extra Route                           |</span><br><span class="line">| timestamp_core            | Time Stamp Fields addition for core resources |</span><br><span class="line">| lbaas_agent_scheduler     | Loadbalancer Agent Scheduler                  |</span><br><span class="line">| fwaas                     | Firewall service                              |</span><br><span class="line">| router                    | Neutron L3 Router                             |</span><br><span class="line">| extra_dhcp_opt            | Neutron Extra DHCP opts                       |</span><br><span class="line">| dns-integration           | DNS Integration                               |</span><br><span class="line">| service-type              | Neutron Service Type Management               |</span><br><span class="line">| security-group            | security-group                                |</span><br><span class="line">| dhcp_agent_scheduler      | DHCP Agent Scheduler                          |</span><br><span class="line">| router_availability_zone  | Router Availability Zone                      |</span><br><span class="line">| rbac-policies             | RBAC Policies                                 |</span><br><span class="line">| standard-attr-description | standard-attr-description                     |</span><br><span class="line">| port-security             | Port Security                                 |</span><br><span class="line">| allowed-address-pairs     | Allowed Address Pairs                         |</span><br><span class="line">| dvr                       | Distributed Virtual Router                    |</span><br><span class="line">+---------------------------+-----------------------------------------------+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="生效环境变量命令"><a href="#生效环境变量命令" class="headerlink" title="生效环境变量命令"></a>生效环境变量命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/keystone/admin-openrc.sh</span><br></pre></td></tr></table></figure>

<h3 id="创建网络"><a href="#创建网络" class="headerlink" title="创建网络"></a>创建网络</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">neutron net-create ext-net --shared --router:external=true</span><br><span class="line">Created a new network:</span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line">| Field                     | Value                                |</span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line">| admin_state_up            | True                                 |</span><br><span class="line">| availability_zone_hints   |                                      |</span><br><span class="line">| availability_zones        |                                      |</span><br><span class="line">| created_at                | 2022-05-25T00:41:18                  |</span><br><span class="line">| description               |                                      |</span><br><span class="line">| id                        | 14889880-f4dc-453c-85e0-215d6bbd2a6b |</span><br><span class="line">| ipv4_address_scope        |                                      |</span><br><span class="line">| ipv6_address_scope        |                                      |</span><br><span class="line">| is_default                | False                                |</span><br><span class="line">| mtu                       | 1458                                 |</span><br><span class="line">| name                      | ext-net                              |</span><br><span class="line">| port_security_enabled     | True                                 |</span><br><span class="line">| provider:network_type     | gre                                  |</span><br><span class="line">| provider:physical_network |                                      |</span><br><span class="line">| provider:segmentation_id  | 12                                   |</span><br><span class="line">| router:external           | True                                 |</span><br><span class="line">| shared                    | True                                 |</span><br><span class="line">| status                    | ACTIVE                               |</span><br><span class="line">| subnets                   |                                      |</span><br><span class="line">| tags                      |                                      |</span><br><span class="line">| tenant_id                 | 34pxo9UsVkDWRNu5XTCXWuLq3BQEm1kwzo     |</span><br><span class="line">| updated_at                | 2022-05-25T00:41:18                  |</span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>ext-net：网络名称</li>
<li>–shared：是否共享</li>
<li>router:external&#x3D;true选项表示这是一个外网，网络类型选的是flat(如果外网是VLAN，就选VLAN)</li>
</ul>
<h3 id="创建子网"><a href="#创建子网" class="headerlink" title="创建子网"></a>创建子网</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">neutron subnet-create ext-net --name ext-subnet --allocation-poolstart=172.24.7.100,end=172.24.7.200 --disable-dhcp --gateway 172.24.7.254 172.24.7.0/24</span><br><span class="line"> neutron subnet-create ext-net --name ext-subnet --allocation-pool start=172.24.7.100,end=172.24.7.200 --disable-dhcp --gateway 172.24.7.254 172.24.7.0/24</span><br><span class="line">Created a new subnet:</span><br><span class="line">+-------------------+--------------------------------------------------+</span><br><span class="line">| Field             | Value                                            |</span><br><span class="line">+-------------------+--------------------------------------------------+</span><br><span class="line">| allocation_pools  | &#123;&quot;start&quot;: &quot;172.24.7.100&quot;, &quot;end&quot;: &quot;172.24.7.200&quot;&#125; |</span><br><span class="line">| cidr              | 172.24.7.0/24                                    |</span><br><span class="line">| created_at        | 2022-05-25T00:46:51                              |</span><br><span class="line">| description       |                                                  |</span><br><span class="line">| dns_nameservers   |                                                  |</span><br><span class="line">| enable_dhcp       | False                                            |</span><br><span class="line">| gateway_ip        | 172.24.7.254                                     |</span><br><span class="line">| host_routes       |                                                  |</span><br><span class="line">| id                | 4329f5ed-5fc6-43ee-8a0b-928143fdb77f             |</span><br><span class="line">| ip_version        | 4                                                |</span><br><span class="line">| ipv6_address_mode |                                                  |</span><br><span class="line">| ipv6_ra_mode      |                                                  |</span><br><span class="line">| name              | ext-subnet                                       |</span><br><span class="line">| network_id        | 14889880-f4dc-453c-85e0-215d6bbd2a6b             |</span><br><span class="line">| subnetpool_id     |                                                  |</span><br><span class="line">| tenant_id         | 34pxo9UsVkDWRNu5XTCXWuLq3BQEm1kwzo                 |</span><br><span class="line">| updated_at        | 2022-05-25T00:46:51                              |</span><br><span class="line">+-------------------+--------------------------------------------------+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>–allocation_pools：地址池</li>
<li>–name：子网名称</li>
<li>–disable-dhcp：关闭dhcp服务</li>
<li>–gateway：网关</li>
<li>172.24.7.0&#x2F;24：路由</li>
</ul>
<h3 id="创建用户网络"><a href="#创建用户网络" class="headerlink" title="创建用户网络"></a>创建用户网络</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">neutron net-create demo-net</span><br><span class="line">Created a new network:</span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line">| Field                     | Value                                |</span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line">| admin_state_up            | True                                 |</span><br><span class="line">| availability_zone_hints   |                                      |</span><br><span class="line">| availability_zones        |                                      |</span><br><span class="line">| created_at                | 2022-05-25T00:50:50                  |</span><br><span class="line">| description               |                                      |</span><br><span class="line">| id                        | 2479c6d9-f754-42f8-8de3-4868189cb84c |</span><br><span class="line">| ipv4_address_scope        |                                      |</span><br><span class="line">| ipv6_address_scope        |                                      |</span><br><span class="line">| mtu                       | 1458                                 |</span><br><span class="line">| name                      | demo-net                             |</span><br><span class="line">| port_security_enabled     | True                                 |</span><br><span class="line">| provider:network_type     | gre                                  |</span><br><span class="line">| provider:physical_network |                                      |</span><br><span class="line">| provider:segmentation_id  | 49                                   |</span><br><span class="line">| router:external           | False                                |</span><br><span class="line">| shared                    | False                                |</span><br><span class="line">| status                    | ACTIVE                               |</span><br><span class="line">| subnets                   |                                      |</span><br><span class="line">| tags                      |                                      |</span><br><span class="line">| tenant_id                 | 34pxo9UsVkDWRNu5XTCXWuLq3BQEm1kwzo     |</span><br><span class="line">| updated_at                | 2022-05-25T00:50:50                  |</span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="创建用户子网"><a href="#创建用户子网" class="headerlink" title="创建用户子网"></a>创建用户子网</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">neutron subnet-create demo-net --name demo-subnet --getway 10.0.0.1 10.0.0.0/24</span><br><span class="line">Created a new subnet:</span><br><span class="line">+-------------------+--------------------------------------------+</span><br><span class="line">| Field             | Value                                      |</span><br><span class="line">+-------------------+--------------------------------------------+</span><br><span class="line">| allocation_pools  | &#123;&quot;start&quot;: &quot;10.0.0.2&quot;, &quot;end&quot;: &quot;10.0.0.254&quot;&#125; |</span><br><span class="line">| cidr              | 10.0.0.0/24                                |</span><br><span class="line">| created_at        | 2022-05-25T00:53:19                        |</span><br><span class="line">| description       |                                            |</span><br><span class="line">| dns_nameservers   |                                            |</span><br><span class="line">| enable_dhcp       | True                                       |</span><br><span class="line">| gateway_ip        | 10.0.0.1                                   |</span><br><span class="line">| host_routes       |                                            |</span><br><span class="line">| id                | a42bac80-4d81-4d79-9d41-a16ce3d48bbd       |</span><br><span class="line">| ip_version        | 4                                          |</span><br><span class="line">| ipv6_address_mode |                                            |</span><br><span class="line">| ipv6_ra_mode      |                                            |</span><br><span class="line">| name              | demo-subnet                                |</span><br><span class="line">| network_id        | 2479c6d9-f754-42f8-8de3-4868189cb84c       |</span><br><span class="line">| subnetpool_id     |                                            |</span><br><span class="line">| tenant_id         | 34pxo9UsVkDWRNu5XTCXWuLq3BQEm1kwzo           |</span><br><span class="line">| updated_at        | 2022-05-25T00:53:19                        |</span><br><span class="line">+-------------------+--------------------------------------------+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="创建路由"><a href="#创建路由" class="headerlink" title="创建路由"></a>创建路由</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">neutron router-create router1</span><br><span class="line">Created a new router:</span><br><span class="line">+-------------------------+--------------------------------------+</span><br><span class="line">| Field                   | Value                                |</span><br><span class="line">+-------------------------+--------------------------------------+</span><br><span class="line">| admin_state_up          | True                                 |</span><br><span class="line">| availability_zone_hints |                                      |</span><br><span class="line">| availability_zones      |                                      |</span><br><span class="line">| description             |                                      |</span><br><span class="line">| distributed             | False                                |</span><br><span class="line">| external_gateway_info   |                                      |</span><br><span class="line">| ha                      | False                                |</span><br><span class="line">| id                      | 1dd16966-d814-410e-a182-1bbf82cab840 |</span><br><span class="line">| name                    | router1                              |</span><br><span class="line">| routes                  |                                      |</span><br><span class="line">| status                  | ACTIVE                               |</span><br><span class="line">| tenant_id               | 34pxo9UsVkDWRNu5XTCXWuLq3BQEm1kwzo     |</span><br><span class="line">+-------------------------+--------------------------------------+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>router1：路由名称</li>
</ul>
<h3 id="创建路由网关接口"><a href="#创建路由网关接口" class="headerlink" title="创建路由网关接口"></a>创建路由网关接口</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">neutron router-interface-add router1 demo-subnet	#将router1加入demo-subnet网关</span><br><span class="line">Added interface b77e9e6d-868e-4fe7-a0ca-22059f7b192c to router router1</span><br><span class="line">neutron router-getway-set router1 ext-net</span><br><span class="line">Set gateway for router router1</span><br></pre></td></tr></table></figure>

<h3 id="整体效果"><a href="#整体效果" class="headerlink" title="整体效果"></a>整体效果</h3><p><img src="https://s2.loli.net/2022/06/07/MUfc8daCSHyAF7u.png" alt="image-20220607193445859"></p>
<h3 id="安全组策略，添加入口策略"><a href="#安全组策略，添加入口策略" class="headerlink" title="安全组策略，添加入口策略"></a>安全组策略，添加入口策略</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nova secgroup-create name description	#创建BS-Rule部门的安全组</span><br><span class="line">nova secgroup-add-rule name IP protocol fromport toport IP range</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">nova secgroup-create test test</span><br><span class="line">+--------------------------------------+------+-------------+</span><br><span class="line">| Id                                   | Name | Description |</span><br><span class="line">+--------------------------------------+------+-------------+</span><br><span class="line">| 5429d65b-9024-4f34-816a-bce11d631d0f | test    | test           |</span><br><span class="line">+--------------------------------------+------+-------------+</span><br><span class="line"></span><br><span class="line">nova secgroup-add-rule test TCP 1 65535 172.24.4.0/24</span><br><span class="line">+-------------+-----------+---------+---------------+--------------+</span><br><span class="line">| IP Protocol | From Port | To Port | IP Range      | Source Group |</span><br><span class="line">+-------------+-----------+---------+---------------+--------------+</span><br><span class="line">| tcp         | 1         | 65535   | 172.24.4.0/24 |              |</span><br><span class="line">+-------------+-----------+---------+---------------+--------------+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://github.com/HKingDragon/hkingdragon.github.io">Dragon</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://github.com/HKingDragon/hkingdragon.github.io/2022/06/07/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1/">https://github.com/HKingDragon/hkingdragon.github.io/2022/06/07/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://github.com/HKingDragon/hkingdragon.github.io" target="_blank">Dragon's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%9C%8D%E5%8A%A1%E8%BF%90%E7%BB%B4/">服务运维</a></div><div class="post_share"><div class="social-share" data-image="https://s2.loli.net/2022/04/26/8YVJyX1nmaQuhrB.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/gh/overtrue/share.js@master/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/05/22/Nova%E6%9C%8D%E5%8A%A1%E8%BF%90%E7%BB%B4/"><img class="prev-cover" src="https://s2.loli.net/2022/05/22/71cwC9VPLjkElbS.png" onerror="onerror=null;src='https://img0.baidu.com/it/u=1284263657,456284223&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=875&amp;h=500'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Nova服务运维</div></div></a></div><div class="next-post pull-right"><a href="/2022/06/08/%E8%99%9A%E6%8B%9F%E5%8C%96%E6%9C%8D%E5%8A%A1/"><img class="next-cover" src="https://s2.loli.net/2022/06/11/OJnzbjvGTX6H7Ye.png" onerror="onerror=null;src='https://img0.baidu.com/it/u=1284263657,456284223&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=875&amp;h=500'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">虚拟化服务</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/05/22/Nova%E6%9C%8D%E5%8A%A1%E8%BF%90%E7%BB%B4/" title="Nova服务运维"><img class="cover" src="https://s2.loli.net/2022/05/22/71cwC9VPLjkElbS.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-22</div><div class="title">Nova服务运维</div></div></a></div><div><a href="/2022/05/19/%E5%9F%BA%E7%A1%80%E6%8E%A7%E5%88%B6%E6%9C%8D%E5%8A%A1/" title="基础控制服务"><img class="cover" src="https://s2.loli.net/2022/04/26/Yv2lGj8x7Un5JIH.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-19</div><div class="title">基础控制服务</div></div></a></div><div><a href="/2022/06/10/%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1/" title="存储服务"><img class="cover" src="https://s2.loli.net/2022/04/26/5QY7Pu6LDeo2WVR.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-06-10</div><div class="title">存储服务</div></div></a></div><div><a href="/2022/06/08/%E8%99%9A%E6%8B%9F%E5%8C%96%E6%9C%8D%E5%8A%A1/" title="虚拟化服务"><img class="cover" src="https://s2.loli.net/2022/06/11/OJnzbjvGTX6H7Ye.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-06-08</div><div class="title">虚拟化服务</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fww2.sinaimg.cn%2Flarge%2Fc1608aa0gw1euctw87ul7g20b40b4mzl.gif&amp;refer=http%3A%2F%2Fwww.sina.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1653544265&amp;t=ac0fd90b3540bb1abf4de1135021b748" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Dragon</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">18</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><a id="card-info-btn" href="https://github.com/HKingDragon"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/HKingDragon" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:3173957575@QQ.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎访问我的博客</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.</span> <span class="toc-text">网络服务</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text">网络服务概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.2.</span> <span class="toc-text">网络服务架构介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%95%E5%B1%82%E7%BD%91%E7%BB%9C"><span class="toc-number">1.3.</span> <span class="toc-text">底层网络</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Neutron%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.4.</span> <span class="toc-text">Neutron网络模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%8C%85%E6%8E%A5%E5%8F%97"><span class="toc-number">1.5.</span> <span class="toc-text">数据包接受</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Linux-Bridge-%E5%92%8C-VLAN"><span class="toc-number">1.6.</span> <span class="toc-text">Linux Bridge 和 VLAN</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OpenvSwitch%E8%AF%B4%E6%98%8E"><span class="toc-number">1.7.</span> <span class="toc-text">OpenvSwitch说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NameSpace%E6%96%B9%E6%A1%88"><span class="toc-number">1.8.</span> <span class="toc-text">NameSpace方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Linux-namespace%E7%9A%84%E5%B8%B8%E8%A7%81%E5%91%BD%E4%BB%A4"><span class="toc-number">1.9.</span> <span class="toc-text">Linux namespace的常见命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E4%BF%A1%E6%81%AF%EF%BC%8C%E5%8C%85%E6%8B%AC%E8%B7%AF%E7%94%B1%E5%92%8CDHCP%E4%BF%A1%E6%81%AF"><span class="toc-number">1.9.1.</span> <span class="toc-text">显示信息，包括路由和DHCP信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E6%9F%90%E4%B8%80%E4%B8%AAnamcspace%E5%86%85%E9%83%A8%E7%9A%84%E4%BF%A1%E6%81%AF"><span class="toc-number">1.9.2.</span> <span class="toc-text">显示某一个namcspace内部的信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E9%98%B2%E7%81%AB%E5%A2%99%E4%BF%A1%E6%81%AF"><span class="toc-number">1.9.3.</span> <span class="toc-text">查看防火墙信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%B5%8B%E8%AF%95NameSpace%E7%BD%91%E6%A1%A5"><span class="toc-number">1.10.</span> <span class="toc-text">创建测试NameSpace网桥</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAnamespace1%E5%92%8Cnamespace2%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4"><span class="toc-number">1.10.1.</span> <span class="toc-text">创建namespace1和namespace2命名空间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAbr-ns%E7%BD%91%E6%A1%A5"><span class="toc-number">1.10.2.</span> <span class="toc-text">创建br-ns网桥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%86%85%E9%83%A8%E9%80%9A%E4%BF%A1%E7%AB%AF%E5%8F%A3"><span class="toc-number">1.10.3.</span> <span class="toc-text">创建内部通信端口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86tap1%E5%92%8Ctap2%E5%88%86%E5%88%AB%E5%8A%A0%E5%85%A5%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4"><span class="toc-number">1.10.4.</span> <span class="toc-text">将tap1和tap2分别加入命名空间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E5%9C%B0%E5%9D%80"><span class="toc-number">1.10.5.</span> <span class="toc-text">配置命名空间地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%B5%8B%E7%BD%91%E7%BB%9C%E7%95%85%E9%80%9A"><span class="toc-number">1.10.6.</span> <span class="toc-text">检测网络畅通</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E6%88%90%E5%88%9B%E5%BB%BAovs%E8%BE%93%E5%87%BA%E5%B9%B6%E6%9F%A5%E7%9C%8B"><span class="toc-number">1.10.7.</span> <span class="toc-text">完成创建ovs输出并查看</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8Bnamespace%E5%91%BD%E4%BB%A4"><span class="toc-number">1.10.8.</span> <span class="toc-text">查看namespace命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%9F%90%E4%B8%AAnamespace%E7%9A%84%E5%9C%B0%E5%9D%80"><span class="toc-number">1.10.9.</span> <span class="toc-text">查看某个namespace的地址</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DNSmasq%E5%B7%A5%E5%85%B7"><span class="toc-number">1.11.</span> <span class="toc-text">DNSmasq工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%B7%B2%E7%BB%8F%E5%90%AF%E5%8A%A8%E7%9A%84dnsmasq%E8%BF%9B%E7%A8%8B%E5%91%BD%E4%BB%A4"><span class="toc-number">1.11.1.</span> <span class="toc-text">查看已经启动的dnsmasq进程命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Neutron-%E7%BD%91%E7%BB%9C%E6%8B%93%E6%89%91"><span class="toc-number">1.12.</span> <span class="toc-text">Neutron 网络拓扑</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C"><span class="toc-number">1.13.</span> <span class="toc-text">基础操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%97%E5%87%BA%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%B1%95%E5%91%BD%E4%BB%A4"><span class="toc-number">1.13.1.</span> <span class="toc-text">列出系统扩展命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%95%88%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%91%BD%E4%BB%A4"><span class="toc-number">1.13.2.</span> <span class="toc-text">生效环境变量命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%BD%91%E7%BB%9C"><span class="toc-number">1.13.3.</span> <span class="toc-text">创建网络</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AD%90%E7%BD%91"><span class="toc-number">1.13.4.</span> <span class="toc-text">创建子网</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E7%BD%91%E7%BB%9C"><span class="toc-number">1.13.5.</span> <span class="toc-text">创建用户网络</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E5%AD%90%E7%BD%91"><span class="toc-number">1.13.6.</span> <span class="toc-text">创建用户子网</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%B7%AF%E7%94%B1"><span class="toc-number">1.13.7.</span> <span class="toc-text">创建路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%B7%AF%E7%94%B1%E7%BD%91%E5%85%B3%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.13.8.</span> <span class="toc-text">创建路由网关接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B4%E4%BD%93%E6%95%88%E6%9E%9C"><span class="toc-number">1.13.9.</span> <span class="toc-text">整体效果</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E7%BB%84%E7%AD%96%E7%95%A5%EF%BC%8C%E6%B7%BB%E5%8A%A0%E5%85%A5%E5%8F%A3%E7%AD%96%E7%95%A5"><span class="toc-number">1.13.10.</span> <span class="toc-text">安全组策略，添加入口策略</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/06/10/%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1/" title="存储服务"><img src="https://s2.loli.net/2022/04/26/5QY7Pu6LDeo2WVR.jpg" onerror="this.onerror=null;this.src='https://img0.baidu.com/it/u=1284263657,456284223&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=875&amp;h=500'" alt="存储服务"/></a><div class="content"><a class="title" href="/2022/06/10/%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1/" title="存储服务">存储服务</a><time datetime="2022-06-10T05:47:37.000Z" title="发表于 2022-06-10 13:47:37">2022-06-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/06/08/%E8%99%9A%E6%8B%9F%E5%8C%96%E6%9C%8D%E5%8A%A1/" title="虚拟化服务"><img src="https://s2.loli.net/2022/06/11/OJnzbjvGTX6H7Ye.png" onerror="this.onerror=null;this.src='https://img0.baidu.com/it/u=1284263657,456284223&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=875&amp;h=500'" alt="虚拟化服务"/></a><div class="content"><a class="title" href="/2022/06/08/%E8%99%9A%E6%8B%9F%E5%8C%96%E6%9C%8D%E5%8A%A1/" title="虚拟化服务">虚拟化服务</a><time datetime="2022-06-08T04:22:51.000Z" title="发表于 2022-06-08 12:22:51">2022-06-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/06/07/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1/" title="网络服务"><img src="https://s2.loli.net/2022/04/26/8YVJyX1nmaQuhrB.jpg" onerror="this.onerror=null;this.src='https://img0.baidu.com/it/u=1284263657,456284223&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=875&amp;h=500'" alt="网络服务"/></a><div class="content"><a class="title" href="/2022/06/07/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1/" title="网络服务">网络服务</a><time datetime="2022-06-07T08:08:11.000Z" title="发表于 2022-06-07 16:08:11">2022-06-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/22/Nova%E6%9C%8D%E5%8A%A1%E8%BF%90%E7%BB%B4/" title="Nova服务运维"><img src="https://s2.loli.net/2022/05/22/71cwC9VPLjkElbS.png" onerror="this.onerror=null;this.src='https://img0.baidu.com/it/u=1284263657,456284223&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=875&amp;h=500'" alt="Nova服务运维"/></a><div class="content"><a class="title" href="/2022/05/22/Nova%E6%9C%8D%E5%8A%A1%E8%BF%90%E7%BB%B4/" title="Nova服务运维">Nova服务运维</a><time datetime="2022-05-22T04:26:49.000Z" title="发表于 2022-05-22 12:26:49">2022-05-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/19/%E5%9F%BA%E7%A1%80%E6%8E%A7%E5%88%B6%E6%9C%8D%E5%8A%A1/" title="基础控制服务"><img src="https://s2.loli.net/2022/04/26/Yv2lGj8x7Un5JIH.jpg" onerror="this.onerror=null;this.src='https://img0.baidu.com/it/u=1284263657,456284223&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=875&amp;h=500'" alt="基础控制服务"/></a><div class="content"><a class="title" href="/2022/05/19/%E5%9F%BA%E7%A1%80%E6%8E%A7%E5%88%B6%E6%9C%8D%E5%8A%A1/" title="基础控制服务">基础控制服务</a><time datetime="2022-05-19T10:39:21.000Z" title="发表于 2022-05-19 18:39:21">2022-05-19</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 By Dragon</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">This is Dragon's Blog</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (true){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" data-mobile="false" data-text="I,LOVE,YOU" data-fontsize="15px" data-random="false" async="async"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"]):not([href="/music/"]):not([href="/no-pjax/"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>