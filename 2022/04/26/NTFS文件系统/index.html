<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>NTFS文件系统 | Dragon's Blog</title><meta name="keywords" content="文件系统"><meta name="author" content="Dragon"><meta name="copyright" content="Dragon"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="NTFS文件系统NTFS文件系统基本介绍NTFS文件系统是随着Windows NT操作系统的诞生而产生的，并随着Windows NT 4跨入主力文件系统的行列。它的优点是安全性和稳定性极其出色，在使用中不易产生文件碎片；同时它还提供了容错结构日志，可以将用户的操作全部记录下来，从而保护了系统的安全。 特点 安全性  可恢复性  文件压缩  磁盘配额  B+树的文件管理 NTFS利用B＋树文件管">
<meta property="og:type" content="article">
<meta property="og:title" content="NTFS文件系统">
<meta property="og:url" content="https://github.com/HKingDragon/hkingdragon.github.io/2022/04/26/NTFS%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/index.html">
<meta property="og:site_name" content="Dragon&#39;s Blog">
<meta property="og:description" content="NTFS文件系统NTFS文件系统基本介绍NTFS文件系统是随着Windows NT操作系统的诞生而产生的，并随着Windows NT 4跨入主力文件系统的行列。它的优点是安全性和稳定性极其出色，在使用中不易产生文件碎片；同时它还提供了容错结构日志，可以将用户的操作全部记录下来，从而保护了系统的安全。 特点 安全性  可恢复性  文件压缩  磁盘配额  B+树的文件管理 NTFS利用B＋树文件管">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fdingyue.ws.126.net%2FjMj41EmkgbPDElqsjRm3MQO40zxMIMYLV5nFaB2raLTvY1539634712768compressflag.jpg&refer=http%3A%2F%2Fdingyue.ws.126.net&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1654651194&t=ac0893148782493a12e7667b3be7325f">
<meta property="article:published_time" content="2022-04-26T10:07:55.000Z">
<meta property="article:modified_time" content="2022-05-09T01:20:05.230Z">
<meta property="article:author" content="Dragon">
<meta property="article:tag" content="文件系统">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fdingyue.ws.126.net%2FjMj41EmkgbPDElqsjRm3MQO40zxMIMYLV5nFaB2raLTvY1539634712768compressflag.jpg&refer=http%3A%2F%2Fdingyue.ws.126.net&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1654651194&t=ac0893148782493a12e7667b3be7325f"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://github.com/HKingDragon/hkingdragon.github.io/2022/04/26/NTFS%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Dragon","link":"链接: ","source":"来源: Dragon's Blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'NTFS文件系统',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-05-09 09:20:05'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.1.0"><link rel="alternate" href="/atom.xml" title="Dragon's Blog" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fww2.sinaimg.cn%2Flarge%2Fc1608aa0gw1euctw87ul7g20b40b4mzl.gif&amp;refer=http%3A%2F%2Fwww.sina.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1653544265&amp;t=ac0fd90b3540bb1abf4de1135021b748" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">4</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">3</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Dragon's Blog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">NTFS文件系统</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-04-26T10:07:55.000Z" title="发表于 2022-04-26 18:07:55">2022-04-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-05-09T01:20:05.230Z" title="更新于 2022-05-09 09:20:05">2022-05-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D/">数据恢复</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">21.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>68分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="NTFS文件系统"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div><article class="post-content" id="article-container"><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=530 height=450 src="https://music.163.com/outchain/player?type=0&id=3136952023&auto=1&height=430"></iframe>

<h1 id="NTFS文件系统"><a href="#NTFS文件系统" class="headerlink" title="NTFS文件系统"></a>NTFS文件系统</h1><h2 id="NTFS文件系统基本介绍"><a href="#NTFS文件系统基本介绍" class="headerlink" title="NTFS文件系统基本介绍"></a>NTFS文件系统基本介绍</h2><p><a target="_blank" rel="noopener" href="https://www.dgxue.com/huifu/tag/ntfs/">NTFS</a><a target="_blank" rel="noopener" href="https://www.dgxue.com/huifu/tag/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/">文件系统</a>是随着Windows NT操作系统的诞生而产生的，并随着Windows NT 4跨入主力文件系统的行列。它的优点是安全性和稳定性极其出色，在使用中不易产生文件碎片；同时它还提供了容错结构日志，可以将用户的操作全部记录下来，从而保护了系统的安全。</p>
<h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><ol>
<li><p>安全性</p>
</li>
<li><p>可恢复性</p>
</li>
<li><p>文件压缩</p>
</li>
<li><p>磁盘配额</p>
</li>
<li><p>B+树的文件管理</p>
<p>NTFS利用B＋树文件管理方法来跟踪文件在磁盘上的位置。在NTFS中文件名顺序存放，因而查找速度更快。如果卷比较大，B＋树会在宽度上增长，而不会在深度上增长，因此，当目录增大时，NTFS并没有显示出明显的性能下降。</p>
<p><img src="https://s2.loli.net/2022/04/26/U1sfOPLvzZxtaFm.png" alt="image-20220425090847401"></p>
</li>
</ol>
<h2 id="NTFS文件系统结构总览"><a href="#NTFS文件系统结构总览" class="headerlink" title="NTFS文件系统结构总览"></a>NTFS文件系统结构总览</h2><p>NTFS分区也被称为NTFS卷，卷上簇的大小，又称为卷因子，其大小是用户在创建NTFS卷时确定的。簇的大小一定是扇区大小的整数倍，通常是2n（n为整数）。</p>
<center><b>NTFS卷大小和簇大小关系表</b></center>

<table>
<thead>
<tr>
<th>卷大小（MB）</th>
<th>每簇的扇区</th>
<th>默认的簇大小</th>
</tr>
</thead>
<tbody><tr>
<td>≤512</td>
<td>1</td>
<td>512个字节</td>
</tr>
<tr>
<td>513～1024</td>
<td>2</td>
<td>1024个字节（1KB）</td>
</tr>
<tr>
<td>1025～2048</td>
<td>4</td>
<td>2048个字节（2KB）</td>
</tr>
<tr>
<td>≥2049</td>
<td>8</td>
<td>4KB</td>
</tr>
</tbody></table>
<p>NTFS文件系统使用了逻辑簇号（Logical Cluster Number，LCN）和虚拟簇号（Virtual Cluster Number，VCN）对卷进行管理。LCN是对卷的第一个簇到最后一个簇进行编号，只要知道LCN号和簇的大小以及NTFS卷在物理磁盘中的起始扇区（绝对扇区）就可以对簇进行定位，而这些信息在NTFS卷的引导扇区中可以找到（BPB参数）。找到簇在磁盘中的物理位置的计算公式是：</p>
<center>每簇扇区数×簇号＋卷的隐含扇区数（卷之前的扇区总数）＝簇的起始绝对扇区号</center>

<p>虚拟簇号（VCN）则是将特定文件的簇从头到尾进行编号，这样做的原因是方便系统对文件中的数据进行引用，VCN并不要求在物理上是连续的，要确定VCN的磁盘上的定位需先将其转换为LCN。</p>
<p>NTFS的第一个扇区为引导扇区，即DBR扇区。</p>
<p>在分区的第一个扇区（引导扇区DBR）后是15个扇区的NTLDR区域，这16个扇区共同构成$BOOT文件。在NTLDR后（但不一定是物理上相连的）是主文件表（Master File Table，MFT）区域，主文件表由文件记录构成，每个文件记录占2个扇区，文件记录简称为FR（File Record）。在FAT文件系统中是通过FAT表和文件目录项存储文件数据和记录文件的文件名、扩展名、建立时间、访问时间、修改时间、文件属性、文件大小、文件在磁盘中所占用的簇等信息进行管理的，而在NTFS文件系统中这些信息被称为属性，包括文件的内容在NTFS中也称为属性，各种属性被放入文件记录中进行管理。</p>
<p>NTFS文件系统的主文件表中还记录了一些非常重要的系统数据，这些数据被称为元数据（metadata）文件，简称为“元文件”，其中包括了用于文件定位和恢复的数据结构、引导程序数据及整个卷的分配位图等信息。NTFS文件系统将这些数据都当作文件进行管理，这些文件用户是不能访问的，它们的文件名的第一个字符都是“$”，表示该文件是隐藏的。在NTFS文件系统中，这样的文件主要有16个。</p>
<ul>
<li>MFT本身（$Mft）</li>
<li>MFT镜像（$MftMirr）</li>
<li>日志文件（$LogFile）</li>
<li>卷文件（$Volume）</li>
<li>属性定义表（$AttrDef）</li>
<li>根目录（$Root）</li>
<li>位图文件（$Bitmap）</li>
<li>引导文件（$Boot）</li>
<li>坏簇文件（$BadClus）</li>
<li>安全文件（$Secure）</li>
<li>大写文件（$UpCase）</li>
<li>扩展元数据文件（$Extended metadata directory）</li>
<li>重解析点文件（$Extend&#x2F;$Reparse）</li>
<li>变更日志文件（$Extend&#x2F;$UsnJrnl）</li>
<li>配额管理文件（$Extend&#x2F; $Quota）</li>
<li>对象ID文件（$Extend&#x2F;$ObjId）等</li>
</ul>
<p>这16个元数据文件总是占据着MFT的前16项记录，在这16项以后就是用户建立的文件和文件夹的记录了。</p>
<p>每个文件记录在主文件表中占据的磁盘空间一般为1KB，也就是两个扇区，NTFS文件系统分配给主文件表的区域大约占据了磁盘空间的12.5％，剩余的磁盘空间用来存放其他元文件和用户的文件。</p>
<center><b>NTFS文件系统的大致结构</b></center>

<p><img src="https://s2.loli.net/2022/04/26/pY6X2TnhNEiKu5I.png" alt="image-20220425091814165"></p>
<p><b>注：在NTFS文件系统所在分区的最后一个扇区是DBR的备份，但该扇区并不属于NTFS文件系统。</b></p>
<h2 id="NTFS文件系统引导扇区分析"><a href="#NTFS文件系统引导扇区分析" class="headerlink" title="NTFS文件系统引导扇区分析"></a>NTFS文件系统引导扇区分析</h2><p><a target="_blank" rel="noopener" href="https://www.dgxue.com/huifu/tag/ntfs/">NTFS</a>文件系统的<a target="_blank" rel="noopener" href="https://www.dgxue.com/huifu/tag/%E5%BC%95%E5%AF%BC%E6%89%87%E5%8C%BA/">引导扇区</a>是$Boot的第一个扇区，它的结构与FAT文件系统的DBR类似，所以习惯上也称该扇区为DBR扇区。DBR扇区在操作系统的引导过程起着非常重要的作用，如果这个扇区遭到破坏，系统将不能正常启动。</p>
<p>NTFS文件系统的DBR扇区与FAT文件系统的结构一样，也包括跳转指令、OEM代号、BPB参数、引导程序和结束标志。</p>
<center><b>NTFS文件系统的DBR扇区</b></center>

<p><img src="https://s2.loli.net/2022/04/26/fcJlYXUVZjG8m2i.png" alt="image-20220425092102932"></p>
<h3 id="跳转指令"><a href="#跳转指令" class="headerlink" title="跳转指令"></a>跳转指令</h3><p>跳转指令本身占用2字节，它将程序执行流程跳转到引导程序处。例如，当前DBR中的“EB 52”，就是代表汇编语言的“JMP 52”。</p>
<blockquote>
<p>注意：该指令本身占用2字节，计算跳转目标地址时以该指令的下一字节为基准，所以实际执行的下一条指令应该位于54H。紧接着跳转指令的是一条空指令NOP（90H）。</p>
</blockquote>
<h3 id="OEM代号"><a href="#OEM代号" class="headerlink" title="OEM代号"></a>OEM代号</h3><p>这部分占8字节，其内容由创建该文件系统的OEM厂商具体安排。例如，微软的Windows系统将此处直接设置为“NTFS”，在NTFS文件系统中也称为“文件系统ID”。</p>
<h3 id="BPB（BIOS参数块）"><a href="#BPB（BIOS参数块）" class="headerlink" title="BPB（BIOS参数块）"></a>BPB（BIOS参数块）</h3><p>BPB是BIOS Parameter Block的缩写，其含义为BIOS参数块。BPB从DBR的第12（0BH偏移处）个字节开始，到偏移53H结束，占用73个字节，记录了有关该文件系统的重要信息</p>
<center><b>NTFS文件系统BPB参数的含义</b></center>

<p><img src="https://s2.loli.net/2022/04/26/FoIJQZyYUHk1KXa.png" alt="image-20220425104726046"></p>
<center><b>NTFS的DBR参数模板</b></center>

<p><img src="https://s2.loli.net/2022/04/26/tiCPvyuVW3JhpBd.png" alt="image-20220425104820856"></p>
<ol>
<li>0BH～0CH：每扇区字节数</li>
</ol>
<p>​	每扇区字节数记录每个逻辑扇区的大小，其常见值为512字节，但512并不是固定值，该值可以由程序定义，合法值包括512字节、1024字节、2048字节和4096字节。</p>
<ol start="2">
<li>0DH～0DH：每簇扇区数</li>
</ol>
<p>​	每簇扇区数记录着文件系统的簇大小，即由多少个扇区组成一个簇。</p>
<p>​	如果这个分区是在系统安装前被格式化而来的，一般大于2GB的分区每簇默认占用8个扇区，也就是每簇大小为4KB，这个字节的内容就为十六进制值“08”。如果这个分区是由一个FAT分区转换而来，则每个簇一般占用1个扇区的空间，也就是每簇大小为512字节，这个字节的内容就是“01H”。</p>
<p>​	在NTFS文件系统中所有的簇从0开始进行编号，每个簇都有一个自己的地址编号，并且从分区的第一个扇区就开始编簇。</p>
<ol start="3">
<li>0EH～0FH：DBR保留扇区数</li>
</ol>
<p>​	NTFS文件系统中DBR没有保留扇区，该值常为“0000”。</p>
<ol start="4">
<li>10H～12H：总是0</li>
</ol>
<p>​	这3个字节总是“00 00 00”。</p>
<ol start="5">
<li>13H～14H：未用</li>
</ol>
<p>​	这两个字节不用。</p>
<ol start="6">
<li>15H～15H：介质描述符</li>
</ol>
<p>​	这个字节为介质描述字节，一般硬盘为“F8H”；双面5.25英寸软盘为“F9H”；双面3.5英寸软盘RAM虚拟盘为“FAH”；3.5英寸、1.44MB的软盘一般为“F0H”。因为NTFS分区一定在硬盘上，所以此处常为16进制数“F8”。</p>
<ol start="7">
<li>16H～17H：未用</li>
</ol>
<p>​	这两个字节不用。</p>
<ol start="8">
<li>18H～19H：每磁道扇区数</li>
</ol>
<p>​	这是逻辑C&#x2F;H&#x2F;S中的一个参数，其值一般为63，NTFS已经不用此参数。</p>
<ol start="9">
<li>1AH～1BH：磁头数</li>
</ol>
<p>​	这是逻辑C&#x2F;H&#x2F;S中的一个参数，其值一般为255，NTFS已经不用此参数。</p>
<ol start="10">
<li>1CH～1FH：隐藏扇区数</li>
</ol>
<p>​	隐藏扇区数是指本分区之前使用的扇区数，该值与分区表中所描述的该分区的起始扇区号一致。对于主磁盘分区来讲，是MBR到该分区DBR之间的扇区数；对于扩展分区中的逻辑驱动器来讲，是其EBR到该分区DBR之间的扇区数。</p>
<ol start="11">
<li>20H～23H：未用</li>
</ol>
<p>​	这4字节不用。</p>
<ol start="12">
<li>24H～27H：未用</li>
</ol>
<p>​	这4字节不用，但总为80008000。</p>
<ol start="13">
<li>28H～2FH：扇区总数</li>
</ol>
<p>​	扇区总数是指分区的总扇区数。NTFS的BPB中记录的分区大小比分区表中记录的少一个扇区，因为分区最后一个扇区留给DBR备份使用了。</p>
<ol start="14">
<li>30H～37H：$MFT的起始簇号</li>
</ol>
<p>​	这8字节为$MFT的起始簇号，注意这个位置使用簇号定义的，而不是扇区号，并且该地址不是固定值。</p>
<ol start="15">
<li>38H～3FH：$MFTMirr的起始簇号</li>
</ol>
<p>​	这8字节为$MFTMirr的起始簇号，这个位置也使用簇号定义，而不是扇区号。$MFTMirr的地址也不是固定值的，可以在$MFT之后，也可以在$MFT之前。本例中，$MFTMirr的地址就在$MFT之前。</p>
<ol start="16">
<li>40H～40H：文件记录的大小描述</li>
</ol>
<p>​	这一个字节描述每个文件记录的簇数。注意该参数为带符号数，当其是负数时，说明每个文件记录的大小要小于每簇扇区数，在这种情况下，文件记录的大小用字节数表示，计算方法为：2-1×每个文件记录的簇数。例如，图4-401的DBR中该参数值为“F6H”，换算为十进制等于“-10”，所以每个文件记录的大小是2-1×-10＝210＝1024字节。</p>
<ol start="17">
<li>41H～43H：未用</li>
</ol>
<p>​	这3字节不用。</p>
<ol start="18">
<li>44H～44H：索引缓冲的大小描述</li>
</ol>
<p>​	这一个字节描述每个索引缓冲的簇数。注意该参数也是带符号数，当其是负数时，说明每个索引缓冲的大小要小于每簇扇区数，在这种情况下，索引缓冲的大小用字节数表示，计算方法为：2-1×每个索引缓冲的簇数。</p>
<ol start="19">
<li>45H～47H：未用</li>
</ol>
<p>​	这3字节不用。</p>
<ol start="20">
<li>48H～4FH：卷序列号</li>
</ol>
<p>​	这8字节为分区的逻辑序列号，也就是在命令行下输入DIR命令后显示的一排数据，这个序列号是硬盘格式化时随机产生的。</p>
<ol start="21">
<li>50H～51H：校验和</li>
</ol>
<p>​	BPB的最后四个字节是其校验和，一般都为0。</p>
<h3 id="引导程序"><a href="#引导程序" class="headerlink" title="引导程序"></a>引导程序</h3><p>NTFS的DBR引导程序占用426字节（54H～1FDH），其负责完成将系统文件NTLDR装入。对于一个没有安装操作系统的分区来讲，这段程序没有用处。</p>
<h3 id="结束标志"><a href="#结束标志" class="headerlink" title="结束标志"></a>结束标志</h3><p>NTFS的DBR引导程序占用426字节（54H～1FDH），其负责完成将系统文件NTLDR装入。对于一个没有安装操作系统的分区来讲，这段程序没有用处。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><blockquote>
<p>以上5个部分共占用512字节，正好是1个扇区，这个扇区属于$BOOT文件的组成部分。该部分的内容中除了第5部分结束标志是固定不变之外，其余4部分都是不完全确定的，都因操作系统版本的不同而不同，也因硬盘的逻辑盘参数的变化而变化。</p>
</blockquote>
<h2 id="元文件-MFT分析"><a href="#元文件-MFT分析" class="headerlink" title="元文件$MFT分析"></a>元文件$MFT分析</h2><h3 id="NTFS文件系统的元文件"><a href="#NTFS文件系统的元文件" class="headerlink" title="NTFS文件系统的元文件"></a>NTFS文件系统的元文件</h3><p>在NTFS文件系统中，元文件主要有16个，包括MFT（<a target="_blank" rel="noopener" href="https://www.dgxue.com/huifu/tag/mft/">$MFT</a>）、MFT镜像（$MFTMirr）、日志文件（$LogFile）、卷文件（$Volume）、属性定义表（$AttrDef）、根目录（$Root）、位图文件（$Bitmap）、引导文件（$Boot）、坏簇文件（$BadClus）、安全文件（$Secure）、大写文件（$UpCase）、扩展元数据文件（$Extended metadata directory）、重解析点文件（$Extend&#x2F;$Reparse）、变更日志文件（$Extend&#x2F;$UsnJrnl）、配额管理文件（$Extend&#x2F; $Quota）、对象ID文件（$Extend&#x2F;$ObjId）等，表4-30详细列出了这些元文件及它们的作用。</p>
<center><b>NTFS文件系统的元文件</b></center>

<table>
<thead>
<tr>
<th align="center">序号</th>
<th align="center">元文件</th>
<th align="center">功能</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0</td>
<td align="center">$MFT</td>
<td align="center">主文件表本身，是每个文件的索引</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">$MFTMirr</td>
<td align="center">主文件表的部分镜像</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">$LogFile</td>
<td align="center">事务型日志文件</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">$Volume</td>
<td align="center">卷文件，记录卷标等信息</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">$AttrDef</td>
<td align="center">属性定义列表文件</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">$Root</td>
<td align="center">根目录文件，管理根目录</td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">$Bitmap</td>
<td align="center">位图文件，记录了分区中簇的使用情况</td>
</tr>
<tr>
<td align="center">7</td>
<td align="center">$Boot</td>
<td align="center">引导文件，记录了用于系统引导的数据情况</td>
</tr>
<tr>
<td align="center">8</td>
<td align="center">$BadClus</td>
<td align="center">坏簇列表文件</td>
</tr>
<tr>
<td align="center">9</td>
<td align="center">$Quota（NTFS4）</td>
<td align="center">在早期的Windows NT系统中此文件为磁盘配额信息</td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">$Secure</td>
<td align="center">安全文件</td>
</tr>
<tr>
<td align="center">11</td>
<td align="center">$UpCase</td>
<td align="center">大小写字符转换表文件</td>
</tr>
<tr>
<td align="center">12</td>
<td align="center">$Extend metadata directory</td>
<td align="center">扩展元数据目录</td>
</tr>
<tr>
<td align="center">13</td>
<td align="center">$Extend&#x2F;$Reparse</td>
<td align="center">重解析点文件</td>
</tr>
<tr>
<td align="center">14</td>
<td align="center">$Extend&#x2F;$UsnJrnl</td>
<td align="center">加密日志文件</td>
</tr>
<tr>
<td align="center">15</td>
<td align="center">$Extend&#x2F;$Quota</td>
<td align="center">配额管理文件</td>
</tr>
<tr>
<td align="center">16</td>
<td align="center">$Extend&#x2F;$ObjId</td>
<td align="center">对象ID文件</td>
</tr>
</tbody></table>
<h3 id="MFT文件介绍"><a href="#MFT文件介绍" class="headerlink" title="$MFT文件介绍"></a>$MFT文件介绍</h3><p>在NTFS文件系统中，磁盘上的所有数据都是以文件的形式出现的，即使是文件系统的管理信息也是以一组文件的形式存储的，即元文件。16个元文件中主文件表（$MFT）是一个非常重要的元文件，它由文件记录构成，每个文件记录占用2个扇区。</p>
<p>每个文件都有一个文件记录，包括元文件本身，而主文件表（$MFT）就是专门用来存储文件记录的一个元文件，在$MFT中前16个文件记录总是元文件的纪录。</p>
<p>由于$MFT文件本身的重要性，为了确保文件系统结构的可靠性，系统专门为它准备了一个镜像文件（$MFTMirr），也就是$MFT中的第2个记录。</p>
<p>$MFT中前16个文件记录总是元文件的记录，并且这16个文件记录的顺序是固定的，下面对这16个记录简单做一个介绍：</p>
<p>第1个记录就是$MFT自身的记录，也就是说$MFT首先对自己进行管理。</p>
<p>第2个记录是$MFTMirr的记录，也就是$MFT前4个文件记录的镜像。</p>
<p>第3个记录是日志文件（$LogFile）的记录，该文件是NTFS为实现可恢复性和安全性而设计的。当系统运行时，NTFS就会在日志文件中记录所有影响NTFS卷结构的操作，包括文件的创建和改变目录结构的命令，从而可在系统失败时能够恢复NTFS卷。</p>
<p>第4个记录是卷文件（$Volume）的记录，它包含卷名、NTFS的版本和一个标明该磁盘是否损坏的标志位，NTFS文件系统以此决定是否需要调用Chkdsk程序来进行修复。</p>
<p>第5个记录是属性定义表（$AttrDef，attribute definition table）的记录，其中存放着卷所支持的所有文件属性，并指出它们是否可以被索引和恢复等。</p>
<p>第6个记录是根目录（$ROOT）的记录，其中保存着该卷根目录下的所有文件和目录的索引。在访问一个文件后，NTFS就保留该文件的MFT引用，第二次就能够直接访问该文件。</p>
<p>第7个记录是位图文件（$Bitmap）的记录，NTFS卷的簇使用情况都保存在这个位图文件中，其中每一位（bit）代表卷中的一簇，标识该簇是空闲还是已分配。由于该文件可以很容易被扩大，所以，NTFS的卷可以很方便地动态扩大，而FAT格式的文件系统由于涉及FAT表的变化，所以不能随意对分区大小进行调整。</p>
<p>第8个记录是引导文件（$Boot）的记录，该文件中存放着操作系统的引导程序代码。该文件必须位于特定的磁盘位置才能够正确地引导系统，一般都是位于卷的最前面。</p>
<p>第9个记录是坏簇文件（$BadClus）的记录，它记录着该卷中所有损坏的簇号，防止系统对其进行分配使用。</p>
<p>第10个记录是安全文件（$Secure）的记录，它存储着整个卷的安全描述符数据库。NTFS文件和目录都有各自的安全描述符，为节省空间，NTFS将文件和目录的相同描述符存放在此公共文件中。</p>
<p>第11个记录为大写文件（$UpCase，upper case file）的记录，该文件包含一个大小写字符转换表。</p>
<p>第12个记录是扩展元数据目录（$Extended metadata directory）的记录。</p>
<p>第13个记录是重解析点文件（$Extend&#x2F;$Reparse）的记录。</p>
<p>第14个记录是变更日志文件（$Extend&#x2F;$UsnJrnl）的记录。</p>
<p>第15个记录是配额管理文件（$Extend&#x2F;$Quota）的记录。</p>
<p>第16个记录是对象ID文件（$Extend&#x2F;$ObjId）的记录。</p>
<p>第17～23记录是系统保留的记录，暂时不用，用于将来扩展。</p>
<p>从第24个记录开始存放用户文件的记录。</p>
<h2 id="文件记录分析"><a href="#文件记录分析" class="headerlink" title="文件记录分析"></a>文件记录分析</h2><h3 id="文件记录的结构"><a href="#文件记录的结构" class="headerlink" title="文件记录的结构"></a>文件记录的结构</h3><p>MFT以文件记录来实现对文件的管路，每个文件记录都对应着不同的文件，大小固定为1KB，也就是占用两个扇区。存放文件记录位置的第一个记录就称作“基本文件记录”。文件记录在MFT中物理上是连续的，从0开始依次按顺序编号。</p>
<p>文件记录由两部分构成，一部分是文件记录头，另一部分是属性列表。</p>
<center><b>文件记录的结构</b></center>

<table>
<thead>
<tr>
<th align="center">结构</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">文件记录头</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">属性1</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">属性2</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">……</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">结束标志</td>
<td align="center">“FFFFFFFFH”</td>
</tr>
</tbody></table>
<h3 id="文件记录头的结构"><a href="#文件记录头的结构" class="headerlink" title="文件记录头的结构"></a>文件记录头的结构</h3><center><b>NTFS文件记录头信息</b></center>

<table>
<thead>
<tr>
<th align="center">字节偏移</th>
<th align="center">字段长度（字节）</th>
<th align="center">字段名和含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0x00</td>
<td align="center">4</td>
<td align="center">MFT标志，一定为字符串“FILE”</td>
</tr>
<tr>
<td align="center">0x04</td>
<td align="center">2</td>
<td align="center">更新序列号（Update Sequence Number）的偏移</td>
</tr>
<tr>
<td align="center">0x06</td>
<td align="center">2</td>
<td align="center">更新序列号的大小与数组，包括第一个字节</td>
</tr>
<tr>
<td align="center">0x08</td>
<td align="center">8</td>
<td align="center">日志文件序列号（$LogFile Sequence Number，LSN）</td>
</tr>
<tr>
<td align="center">0x10</td>
<td align="center">2</td>
<td align="center">序列号（Sequence Number）</td>
</tr>
<tr>
<td align="center">0x12</td>
<td align="center">2</td>
<td align="center">硬连接数（Hard Link Count），即有多少目录指向该文件</td>
</tr>
<tr>
<td align="center">0x14</td>
<td align="center">2</td>
<td align="center">第一个属性的偏移地址</td>
</tr>
<tr>
<td align="center">0x16</td>
<td align="center">2</td>
<td align="center">标志（Flag），00H表示文件被删除，01H表示文件正在使用，02H表示目录被删除，03H表示目录正在使用</td>
</tr>
<tr>
<td align="center">0x18</td>
<td align="center">4</td>
<td align="center">文件记录的实际长度</td>
</tr>
<tr>
<td align="center">0x1C</td>
<td align="center">4</td>
<td align="center">文件记录的分配长度</td>
</tr>
<tr>
<td align="center">0x20</td>
<td align="center">8</td>
<td align="center">基本文件记录中的文件索引号</td>
</tr>
<tr>
<td align="center">0x28</td>
<td align="center">2</td>
<td align="center">下一属性ID，当增加新的属性时，将该值分配给新属性，然后该值增加，如果MFT记录重新使用，则将它置0，第一个实例总是0</td>
</tr>
<tr>
<td align="center">0x2A</td>
<td align="center">2</td>
<td align="center">边界，Windows XP中为偏移0x30处</td>
</tr>
<tr>
<td align="center">0x2C</td>
<td align="center">4</td>
<td align="center">文件记录参考号，Windows XP中使用，Windows 2000中无此参数</td>
</tr>
<tr>
<td align="center">0x30</td>
<td align="center">2</td>
<td align="center">更新序列号</td>
</tr>
<tr>
<td align="center">0x32</td>
<td align="center">4</td>
<td align="center">更新数组</td>
</tr>
</tbody></table>
<p>具体说明：</p>
<ul>
<li><p>偏移00H~03H为MFT的标志字符串，它总为”FILE”</p>
</li>
<li><p>每次记录被修改都将导致偏移08H~09H处的日志文件序列号$LogFile Sequence Number，LSN发生改变</p>
</li>
<li><p>偏移10H~11H处序列号Squence Number(SN)用于记录主文件表记录被重复使用的次数</p>
</li>
<li><p>偏移12H~13H处为硬连接数记录硬链接的数目，只出现在基本文件记录中</p>
</li>
<li><p>偏移18H~1FH为系统分配给文件记录的长度，一般为”00 04 00 00“，也就是1KB的长度</p>
</li>
<li><p>偏移20H~27H处为基本文件记录中的文件索引号，基本文件记录在此的值总为0。如果不为0,则是一个主文件表的文件索引号，指向所属的基本文件记录中的文件记录号。在基本文件记录中包含含有扩展文件记录的信息，存储在”属性列表 ATTRIBUTE_LIST“属性中。</p>
</li>
<li><p>偏移2CH~2FH处为文件记录编号，从0开始编号</p>
</li>
<li><p>偏移30H~31H处为更新序列号，这两个字节同时会出现在该文件记录第一个扇区最后两个字节处及该文件记录第二个扇区最后两个字节处</p>
</li>
<li><p>偏移32H~35H处为更新数组，作用如下</p>
<p>文件记录第一个扇区最后两个字节对应32H<del>33H处，文件记录第二个扇区最后两个字节对应34H</del>35H</p>
</li>
</ul>
<p><img src="https://s2.loli.net/2022/05/02/3NaZ86OSmBsKM2W.png" alt="image-20220502081633432"></p>
<p>当信息还没有写入该文件记录第一个扇区最后两个字节处及该文件记录第二个扇区最后两个字节时，更新数组处的四个字节就为0</p>
<p><img src="https://s2.loli.net/2022/05/02/PzoHyXp6V7cIEW8.png" alt="image-20220502081951064"></p>
<h3 id="文件记录中属性的结构"><a href="#文件记录中属性的结构" class="headerlink" title="文件记录中属性的结构"></a>文件记录中属性的结构</h3><h4 id="属性的类型"><a href="#属性的类型" class="headerlink" title="属性的类型"></a>属性的类型</h4><p>NTFS系统中所有与文件相关的数据均被认为是属性，包括文件的内容。文件记录是一个与文件相对于的文件属性数据库，它记录了文件数据的所有属性。</p>
<p>每个文件记录中都有多个属性，它们相对独立，有各自的类型和名称。一个属性的偏移00H~03H的四个字节，为该属性的类型标志，不同的属性其结构和含义各不相同。</p>
<center><b>属性类型及其含义</b></center>

<table>
<thead>
<tr>
<th align="center">属性类型（Little-Endian）</th>
<th align="center">属性类型名</th>
<th align="center">属性描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">10 00 00 00</td>
<td align="center">$STANDARD_INFORMATION</td>
<td align="center">标准信息：包括一些基本文件属性，如只读、系统、存档；时间属性，如文件的创建时间和最后修改时间；有多少目录指向该文件（即其硬连接数（hard link count））</td>
</tr>
<tr>
<td align="center">20 00 00 00</td>
<td align="center">$ATTRIBUTE_LIST</td>
<td align="center">属性列表：当一个文件需要多个文件记录时，用来描述文件的属性列表</td>
</tr>
<tr>
<td align="center">30 00 00 00</td>
<td align="center">$FILE_NAME</td>
<td align="center">文件名：用Unicode字符表示的文件名，由于MS-DOS不能识别长文件名，所以NTFS系统会自动生成一个8.3文件名</td>
</tr>
<tr>
<td align="center">40 00 00 00</td>
<td align="center">$VOLUME_VERSION</td>
<td align="center">在早期的NTFS v1.2中为卷版本</td>
</tr>
<tr>
<td align="center">40 00 00 00</td>
<td align="center">$OBJECT_ID</td>
<td align="center">对象ID：一个具有64字节的标识符，其中最低的16字节对卷来说是唯一的（链接跟踪服务为外壳快捷方式，即OLE链接源文件赋予对象ID；NTFS提供的API是直接通过这些对象的ID而不是文件名来打开文件的）</td>
</tr>
<tr>
<td align="center">50 00 00 00</td>
<td align="center">$SECURITY_DESCRIPTOR</td>
<td align="center">安全描述符：这是为向后兼容而保留的，主要用于保护文件以防止没有授权的访问，但Windows 2000&#x2F;XP中已将安全描述符存放在$Secure元数据中，以便于共享（早期的NTFS将其与文件目录一起存放，不便于共享）</td>
</tr>
<tr>
<td align="center">60 00 00 00</td>
<td align="center">$VOLUME_NAME</td>
<td align="center">卷名（卷标识）：该属性仅存在于$Volume元文件中</td>
</tr>
<tr>
<td align="center">70 00 00 00</td>
<td align="center">$VOLUME_INFORMATION</td>
<td align="center">卷信息：该属性仅存在于$Volume元文件中</td>
</tr>
<tr>
<td align="center">80 00 00 00</td>
<td align="center">$DATA</td>
<td align="center">文件数据：该属性为文件的数据内容</td>
</tr>
<tr>
<td align="center">90 00 00 00</td>
<td align="center">$INDEX_ROOT</td>
<td align="center">索引根</td>
</tr>
<tr>
<td align="center">A0 00 00 00</td>
<td align="center">$INDEX_ALLOCATION</td>
<td align="center">索引分配</td>
</tr>
<tr>
<td align="center">B0 00 00 00</td>
<td align="center">$BITMAP</td>
<td align="center">位图</td>
</tr>
<tr>
<td align="center">C0 00 00 00</td>
<td align="center">$SYMBOLIC_LINK</td>
<td align="center">在早期的NTFS v1.2中为符号链接</td>
</tr>
<tr>
<td align="center">C0 00 00 00</td>
<td align="center">$REPARSE_POINT</td>
<td align="center">重解析点</td>
</tr>
<tr>
<td align="center">D0 00 00 00</td>
<td align="center">$EA_INFORMATION</td>
<td align="center">扩充属性信息</td>
</tr>
<tr>
<td align="center">E0 00 00 00</td>
<td align="center">$EA</td>
<td align="center">扩充属性</td>
</tr>
<tr>
<td align="center">F0 00 00 00</td>
<td align="center">$PROPERTY_SET</td>
<td align="center">早期的NTFS v1.2中才有</td>
</tr>
<tr>
<td align="center">00 10 00 00</td>
<td align="center">$LOGGED_UTILITY_STREAM</td>
<td align="center">EFS加密属性：该属性主要用于存储实现EFS加密的有关加密信息，如合法用户列表、解码密钥等</td>
</tr>
</tbody></table>
<p>每一个属性都可以分为两个部分：属性头和属性体。</p>
<p><img src="https://s2.loli.net/2022/05/02/WjGfFI3qTPlkmDs.png" alt="image-20220502082918303"></p>
<p>如果一个属性的属性体太大而不能存放在只有1KB大小的MFT文件记录中，那么，系统将从MFT之外为之分配区域。这些区域通常称为Data Run（数据流），它们可用来存储属性体。如果属性体是不连续的，NTFS将会分配多个Data Run，以便用来管理不连续的数据。这种属性体存储在Data Run中而不是在MFT文件记录中的属性称为非常驻属性（Nonresident Attribute）。</p>
<h4 id="属性的属性头"><a href="#属性的属性头" class="headerlink" title="属性的属性头"></a>属性的属性头</h4><p>每个属性都有一个属性头，这个属性头包含了一些该属性的重要信息，如属性类型、属性大小、名字及是否为常驻属性等。</p>
<p>一个属性根据其是否常驻和是否有属性名，可以排列组合成四种不同的情况</p>
<ol>
<li>常驻没有属性名</li>
<li>常驻有属性名</li>
<li>非常驻没有属性名</li>
<li>非常驻有属性名</li>
</ol>
<h5 id="1-常驻没有属性名的属性头结构"><a href="#1-常驻没有属性名的属性头结构" class="headerlink" title="1.常驻没有属性名的属性头结构"></a>1.常驻没有属性名的属性头结构</h5><center><b>常驻没有属性名的属性头结构</b></center>

<table>
<thead>
<tr>
<th align="center">字节偏移</th>
<th align="center">字段长度（字节）</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0x00</td>
<td align="center">4</td>
<td align="center">属性类型（如10H、30H等类型）</td>
</tr>
<tr>
<td align="center">0x04</td>
<td align="center">4</td>
<td align="center">包括属性头在内的本属性的长度（字节）</td>
</tr>
<tr>
<td align="center">0x08</td>
<td align="center">1</td>
<td align="center">是否为常驻属性（00表示常驻，01H表示非常驻）</td>
</tr>
<tr>
<td align="center">0x09</td>
<td align="center">1</td>
<td align="center">属性名长度（为0表示没有属性名）</td>
</tr>
<tr>
<td align="center">0x0A</td>
<td align="center">2</td>
<td align="center">属性名的开始偏移（没有属性名）</td>
</tr>
<tr>
<td align="center">0x0C</td>
<td align="center">2</td>
<td align="center">压缩、加密、稀疏标志：为0001H表示该属性是被压缩了的；为4000H表示该属性是被加密了的；为8000H表示该属性是稀疏的［NTFS下压缩文件的第二种压缩类型被称为Sparse File（稀疏文件）］</td>
</tr>
<tr>
<td align="center">0x0E</td>
<td align="center">2</td>
<td align="center">属性ID</td>
</tr>
<tr>
<td align="center">0x10</td>
<td align="center">4</td>
<td align="center">属性体的长度（L）</td>
</tr>
<tr>
<td align="center">0x14</td>
<td align="center">2</td>
<td align="center">属性体的开始偏移</td>
</tr>
<tr>
<td align="center">0x16</td>
<td align="center">1</td>
<td align="center">索引标志</td>
</tr>
<tr>
<td align="center">0x17</td>
<td align="center">1</td>
<td align="center">无意义</td>
</tr>
<tr>
<td align="center">0x18</td>
<td align="center">L</td>
<td align="center">该属性体的内容</td>
</tr>
</tbody></table>
<p>以下图为例子进行讲解</p>
<p><img src="https://s2.loli.net/2022/05/02/TLafDUrd8bE74SY.png" alt="image-20220502084058407"></p>
<p>偏移00H～03H的4个字节为十六进制值“10 00 00 00”，表示此属性是10H类型的属性，即$STANDARD_INFORMATION属性，称为标准信息属性；</p>
<p>偏移04H～07H的4个字节为包括属性头在内的属性长度，这里为十六进制值“60 00 00 00”，也就是说该属性总长度为60H；</p>
<p>偏移08H为非常驻属性标志，“00”表示为常驻属性，10H类型的总是常驻的，所以该字节总为00H；</p>
<p>偏移09H为属性名的长度，此处为十六进制数“00”，表示该属性没有属性名；</p>
<p>偏移0AH～0BH的两个字节为该属性名开始的偏移，此处为十六进制数“18 00”，对于没有属性名的属性，该值无意义；</p>
<p>偏移0CH～0DH的两个字节为属性标志，表示此属性是否是压缩、加密等，为“0000H”表示不是压缩、加密属性，只有非常驻的80H属性（数据属性）此处才可能非0000H；</p>
<p>偏移0EH～0FH为属性ID，此处为十六进制数“00 00”；</p>
<p>偏移10H～13H为属性体长度，此处为十六进制数“48 00 00 00”，也就是说属性体长度为48H；</p>
<p>偏移14H～15H为该属性体开始的偏移，此处为十六进制数“18 00”，表示属性体开始的偏移为18H，这也是属性头的长度；</p>
<p>偏移16H为索引标志，此处为“00”；</p>
<p>偏移17H并没有实际意义，此处为“00”；</p>
<p>偏移18H～98H的48H个字节是属性体的内容，其具体含义将在后文中分析。</p>
<h5 id="2-常驻有属性名的属性头结构"><a href="#2-常驻有属性名的属性头结构" class="headerlink" title="2.常驻有属性名的属性头结构"></a>2.常驻有属性名的属性头结构</h5><center><b>常驻有属性名的属性头结构</b></center>

<table>
<thead>
<tr>
<th align="center">字节偏移</th>
<th align="center">字段长度（字节）</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0x00</td>
<td align="center">4</td>
<td align="center">属性类型（如90H、B0H等类型）</td>
</tr>
<tr>
<td align="center">0x04</td>
<td align="center">4</td>
<td align="center">包括属性头在内的本属性的长度（字节）</td>
</tr>
<tr>
<td align="center">0x08</td>
<td align="center">1</td>
<td align="center">是否为常驻属性（00表示常驻，01H表示非常驻）</td>
</tr>
<tr>
<td align="center">0x09</td>
<td align="center">1</td>
<td align="center">属性名长度（N）</td>
</tr>
<tr>
<td align="center">0x0A</td>
<td align="center">2</td>
<td align="center">属性名开始的偏移</td>
</tr>
<tr>
<td align="center">0x0C</td>
<td align="center">2</td>
<td align="center">压缩、加密、稀疏标志</td>
</tr>
<tr>
<td align="center">0x0E</td>
<td align="center">2</td>
<td align="center">属性ID</td>
</tr>
<tr>
<td align="center">0x10</td>
<td align="center">4</td>
<td align="center">属性体的长度（L）</td>
</tr>
<tr>
<td align="center">0x14</td>
<td align="center">2</td>
<td align="center">属性体的开始偏移</td>
</tr>
<tr>
<td align="center">0x16</td>
<td align="center">1</td>
<td align="center">索引标志</td>
</tr>
<tr>
<td align="center">0x17</td>
<td align="center">1</td>
<td align="center">无意义</td>
</tr>
<tr>
<td align="center">0x18</td>
<td align="center">2N</td>
<td align="center">属性的名字</td>
</tr>
<tr>
<td align="center">2N＋0x18</td>
<td align="center">L</td>
<td align="center">属性体的内容</td>
</tr>
</tbody></table>
<h5 id="3-非常驻没有属性名的属性头结构"><a href="#3-非常驻没有属性名的属性头结构" class="headerlink" title="3.非常驻没有属性名的属性头结构"></a>3.非常驻没有属性名的属性头结构</h5><table>
<thead>
<tr>
<th>字节偏移</th>
<th>字段长度（字节）</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>0x00</td>
<td>4</td>
<td>属性类型（如20H、80H等类型）</td>
</tr>
<tr>
<td>0x04</td>
<td>4</td>
<td>包括属性头在内的本属性的长度（字节）</td>
</tr>
<tr>
<td>0x08</td>
<td>1</td>
<td>是否为常驻属性（为01表示该属性为非常驻属性）</td>
</tr>
<tr>
<td>0x09</td>
<td>1</td>
<td>属性名长度（为0表示没有属性名）</td>
</tr>
<tr>
<td>0x0A</td>
<td>2</td>
<td>属性名开始的偏移（没有属性名）</td>
</tr>
<tr>
<td>0x0C</td>
<td>2</td>
<td>压缩、加密、稀疏标志</td>
</tr>
<tr>
<td>0x0E</td>
<td>2</td>
<td>属性ID</td>
</tr>
<tr>
<td>0x10</td>
<td>8</td>
<td>属性体的起始虚拟簇号（VCN）</td>
</tr>
<tr>
<td>0x18</td>
<td>8</td>
<td>属性体的结束虚拟簇号</td>
</tr>
<tr>
<td>0x20</td>
<td>2</td>
<td>Run List（Run即Data Run，是一个在逻辑簇号上连续的区域，它是不存储在MFT中的数据）信息的偏移地址</td>
</tr>
<tr>
<td>0x22</td>
<td>2</td>
<td>压缩单位大小（2x簇，如果为0表示未压缩）</td>
</tr>
<tr>
<td>0x24</td>
<td>4</td>
<td>无意义</td>
</tr>
<tr>
<td>0x28</td>
<td>8</td>
<td>属性体的分配大小［该属性体占的大小，这个属性体大小是该属性体所有的簇所占的空间大小（字节）］</td>
</tr>
<tr>
<td>0x30</td>
<td>8</td>
<td>属性体的实际大小（因为属性体长度不一定正好占满所有簇）</td>
</tr>
<tr>
<td>0x38</td>
<td>8</td>
<td>属性体的初始大小</td>
</tr>
<tr>
<td>0x40</td>
<td></td>
<td>属性的Run List信息，它记录了属性体开始的簇号、簇数等信息</td>
</tr>
</tbody></table>
<h5 id="4-非常驻有属性名的属性头结构"><a href="#4-非常驻有属性名的属性头结构" class="headerlink" title="4.非常驻有属性名的属性头结构"></a>4.非常驻有属性名的属性头结构</h5><table>
<thead>
<tr>
<th>字节偏移</th>
<th>字段长度（字节）</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>0x00</td>
<td>4</td>
<td>属性类型（如80H、A0H等类型）</td>
</tr>
<tr>
<td>0x04</td>
<td>4</td>
<td>包括属性头在内的本属性的长度（字节）</td>
</tr>
<tr>
<td>0x08</td>
<td>1</td>
<td>是否为常驻属性（为01表示该属性为非常驻属性）</td>
</tr>
<tr>
<td>0x09</td>
<td>1</td>
<td>属性名长度（N）</td>
</tr>
<tr>
<td>0x0A</td>
<td>2</td>
<td>属性名开始的偏移</td>
</tr>
<tr>
<td>0x0C</td>
<td>2</td>
<td>压缩、加密、稀疏标志</td>
</tr>
<tr>
<td>0x0E</td>
<td>2</td>
<td>属性ID</td>
</tr>
<tr>
<td>0x10</td>
<td>8</td>
<td>属性体的起始虚拟簇号（VCN）</td>
</tr>
<tr>
<td>0x18</td>
<td>8</td>
<td>属性体的结束虚拟簇号</td>
</tr>
<tr>
<td>0x20</td>
<td>2</td>
<td>Run List（Run即Data Run，是一个在逻辑簇号上连续的区域，它是不存储在MFT中的数据）信息的偏移地址</td>
</tr>
<tr>
<td>0x22</td>
<td>2</td>
<td>压缩单位大小（2x簇，如果为0表示未压缩）</td>
</tr>
<tr>
<td>0x24</td>
<td>4</td>
<td>无意义</td>
</tr>
<tr>
<td>0x28</td>
<td>8</td>
<td>属性体的分配大小［该属性体占的大小，这个属性体大小是该属性体所有的簇所占的空间大小（字节）］</td>
</tr>
<tr>
<td>0x30</td>
<td>8</td>
<td>属性体的实际大小（因为属性体长度不一定正好占满所有簇）</td>
</tr>
<tr>
<td>0x38</td>
<td>8</td>
<td>属性体的初始大小</td>
</tr>
<tr>
<td>0x40</td>
<td>2N</td>
<td>该属性的属性名</td>
</tr>
<tr>
<td>2N＋0x40</td>
<td></td>
<td>属性的Run List信息，它记录了属性体开始的簇号、簇数等信息</td>
</tr>
</tbody></table>
<h2 id="10H（-STANDARD-INFORMATION）属性分析"><a href="#10H（-STANDARD-INFORMATION）属性分析" class="headerlink" title="10H（$STANDARD_INFORMATION）属性分析"></a>10H（$STANDARD_INFORMATION）属性分析</h2><p><a target="_blank" rel="noopener" href="https://www.dgxue.com/huifu/tag/10h/">10H</a>类型属性即$STANDARD_INFORMATION属性，它包含文件的一些基本信息，如文件的传统属性、文件的创建时间和最后修改时间、有多少目录指向该文件（即其硬连接数）等。</p>
<center><b>10H属性体的含义</b></center>

<table>
<thead>
<tr>
<th>字节偏移</th>
<th>字段长度（字节）</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>～</td>
<td>～</td>
<td>属性头（已分析过）</td>
</tr>
<tr>
<td>0x00</td>
<td>8</td>
<td>文件创建时间</td>
</tr>
<tr>
<td>0x08</td>
<td>8</td>
<td>文件最后修改时间</td>
</tr>
<tr>
<td>0x10</td>
<td>8</td>
<td>MFT修改时间</td>
</tr>
<tr>
<td>0x18</td>
<td>8</td>
<td>文件最后访问时间</td>
</tr>
<tr>
<td>0x20</td>
<td>4</td>
<td>传统文件属性</td>
</tr>
<tr>
<td>0x24</td>
<td>4</td>
<td>最大版本数：为0则表示版本是没有的</td>
</tr>
<tr>
<td>0x28</td>
<td>4</td>
<td>版本数：如果偏移24H处为0则此处也为0</td>
</tr>
<tr>
<td>0x2C</td>
<td>4</td>
<td>分类ID（一个双向的类索引）</td>
</tr>
<tr>
<td>0x30</td>
<td>4</td>
<td>所有者ID：表示文件的所有者，是访问文件配额$Quota中$O和$Q索引的关键字，如果为0则表示没有设置配额</td>
</tr>
<tr>
<td>0x34</td>
<td>4</td>
<td>安全ID：是文件$Secure中$SII索引和$SDS数据流的关键字，注意不要与安全标识相混淆</td>
</tr>
<tr>
<td>0x38</td>
<td>8</td>
<td>配额管理：配额占用情况，它是文件所有流所占用的总字节数，为0表示末使用磁盘配额</td>
</tr>
<tr>
<td>0x40</td>
<td>8</td>
<td>更新序列号（USN）：文件最后的根新序列号，它是进入元数据文件$UsnJrnl直接的索引，如果为0，则表示没有USN日志</td>
</tr>
</tbody></table>
<h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><ol>
<li><p>64为时间区域说明</p>
<p><a target="_blank" rel="noopener" href="https://www.dgxue.com/huifu/tag/ntfs/">NTFS</a>文件时间用长达64位来表示文件的某种时间（含日期），而在FAT文件系统中只用了32位来表示文件的时间和日期，NTFS文件系统中的文件时间的64位的数据表示的是有多少个100个10亿分之一秒（100-nanosecond也就是千万分之一秒）。</p>
</li>
<li><p>传统文件属性</p>
</li>
</ol>
<center><b>传统属性表</b></center>

<table>
<thead>
<tr>
<th align="center">标志</th>
<th align="center">二进制位</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0x0001</td>
<td align="center">0000 0000　0000 0001</td>
<td align="center">只读</td>
</tr>
<tr>
<td align="center">0x0002</td>
<td align="center">0000 0000　0000 0010</td>
<td align="center">隐含</td>
</tr>
<tr>
<td align="center">0x0004</td>
<td align="center">0000 0000　0000 0100</td>
<td align="center">系统</td>
</tr>
<tr>
<td align="center">0x0020</td>
<td align="center">0000 0000　0010 0000</td>
<td align="center">存档</td>
</tr>
<tr>
<td align="center">0x0040</td>
<td align="center">0000 0000　0100 0000</td>
<td align="center">设备</td>
</tr>
<tr>
<td align="center">0x0080</td>
<td align="center">0000 0000　1000 0000</td>
<td align="center">常规</td>
</tr>
<tr>
<td align="center">0x0100</td>
<td align="center">0000 0001　0000 0000</td>
<td align="center">临时</td>
</tr>
<tr>
<td align="center">0x0200</td>
<td align="center">0000 0010　0000 0000</td>
<td align="center">稀疏文件</td>
</tr>
<tr>
<td align="center">0x0400</td>
<td align="center">0000 0100　0000 0000</td>
<td align="center">重解析点</td>
</tr>
<tr>
<td align="center">0x0800</td>
<td align="center">0000 1000　0000 0000</td>
<td align="center">压缩</td>
</tr>
<tr>
<td align="center">0x1000</td>
<td align="center">0001 0000　0000 0000</td>
<td align="center">脱机</td>
</tr>
<tr>
<td align="center">0x2000</td>
<td align="center">0010 0000　0000 0000</td>
<td align="center">未编入索引</td>
</tr>
<tr>
<td align="center">0x4000</td>
<td align="center">0100 0000　0000 0000</td>
<td align="center">加密</td>
</tr>
</tbody></table>
<h2 id="20H（-ATTRIBUTE-LIST）属性分析"><a href="#20H（-ATTRIBUTE-LIST）属性分析" class="headerlink" title="20H（$ATTRIBUTE_LIST）属性分析"></a>20H（$ATTRIBUTE_LIST）属性分析</h2><p><a target="_blank" rel="noopener" href="https://www.dgxue.com/huifu/tag/20h/">20H</a>类型属性是$ATTRIBUTE_LIST属性，即属性列表，当一个文件需要多个文件记录时，用来描述文件的属性列表。</p>
<p>如果文件记录里的某个属性大到该文件记录不能把该属性完全存储时，系统会采取用Run List来存储这些属性的属性体，这种属性被称为非常驻属性。但是如果这样仍然没有足够的空间时，那么就需要属性列表了。不能完全放进该文件记录中的属性会被放置在一个新的文件记录中，而属性列表属性描述了应该如何找到这个新的文件记录。</p>
<center><b>20H属性描述表</b></center>

<table>
<thead>
<tr>
<th align="center">字节偏移</th>
<th align="center">字段长度（字节）</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">～</td>
<td align="center">～</td>
<td align="center">标准属性头（已分析过）</td>
</tr>
<tr>
<td align="center">0x00</td>
<td align="center">4</td>
<td align="center">类型</td>
</tr>
<tr>
<td align="center">0x04</td>
<td align="center">2</td>
<td align="center">记录长度</td>
</tr>
<tr>
<td align="center">0x06</td>
<td align="center">1</td>
<td align="center">属性名长度（N，为0表示没有属性名）</td>
</tr>
<tr>
<td align="center">0x07</td>
<td align="center">1</td>
<td align="center">属性名偏移（如果没有属性名，则指向属性内容）</td>
</tr>
<tr>
<td align="center">0x08</td>
<td align="center">8</td>
<td align="center">起始VCN（属性常驻时为0）</td>
</tr>
<tr>
<td align="center">0x10</td>
<td align="center">8</td>
<td align="center">属性的基本文件记录中的文件参考号（所有MFT的文件都有一个文件索引号，引用到这个文件参考号，等价于引用这个文件记录，这个参考号在文件记录头中有定义）</td>
</tr>
<tr>
<td align="center">0x18</td>
<td align="center">2</td>
<td align="center">属性ID（每个属性都有一个唯一的ID号）</td>
</tr>
<tr>
<td align="center">0x1A</td>
<td align="center">2N</td>
<td align="center">Unicode属性名（如果有属性名）</td>
</tr>
</tbody></table>
<p>20H类型的属性很少见，但有四种情况让系统可能需要20H类型的属性，这四种情况是：</p>
<p>①文件有很多的硬连接（即有很多的文件名属性存在）；</p>
<p>②文件有很多碎片，以至文件记录中记录不了这么多的Data Run（数据流）；</p>
<p>③属性中有很复杂的安全描述（不适用于NTFS v4.0以上版本）；</p>
<p>④属性中有很多的命名流，如数据流。</p>
<p>20H属性可以是常驻的，也可以是非常驻的.</p>
<center>常驻的20H属性</center>

<p><img src="https://s2.loli.net/2022/05/02/N8IolqMjacRW5gT.png" alt="image-20220502090939456"></p>
<center>非常驻的20H属性</center>

<p><img src="https://s2.loli.net/2022/05/02/4RC8xo91FTKGmVW.png" alt="image-20220502091102191"></p>
<h2 id="30H（-FILE-NAME）属性分析"><a href="#30H（-FILE-NAME）属性分析" class="headerlink" title="30H（$FILE_NAME）属性分析"></a>30H（$FILE_NAME）属性分析</h2><p>30H类型属性，即$FILE_NAME属性，该属性用于存储文件名，它总是常驻属性。它最少68字节，最大578字节，可容纳最大255个Unicode字符的文件名长度。</p>
<center>30H属性描述表</center>

<table>
<thead>
<tr>
<th align="center">字节偏移</th>
<th align="center">字段长度（字节）</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">～</td>
<td align="center">～</td>
<td align="center">标准属性头（已分析过）</td>
</tr>
<tr>
<td align="center">0x00</td>
<td align="center">8</td>
<td align="center">父目录的文件参考号（即父目录的基本文件记录号，分为两个部分，前6个字节48位为父目录的文件记录号，后2个字节为序列号）</td>
</tr>
<tr>
<td align="center">0x08</td>
<td align="center">8</td>
<td align="center">文件创建时间</td>
</tr>
<tr>
<td align="center">0x10</td>
<td align="center">8</td>
<td align="center">文件修改时间</td>
</tr>
<tr>
<td align="center">0x18</td>
<td align="center">8</td>
<td align="center">MFT修改时间</td>
</tr>
<tr>
<td align="center">0x20</td>
<td align="center">8</td>
<td align="center">文件最后访问时间</td>
</tr>
<tr>
<td align="center">0x28</td>
<td align="center">8</td>
<td align="center">文件分配大小</td>
</tr>
<tr>
<td align="center">0x30</td>
<td align="center">8</td>
<td align="center">文件实际大小</td>
</tr>
<tr>
<td align="center">0x38</td>
<td align="center">4</td>
<td align="center">标志，如目录、压缩、隐藏等</td>
</tr>
<tr>
<td align="center">0x3C</td>
<td align="center">4</td>
<td align="center">EAs（扩展属性）和Reparse（重解析点）使用</td>
</tr>
<tr>
<td align="center">0x40</td>
<td align="center">1</td>
<td align="center">文件名长度（字符数L）</td>
</tr>
<tr>
<td align="center">0x41</td>
<td align="center">1</td>
<td align="center">文件名命名空间（Filename Namespace）</td>
</tr>
<tr>
<td align="center">0x42</td>
<td align="center">2L</td>
<td align="center">Unicode文件名</td>
</tr>
</tbody></table>
<p>NTFS通过为一个文件创建多个文件名属性的方式实现了POSIX（可移植操作系统接口）式的硬连接，每个文件名属性都有它自己的详细资料和父目录参考号。当一个硬连接文件删除时，就从文件记录中删除掉这个文件名，当最后一个连接也删除时，文件就真正的删除了。</p>
<p>如果文件有EAs（扩展属性），则EA域将包含有缓存所需要的空间。</p>
<p>如果文件是个重解析点，则会在重解析点域给出它的类型，这在后文谈重解析点属性时有详细说明。</p>
<h3 id="30H属性的文件标志含义"><a href="#30H属性的文件标志含义" class="headerlink" title="30H属性的文件标志含义"></a>30H属性的文件标志含义</h3><center><b>30H属性文件标志字节含义</b><center>

<table>
<thead>
<tr>
<th align="center">标志</th>
<th align="center">二进制位</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0x0001</td>
<td align="center">0000 0000　0000 0001</td>
<td align="center">只读</td>
</tr>
<tr>
<td align="center">0x0002</td>
<td align="center">0000 0000　0000 0010</td>
<td align="center">隐含</td>
</tr>
<tr>
<td align="center">0x0004</td>
<td align="center">0000 0000　0000 0100</td>
<td align="center">系统</td>
</tr>
<tr>
<td align="center">0x0020</td>
<td align="center">0000 0000　0010 0000</td>
<td align="center">存档</td>
</tr>
<tr>
<td align="center">0x0040</td>
<td align="center">0000 0000　0100 0000</td>
<td align="center">设备</td>
</tr>
<tr>
<td align="center">0x0080</td>
<td align="center">0000 0000　1000 0000</td>
<td align="center">常规</td>
</tr>
<tr>
<td align="center">0x0100</td>
<td align="center">0000 0001　0000 0000</td>
<td align="center">临时</td>
</tr>
<tr>
<td align="center">0x0200</td>
<td align="center">0000 0010　0000 0000</td>
<td align="center">稀疏文件</td>
</tr>
<tr>
<td align="center">0x0400</td>
<td align="center">0000 0100　0000 0000</td>
<td align="center">重解析点</td>
</tr>
<tr>
<td align="center">0x0800</td>
<td align="center">0000 1000　0000 0000</td>
<td align="center">压缩</td>
</tr>
<tr>
<td align="center">0x1000</td>
<td align="center">0001 0000　0000 0000</td>
<td align="center">脱机</td>
</tr>
<tr>
<td align="center">0x2000</td>
<td align="center">0010 0000　0000 0000</td>
<td align="center">未编入索引</td>
</tr>
<tr>
<td align="center">0x4000</td>
<td align="center">0100 0000　0000 0000</td>
<td align="center">加密</td>
</tr>
<tr>
<td align="center">0x10000000</td>
<td align="center">0001 0000　0000 0000 （前2个字节）</td>
<td align="center">目录（从MFT文件记录中复制的相应的位）</td>
</tr>
<tr>
<td align="center">0x20000000</td>
<td align="center">0010 0000　0000 0000 （前2个字节）</td>
<td align="center">索引视图（从MFT文件记录中复制的相应的位）</td>
</tr>
</tbody></table>
<h3 id="30H属性的文件命名空间"><a href="#30H属性的文件命名空间" class="headerlink" title="30H属性的文件命名空间"></a>30H属性的文件命名空间</h3><p>可能的文件命名空间有</p>
<p>（1）该字节的值为“00”：POSIX（Portable Operating System Interface，可移植操作系统接口）</p>
<p>Windows 20000、Windows XP完全支持可移植操作系统接口POSIX 1003.1。在文件系统方面，NTFS实现了POSIX 1003.1的所有要求，例如：</p>
<p>①大小写敏感：在POSIX环境下，文件名是大小写敏感的，因而在POSIX命名空间ABC.TXT、Abc.txt、abc.txt并不是同一个文件。</p>
<p>②通过许可：当判定一个用户是否可以访问一个文件或者目录时，需要考虑路径上的所有目录的安全许可。</p>
<p>③文件改变时间：提供文件最后被访问的时间标记（这在10属性中定义）。</p>
<p>④硬连接：在不同的目录下不同文件名的两个文件指向相同的数据时，两个文件发生硬连接。</p>
<p>POSIX是最大的文件命名空间，它允许除了空字符（00H）和向前的斜线“&#x2F;”以外所有的Unicode字符集，最大的文件名长度为255，但是有一些特例，例如冒号“：”，在NTFS文件系统中是有效，但在Windows操作系统是不允许的。</p>
<p>（2）该字节的值为“01”：Win32</p>
<p>Win32是POSIX命名空间的一个子集，它使用除“”*&#x2F;：＜＞?|”之外的所有Unicode字符集，但注意名字不能够以“.”或空格结束。</p>
<p>（3）该字节的值为“02”：DOS</p>
<p>DOS是Win32命名空间的一个子集，只允许用大写字符，不能用空格，而且排除“”*＋，&#x2F;：；＜＝＞?\”等字符做文件名。注意其文件名一定是这样的：1～8个字符的文件名，然后是一个点“.”，然后是0～3个字符的扩展名。</p>
<p>（4）该字节的值为“03”：Win32 ＆ DOS</p>
<p>这种文件命名空间表示Win32和DOS文件名都是一样的（也就是说该文件只有一个符合DOS命名方式的文件名），因此这种文件名只有这一个文件名属性。</p>
<p>将POSIX或Win32文件名转换成DOS兼容文件名必须遵从以下步骤：</p>
<p>①除去所有的Unicode字符；</p>
<p>②除去除最后一个外的所有的“.”，且这最后一个“.”还不能是首字符；</p>
<p>③将所有的小写字符转换为大写；</p>
<p>④除去被禁止的字符；</p>
<p>⑤如果此时主文件名长度（即“.”之前的长度）大于8个字符，则除去第6个字符后的所有字符，其在其后补上两个字符“～1”；</p>
<p>⑥在“.”之后如果字符长度大于3，则只保留前3个字符；</p>
<p>⑦当这个文件名已经存在时，则把“～1”变成“～2”，如果依然存在则继续递增字符“～”后的数字。</p>
<h2 id="40H（-OBJECT-ID）属性分析"><a href="#40H（-OBJECT-ID）属性分析" class="headerlink" title="40H（$OBJECT_ID）属性分析"></a>40H（$OBJECT_ID）属性分析</h2><p><a target="_blank" rel="noopener" href="https://www.dgxue.com/huifu/tag/40h/">40H</a>类型属性即$OBJECT_ID属性，也就是对象ID，它是从Windows 2000开始引入的属性。每一个MFT记录都被指定一个唯一的GUID（全局ID，Windows为所有对象分配的一个全局唯一的数字标识，16字节长）。此外，记录还可能包含有一个所属卷ID、原始对象ID和域ID，这些都属于GUID，在NTFS文件系统中所提供的API就是通过这些ID对文件进行访问的，该属性最大不超过256字节。</p>
<center><b>40H属性描述表</b></center>

<table>
<thead>
<tr>
<th align="center">字节偏移</th>
<th align="center">字段长度（字节）</th>
<th align="center">名称</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">～</td>
<td align="center">～</td>
<td align="center">标准属性头</td>
<td align="center">（已经分析过）</td>
</tr>
<tr>
<td align="center">0x00</td>
<td align="center">16</td>
<td align="center">全局对象ID（GUID Object ID）</td>
<td align="center">指派给文件的一个唯一的ID号</td>
</tr>
<tr>
<td align="center">0x10</td>
<td align="center">16</td>
<td align="center">全局原始卷ID（GUID Birth Volume ID）</td>
<td align="center">创建文件的卷的ID（永不变化）</td>
</tr>
<tr>
<td align="center">0x20</td>
<td align="center">16</td>
<td align="center">全局原始对象ID（GUID Birth Object ID）</td>
<td align="center">原始对象ID（它是曾经指派给本文件记录的第一个对象ID，如果由于某种原因导致对象ID发生变化，此值就可以反映出对象ID的原始值）</td>
</tr>
<tr>
<td align="center">0x30</td>
<td align="center">16</td>
<td align="center">全局域ID（GUID Domain ID）</td>
<td align="center">创建对象的域ID</td>
</tr>
</tbody></table>
<p>40H类型的属性绝大多数只有16字节，也就是只有一个全局ID，即对象ID，如果原始卷ID、原始对象ID和域ID没有被使用，它也有可能在属性中占用了空间，但是其值可能是零。</p>
<h2 id="50H（-SECURITY-DESCRIPTOR）属性分析"><a href="#50H（-SECURITY-DESCRIPTOR）属性分析" class="headerlink" title="50H（$SECURITY_DESCRIPTOR）属性分析"></a>50H（$SECURITY_DESCRIPTOR）属性分析</h2><p>50H类型属性即$SECURITY_DESCRIPTOR属性，也就是安全描述符，主要用于保护文件以防止没有授权的访问，但Windows 2000&#x2F;XP中已将安全描述符存放在$Secure元数据中，以便于共享（早期的NTFS将其与文件目录一起存放，不便于共享）。</p>
<center><b>50H属性描述表</b></center>

<p><img src="https://s2.loli.net/2022/05/02/jTpaJnAvgKbF3dV.jpg" alt="50H（$SECURITY_DESCRIPTOR）属性分析-数据恢复迷"></p>
<p>在一个标准属性头后是一个50H特有的属性头，其后跟一个或两个ACL（Access Control List，访问控制列表）和两个SID（Security Identifier，安全ID）。</p>
<p>ACL即访问控制列表，它赋予或拒绝特定用户或组访问某个对象的权限的对象安全描述符的组成部分。只有某个对象的所有者才可以更改ACL中赋予或拒绝的权限，这样，此对象的所有者就可以自由访问该对象。</p>
<p>SID即安全标识符，它是用来识别用户、组和计算机账户的不同长度的数据结构。在第一次创建该账户时，将给网络上的每一个账户发布一个唯一的SID。Windows中的内部进程将引用账户的SID而不是账户的用户名或组名。</p>
<p>第一个ACL（Access Control Entry）包括审核信息，即访问对象时要审核的组和用户账户，但也可能没有；第二个ACL包括权限，即授予的每个组或用户的权限的每个访问事件的成功或失败属性。</p>
<p>每一个ACL可能包括一个或多个ACE，ACE即访问控制项，它是授予用户或组权限的ACL中的一个项目。ACE也是对象的系统访问控制列表（SACL）中的项目，该列表指定用户或组要审核的安全事件，每一个ACE包括一个SID。</p>
<p>SACL是表示部分对象的安全描述符的列表，该安全描述符指定了每个用户或组的哪个事件将被审核。审核事件的例子是文件访问、登录尝试和系统关闭。</p>
<p>最后两个SID表示对象的所有者即用户和组。</p>
<h3 id="50H属性中属性头的结构"><a href="#50H属性中属性头的结构" class="headerlink" title="50H属性中属性头的结构"></a>50H属性中属性头的结构</h3><table>
<thead>
<tr>
<th align="center">字节偏移</th>
<th align="center">字段长度（字节）</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0x00</td>
<td align="center">1</td>
<td align="center">头1（通常总是01）</td>
</tr>
<tr>
<td align="center">0x01</td>
<td align="center">1</td>
<td align="center">头2（通常总是00）</td>
</tr>
<tr>
<td align="center">0x02</td>
<td align="center">1</td>
<td align="center">头3（通常为0x04或0x14，前者表示无审计，后者表示有审计）</td>
</tr>
<tr>
<td align="center">0x03</td>
<td align="center">1</td>
<td align="center">头4（通常总是80H）</td>
</tr>
<tr>
<td align="center">0x04</td>
<td align="center">4</td>
<td align="center">用户SID的偏移</td>
</tr>
<tr>
<td align="center">0x08</td>
<td align="center">4</td>
<td align="center">组SID的偏移</td>
</tr>
<tr>
<td align="center">0x0C</td>
<td align="center">4</td>
<td align="center">ACL审核</td>
</tr>
<tr>
<td align="center">0x10</td>
<td align="center">4</td>
<td align="center">ACL权限</td>
</tr>
</tbody></table>
<h3 id="50H属性中ACL的结构"><a href="#50H属性中ACL的结构" class="headerlink" title="50H属性中ACL的结构"></a>50H属性中ACL的结构</h3><table>
<thead>
<tr>
<th align="center">字节偏移</th>
<th align="center">字段长度（字节）</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0x00</td>
<td align="center">1</td>
<td align="center">ACL版本</td>
</tr>
<tr>
<td align="center">0x01</td>
<td align="center">1</td>
<td align="center">常为“00”，无意义</td>
</tr>
<tr>
<td align="center">0x02</td>
<td align="center">2</td>
<td align="center">ACL长度</td>
</tr>
<tr>
<td align="center">0x04</td>
<td align="center">2</td>
<td align="center">ACE合计</td>
</tr>
<tr>
<td align="center">0x06</td>
<td align="center">2</td>
<td align="center">常为“00 00”，无意义</td>
</tr>
</tbody></table>
<h3 id="50H属性中ACE的结构"><a href="#50H属性中ACE的结构" class="headerlink" title="50H属性中ACE的结构"></a>50H属性中ACE的结构</h3><center><b>ACE描述表</b></center>

<table>
<thead>
<tr>
<th align="center">字节偏移</th>
<th align="center">字段长度（字节）</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0x00</td>
<td align="center">1</td>
<td align="center">类型</td>
</tr>
<tr>
<td align="center">0x01</td>
<td align="center">1</td>
<td align="center">标志</td>
</tr>
<tr>
<td align="center">0x02</td>
<td align="center">2</td>
<td align="center">大小</td>
</tr>
<tr>
<td align="center">0x04</td>
<td align="center">4</td>
<td align="center">访问掩码</td>
</tr>
<tr>
<td align="center">0x08</td>
<td align="center">V</td>
<td align="center">SID</td>
</tr>
</tbody></table>
<center><b>ACE的标志</b></center>

<table>
<thead>
<tr>
<th align="center">值</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0x00</td>
<td align="center">访问允许</td>
</tr>
<tr>
<td align="center">0x01</td>
<td align="center">访问拒绝</td>
</tr>
<tr>
<td align="center">0x02</td>
<td align="center">系统审核</td>
</tr>
</tbody></table>
<center><b>目录的ACE标志描述</b></center>

<table>
<thead>
<tr>
<th align="center">值</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0x01</td>
<td align="center">对象继承的ACE</td>
</tr>
<tr>
<td align="center">0x02</td>
<td align="center">容器继承的ACE</td>
</tr>
<tr>
<td align="center">0x04</td>
<td align="center">不传播继承的ACE’</td>
</tr>
<tr>
<td align="center">0x08</td>
<td align="center">只继承ACE</td>
</tr>
</tbody></table>
<center><b>系统审核的ACL标志描述</b></center>

<table>
<thead>
<tr>
<th align="center">值</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0x40</td>
<td align="center">审核成功</td>
</tr>
<tr>
<td align="center">0x80</td>
<td align="center">审核失败</td>
</tr>
</tbody></table>
<center><b>ACL访问掩码</b>

<table>
<thead>
<tr>
<th align="center">位偏移</th>
<th align="center">含义</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0～15</td>
<td align="center">对象特殊访问权限</td>
<td align="center">读数据、执行、添加数据</td>
</tr>
<tr>
<td align="center">16～22</td>
<td align="center">标准访问权限</td>
<td align="center">删除、修改ACL、修改所有者</td>
</tr>
<tr>
<td align="center">23</td>
<td align="center">可以访问ACL</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">24～27</td>
<td align="center">保留</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">28</td>
<td align="center">所有（读、写、执行）</td>
<td align="center">所有事情</td>
</tr>
<tr>
<td align="center">29</td>
<td align="center">执行</td>
<td align="center">执行程序所需的所有权力</td>
</tr>
<tr>
<td align="center">30</td>
<td align="center">写</td>
<td align="center">写文件所需的所有权力</td>
</tr>
<tr>
<td align="center">31</td>
<td align="center">读</td>
<td align="center">读文件所需的所有权力</td>
</tr>
</tbody></table>
<h3 id="50H属性中SID的结构"><a href="#50H属性中SID的结构" class="headerlink" title="50H属性中SID的结构"></a>50H属性中SID的结构</h3><p>典型的SID形由’S-p-q-r-s-t-u-v’组成</p>
<center><b>SID结构</b>
</center>

<table>
<thead>
<tr>
<th align="center">S</th>
<th align="center">安全</th>
</tr>
</thead>
<tbody><tr>
<td align="center">p</td>
<td align="center">版本号（目前为1）</td>
</tr>
<tr>
<td align="center">q</td>
<td align="center">NT域，该数值占6个字节</td>
</tr>
<tr>
<td align="center">r～v</td>
<td align="center">NT子域（可能有几个这样的子域）</td>
</tr>
</tbody></table>
<center><b>SID在磁盘上的存储</b>

<p><img src="https://s2.loli.net/2022/05/02/zepGIBRcyE61sAD.jpg" alt="50H（$SECURITY_DESCRIPTOR）属性分析-数据恢复迷"></p>
<p>在S-1-5-21-646518322-1873620750-619646970-1110这个SID中，“S”是SID简称，“1”为版本号，“5”为标识授权，“21”为子授权，“646518322”为SA（Security Association，安全协会），“1873620750”为SA的域ID，“619646970”也是SA，“1110”为用户ID。</p>
<center><b>安全表示的组成部分</b>
</center>

<table>
<thead>
<tr>
<th align="center">标识授权</th>
<th align="center">缩写</th>
</tr>
</thead>
<tbody><tr>
<td align="center">无效SID</td>
<td align="center">S-1-0</td>
</tr>
<tr>
<td align="center">全球SID</td>
<td align="center">S-1-1</td>
</tr>
<tr>
<td align="center">本地SID</td>
<td align="center">S-1-2</td>
</tr>
<tr>
<td align="center">创建者SID</td>
<td align="center">S-1-3</td>
</tr>
<tr>
<td align="center">非唯一SID</td>
<td align="center">S-1-4</td>
</tr>
<tr>
<td align="center">NT SID</td>
<td align="center">S-1-5</td>
</tr>
</tbody></table>
<p>子授权中的R表示相关ID（Relative Identifiers），用以和标识授权一起组成知名SID</p>
<center><b>相关ID</b>
</center>

<p><img src="https://s2.loli.net/2022/05/02/JkAqCjsLguBOQGw.jpg" alt="50H（$SECURITY_DESCRIPTOR）属性分析-数据恢复迷"></p>
<center><b>常见知名域用户</b>
</center>

<table>
<thead>
<tr>
<th align="center">域用户</th>
<th align="center">代码</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Admin（管理员）</td>
<td align="center">500</td>
</tr>
<tr>
<td align="center">Guest（来宾）</td>
<td align="center">501</td>
</tr>
<tr>
<td align="center">Kerberos Target（安全验证用）</td>
<td align="center">502</td>
</tr>
</tbody></table>
<center><b>常见知名域组</b>
</center>

<table>
<thead>
<tr>
<th align="center">域组</th>
<th align="center">代码</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Admins（管理员组）</td>
<td align="center">512</td>
</tr>
<tr>
<td align="center">Users（用户组）</td>
<td align="center">513</td>
</tr>
<tr>
<td align="center">Guests（来宾组）</td>
<td align="center">514</td>
</tr>
<tr>
<td align="center">Computers（计算机组）</td>
<td align="center">515</td>
</tr>
<tr>
<td align="center">Controllers（控制员组）</td>
<td align="center">516</td>
</tr>
<tr>
<td align="center">Cert Admins（确定管理员组）</td>
<td align="center">517</td>
</tr>
<tr>
<td align="center">Schema Admins（计划管理员组）</td>
<td align="center">518</td>
</tr>
<tr>
<td align="center">Enterprise Admins（企业管理员组）</td>
<td align="center">519</td>
</tr>
<tr>
<td align="center">Policy Admins（策略管理员组）</td>
<td align="center">520</td>
</tr>
</tbody></table>
<center><b>常见知名域别名</b>

</center>

<table>
<thead>
<tr>
<th align="center">域别名</th>
<th align="center">代码</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Admins（管理员组）</td>
<td align="center">544</td>
</tr>
<tr>
<td align="center">Users（用户组）</td>
<td align="center">545</td>
</tr>
<tr>
<td align="center">Guests（来宾组）</td>
<td align="center">546</td>
</tr>
<tr>
<td align="center">Power Users（高级用户组）</td>
<td align="center">547</td>
</tr>
<tr>
<td align="center">Account Ops（账号操作）</td>
<td align="center">548</td>
</tr>
<tr>
<td align="center">System Ops（系统操作）</td>
<td align="center">549</td>
</tr>
<tr>
<td align="center">Print Ops（打印操作）</td>
<td align="center">550</td>
</tr>
<tr>
<td align="center">Backup Ops（备份操作）</td>
<td align="center">551</td>
</tr>
<tr>
<td align="center">Replicator（复制操作）</td>
<td align="center">552</td>
</tr>
<tr>
<td align="center">RAS Servers</td>
<td align="center">553</td>
</tr>
<tr>
<td align="center">Pre W2K Comp Access</td>
<td align="center">554</td>
</tr>
</tbody></table>
<center><b>SID的控制标志</b>

<table>
<thead>
<tr>
<th align="center">标志</th>
<th align="center">描述</th>
<th align="center">标志</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0x0001</td>
<td align="center">默认所有者</td>
<td align="center">0x0200</td>
<td align="center">SACL自动继承Req</td>
</tr>
<tr>
<td align="center">0x0002</td>
<td align="center">默认组</td>
<td align="center">0x00400</td>
<td align="center">DACL自动继承</td>
</tr>
<tr>
<td align="center">0x0004</td>
<td align="center">DACL存在</td>
<td align="center">0x0800</td>
<td align="center">SACL自动继承</td>
</tr>
<tr>
<td align="center">0x0008</td>
<td align="center">DACL默认值</td>
<td align="center">0x1000</td>
<td align="center">DACL保护</td>
</tr>
<tr>
<td align="center">0x0010</td>
<td align="center">SACL存在</td>
<td align="center">0x2000</td>
<td align="center">SACL保护</td>
</tr>
<tr>
<td align="center">0x0020</td>
<td align="center">SACL默认值</td>
<td align="center">0x4000</td>
<td align="center">RM控制有效</td>
</tr>
<tr>
<td align="center">0x0100</td>
<td align="center">DACL自动继承Req</td>
<td align="center">0x8000</td>
<td align="center">自相关标志</td>
</tr>
</tbody></table>
<p>其中默认所有者是一个布尔标志，设置时表示通过默认机制由所有者域来指示SID，而不是采用由最初的安全描述符所显式指定的SID。它将对所有者继承的处理方式产生影响。默认组的设置同默认所有者一样。</p>
<p>DACL存在是一个布尔标志，设置时表示安全描述包含一个自由的ACL。如果设置了该位，而安全描述的DACL域为空，则将此空ACL列入清单。</p>
<p>DACL（任意访问控制列表）默认值是一个布尔标志，设置时表示通过默认机制由DACL域来指示ACL，而不是由最初的安全描述指定ACL。它将对ACL继承的处理方式产生影响。如果DACL存在没有设置，则忽略该标志。</p>
<p>SACL存在是一个布尔标志，设置时表示安全描述包含一个由SACL域指定的系统ACL。如果设置了该位，而安全描述的SACL域为空，则将此空ACL（但确实存在）列入清单。</p>
<p>SACL默认值是一个布尔标志，设置时表示通过默认机制由SACL域来指示ACL，而不是由最初的安全描述指定ACL。它将对ACL继承的处理方式产生影响。如果SACL存在没有设置，则忽略该标志。</p>
<p>自相关标志是一个布尔标志，设置时表示安全描述是一个自相关表。在该表中，安全描述的所有域在内存中都是连续的，所有的指示域都明确的用从相对安全描述的起始处的偏移来表示。</p>
<p>在NTFS 4.0以上版本中，所有的安全描述都集中存储在$Secure文件中，通过标准信息属性中的安全ID属性来找到正确的安全描述。每个唯一的安全描述都指派一个唯一的安全标识（security_id，但不是SID），卷中的security_id是唯一的，作为$SII索引的一个索引来使用，并存储为$SDS的数据流属性。$SII索引按security_id的升序进行存储。</p>
<p>50H属性可以常驻，也可以非常驻。</p>
<h2 id="60H（-VOLUME-NAME）属性分析"><a href="#60H（-VOLUME-NAME）属性分析" class="headerlink" title="60H（$VOLUME_NAME）属性分析"></a>60H（$VOLUME_NAME）属性分析</h2><p><a target="_blank" rel="noopener" href="https://www.dgxue.com/huifu/tag/60h/">60H</a>类型属性即$VOLUME_NAME，这个属性只是简单的包含卷的名称。它最小占两字节，最大占256字节，所以卷名最长为127个Unicode字符（必须留一个Unicode字符作为结束标志）。</p>
<h3 id="60H类型属性描述"><a href="#60H类型属性描述" class="headerlink" title="60H类型属性描述"></a>60H类型属性描述</h3><table>
<thead>
<tr>
<th align="center">字节偏移</th>
<th align="center">字段长度（字节）</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">～</td>
<td align="center">～</td>
<td align="center">标准属性头（已分析过）</td>
</tr>
<tr>
<td align="center">0x00</td>
<td align="center"></td>
<td align="center">Unicode卷名</td>
</tr>
</tbody></table>
<p>在60H属性中，通过Unicode字符为空来表示卷名结束，它的长度属性存储在头部中，卷序列号存储在$Boot元文件中</p>
<h2 id="70H（-VOLUME-INFORMATION）属性分析"><a href="#70H（-VOLUME-INFORMATION）属性分析" class="headerlink" title="70H（$VOLUME_INFORMATION）属性分析"></a>70H（$VOLUME_INFORMATION）属性分析</h2><p><a target="_blank" rel="noopener" href="https://www.dgxue.com/huifu/tag/70h/">70H</a>类型属性即$VOLUME_INFORMATION，该属性说明卷的版本和状态，只有在元文件$Volum出现，其属性长为12字节（但实际上总是占用了16字节，这是因为属性的长度总是8的倍数）</p>
<h3 id="70H类型属性描述"><a href="#70H类型属性描述" class="headerlink" title="70H类型属性描述"></a>70H类型属性描述</h3><table>
<thead>
<tr>
<th>字节偏移</th>
<th>字段长度（字节）</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>～</td>
<td>～</td>
<td>标准属性头（已分析过）</td>
</tr>
<tr>
<td>0x00</td>
<td>8</td>
<td>总为0</td>
</tr>
<tr>
<td>0x08</td>
<td>1</td>
<td>主版本号</td>
</tr>
<tr>
<td>0x09</td>
<td>1</td>
<td>次版本号</td>
</tr>
<tr>
<td>0x0A</td>
<td>2</td>
<td>标志</td>
</tr>
<tr>
<td>0x0C</td>
<td>4</td>
<td>总为0</td>
</tr>
</tbody></table>
<h3 id="70H属性标志的含义"><a href="#70H属性标志的含义" class="headerlink" title="70H属性标志的含义"></a>70H属性标志的含义</h3><table>
<thead>
<tr>
<th>值</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>0x0001</td>
<td>坏区标志</td>
</tr>
<tr>
<td>0x0002</td>
<td>调整日志文件大小</td>
</tr>
<tr>
<td>0x0004</td>
<td>更新装载</td>
</tr>
<tr>
<td>0x0008</td>
<td>装载到NT4</td>
</tr>
<tr>
<td>0x0010</td>
<td>删除进行中的USN</td>
</tr>
<tr>
<td>0x0020</td>
<td>修复对象ID</td>
</tr>
<tr>
<td>0x8000</td>
<td>用chkdsk修正</td>
</tr>
</tbody></table>
<p>坏区标志为1时，Windows NT、Windows 2000、Windows XP就必须在下次重启时运行chkdsk&#x2F;F命令对卷进行修复。在这些系统中可以用fsutil命令对该位进行操作坏区设置和查询等操作，其语法为：</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fsutil dirty &#123;query|<span class="built_in">set</span>&#125; PathName</span><br></pre></td></tr></table></figure>

<p>参数query表示查询指定卷是否为坏区，参数set表示将卷设置为坏区，参数PathName则指定驱动器号（用冒号分隔）、装入点或卷名。如果设置了卷的坏区，则表明文件系统可能处于不一致的状态。</p>
<p>由于下述原因可以设置坏区：卷已联机且发生了明显的变化，或对卷作了更改，但在更改写入到磁盘前关闭了计算机，或者因为在卷上检测到损坏。如果重新启动计算机时设置了坏区，则运行chkdsk可以验证卷的一致性。每次启动系统时，内核程序将调用Autochk.exe扫描所有的卷，以查看是否设置了卷的坏区。如果设置了坏区，则autochk将立即在卷上执行chkdsk&#x2F;f。chkdsk&#x2F;f将验证文件系统的完整性并试图修复卷上的任何故障。</p>
<h3 id="70H属性的版本号"><a href="#70H属性的版本号" class="headerlink" title="70H属性的版本号"></a>70H属性的版本号</h3><table>
<thead>
<tr>
<th align="center">操作系统</th>
<th align="center">NTFS版本（主.次）</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Windows NT</td>
<td align="center">1.2</td>
</tr>
<tr>
<td align="center">Windows 2000</td>
<td align="center">3.0</td>
</tr>
<tr>
<td align="center">Windows XP</td>
<td align="center">3.1</td>
</tr>
<tr>
<td align="center">Windows 2003</td>
<td align="center">3.1</td>
</tr>
<tr>
<td align="center">Windows Vista</td>
<td align="center">3.1</td>
</tr>
</tbody></table>
<h2 id="80H（-DATA）属性分析"><a href="#80H（-DATA）属性分析" class="headerlink" title="80H（$DATA）属性分析"></a>80H（$DATA）属性分析</h2><p><a target="_blank" rel="noopener" href="https://www.dgxue.com/huifu/tag/80h/">80H</a>类型属性即$DATA属性，该属性容纳着文件的内容，文件大小一般指的就是未命名数据流的大小。该属性没有最大最小限制，最小情况是该属性为常驻属性，可以不占用除MFT以外的空间。</p>
<h3 id="常驻80H类型属性结构"><a href="#常驻80H类型属性结构" class="headerlink" title="常驻80H类型属性结构"></a>常驻80H类型属性结构</h3><table>
<thead>
<tr>
<th align="center">字节偏移</th>
<th align="center">字段长度（字节）</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">～</td>
<td align="center">～</td>
<td align="center">标准属性头（已分析过）</td>
</tr>
<tr>
<td align="center">00H</td>
<td align="center"></td>
<td align="center">文件内容</td>
</tr>
</tbody></table>
<p>在标准属性头后面是该文件的内容。该内容以“00H”结束，这是因为文件属性的长度总是8的整数倍，当属性结束时并没有达到一个能被8整除的数字时就用“00H”来填充。</p>
<p><img src="https://s2.loli.net/2022/05/02/KC7Z8Lh5dOkp6sS.jpg" alt="80H（$DATA）属性分析-数据恢复迷"></p>
<h3 id="非常驻80H属性结构"><a href="#非常驻80H属性结构" class="headerlink" title="非常驻80H属性结构"></a>非常驻80H属性结构</h3><p>在NTFS文件系统中常用数据流有：</p>
<p>①［未命名］（［Unnamed］）</p>
<p>②{4c8cc155-6c1e-11d1-8e41-00c04fb9386d}</p>
<p>③^EDocumentSummaryInformation</p>
<p>④^ESebiesnrMkudrfcoIaamtykdDa</p>
<p>⑤^ESummaryInformation</p>
<p>⑥$MountMgrDatabase</p>
<p>⑦$Bad</p>
<p>⑧$SDS</p>
<p>⑨$J</p>
<p>⑩$Max</p>
<h4 id="未命名数据流"><a href="#未命名数据流" class="headerlink" title="未命名数据流"></a>未命名数据流</h4><p>80H属性的第一个未命名数据流也就是文件真正的数据，由Data Run来记录其属性体即文件数据的具体地址。</p>
<p><img src="https://s2.loli.net/2022/05/02/MDTVHQcpGfhqOU4.jpg" alt="80H（$DATA）属性分析-数据恢复迷"></p>
<center><b>Data Run含义的描述</b>

<table>
<thead>
<tr>
<th align="center"></th>
<th align="center">字节偏移</th>
<th align="center">字段长度（字节）</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">第一个Data Run的含义描述</td>
<td align="center">0x00</td>
<td align="center">1</td>
<td align="center">高4位为Data Run（数据流）的起始簇号在这个压缩字节中所占的字节数（N）；低4位表示Data Run所占用的簇数在该压缩字节中占用的字节数（L）</td>
</tr>
<tr>
<td align="center">0x01</td>
<td align="center">L</td>
<td align="center">Data Run（数据流）所占用的簇数</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">L＋1</td>
<td align="center">N</td>
<td align="center">Data Run（数据流）的起始簇号</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">第二个Data Run的含义描述</td>
<td align="center">L＋N＋1</td>
<td align="center">1</td>
<td align="center">高4位为Data Run的起始簇的相对簇数在这个压缩字节中所占的字节数（N1）；低4位表示Data Run所占的簇数在该压缩数据中占用的字节数（L1）</td>
</tr>
<tr>
<td align="center">L＋N＋2</td>
<td align="center">L1</td>
<td align="center">Data Run所占用的簇数</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">L＋N＋L1＋2</td>
<td align="center">N1</td>
<td align="center">Data Run的起始簇的相对簇数，将此值加上第一个Data Run位置描述中的起始簇号，就是该Data Run的起始簇号（注意该值为带符号数）</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">第三个及以后的Data Run含义同第二个Data Run</td>
<td align="center">……</td>
<td align="center">……</td>
<td align="center">……</td>
</tr>
</tbody></table>
<center><b>Run List的结构及含义</b>

</center>

<p><img src="https://s2.loli.net/2022/05/02/dkRmsH1btBQwG3x.jpg" alt="80H（$DATA）属性分析-数据恢复迷"></p>
<h3 id="文件的摘要信息"><a href="#文件的摘要信息" class="headerlink" title="文件的摘要信息"></a>文件的摘要信息</h3><p>这些摘要包括描述和来源两个部分，其中描述包括标题、主题、类别、关键字、备注等信息，而来源包括来源、作者、修订版本号码等信息。</p>
<p>而这些数据被存储在一组四条命名数据流中，它们分别是：</p>
<p>{4c8cc155-6c1e-11d1-8e41-00c04fb9386d}</p>
<p>^ EDocumentSummaryInformation</p>
<p>^ ESebiesnrMkudrfcoIaamtykdDa</p>
<p>^ ESummaryInformation</p>
<p>值得注意的是，后3个命名数据流的名字中的符号“^”是CTRL-E（05H），这样做的原因可能是不让普通用户访问该流。而{4c8cc155-6c1e-11d1-8e41-00c04fb9386d}流的内容总是为空</p>
<p><img src="https://s2.loli.net/2022/05/02/u2OHND9JvGgIrEX.jpg" alt="80H（$DATA）属性分析-数据恢复迷"></p>
<p>从{4c8cc155-6c1e-11d1-8e41-00c04fb9386d}数据流的属性头中可以看出，虽然其为非常驻属性，但是不论是系统分配给该属性的大小还是属性真实大小和最初的属性大小都是0，也就是说该数据流为空。</p>
<center><b>包含文件摘要的数据流</b>

</center>

<table>
<thead>
<tr>
<th align="center">数据流</th>
<th align="center">包含的文件摘要</th>
<th align="center">数据类型</th>
</tr>
</thead>
<tbody><tr>
<td align="center">^EDocumentSummaryInformation</td>
<td align="center">类别</td>
<td align="center">ASCII码</td>
</tr>
<tr>
<td align="center">^ESebiesnrMkudrfcoIaamtykdDa</td>
<td align="center">来源</td>
<td align="center">Unicode编码</td>
</tr>
<tr>
<td align="center">^ESummaryInformation</td>
<td align="center">标题<br>主题<br />作者<br>关键字<br>备注<br>修订版号码</td>
<td align="center">ASCII码</td>
</tr>
</tbody></table>
<h3 id="MountMgrDatabase-Data-Stream"><a href="#MountMgrDatabase-Data-Stream" class="headerlink" title="$MountMgrDatabase Data Stream"></a>$MountMgrDatabase Data Stream</h3><p>该数据流只存在有重解析点的卷上。</p>
<h3 id="Bad"><a href="#Bad" class="headerlink" title="$Bad"></a>$Bad</h3><p>坏簇数据流，该数据流只有在$BadClus元文件中才有，它是一个记录卷中簇的情况的数据流。任何好的簇、未用的簇及坏簇，都将在对应的位置做标记。NTFS不会像FAT系统那样提示“Abort，Retry，Fail?”，如果系统运行时新的坏簇被发现，系统将这个坏扇标记到坏簇文件（$BadClus）中。</p>
<h3 id="SDS"><a href="#SDS" class="headerlink" title="$SDS"></a>$SDS</h3><p>安全描述流（$SDS），只有在$Secure元文件中才有，它包含了卷中所有安全描述列表。</p>
<h3 id="J、-Max"><a href="#J、-Max" class="headerlink" title="$J、$Max"></a>$J、$Max</h3><p>这两个数据流只有$Extend$UsnJrnl元文件中才有。</p>
<h2 id="90H（-INDEX-ROOT）属性分析"><a href="#90H（-INDEX-ROOT）属性分析" class="headerlink" title="90H（$INDEX_ROOT）属性分析"></a>90H（$INDEX_ROOT）属性分析</h2><p><a target="_blank" rel="noopener" href="https://www.dgxue.com/huifu/tag/90h/">90H</a>类型属性即$INDEX_ROOT，是索引根属性，该属性是实现NTFS的B＋树索引的根节点，它总是常驻属性。该属性没有最大最小长度限制。</p>
<p>结构：</p>
<p>标准属性头</p>
<p>索引根</p>
<p>索引头</p>
<p>索引项</p>
<p>索引项</p>
<p>…</p>
<h3 id="索引根"><a href="#索引根" class="headerlink" title="索引根"></a>索引根</h3><table>
<thead>
<tr>
<th>字节偏移</th>
<th>字段长度（字节）</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>～</td>
<td>～</td>
<td>标准属性头（已分析过）</td>
</tr>
<tr>
<td>0x00</td>
<td>4</td>
<td>属性类型</td>
</tr>
<tr>
<td>0x04</td>
<td>4</td>
<td>校对规则</td>
</tr>
<tr>
<td>0x08</td>
<td>4</td>
<td>每个索引缓冲区的分配大小（字节数）</td>
</tr>
<tr>
<td>0x0C</td>
<td>1</td>
<td>每个索引缓冲区的簇数</td>
</tr>
<tr>
<td>0x0D</td>
<td>3</td>
<td>无意义（填充到属性长度能被8整除）</td>
</tr>
</tbody></table>
<h3 id="索引头"><a href="#索引头" class="headerlink" title="索引头"></a>索引头</h3><table>
<thead>
<tr>
<th>字节偏移</th>
<th>字段长度（字节）</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>0x00</td>
<td>4</td>
<td>第一个索引项的偏移</td>
</tr>
<tr>
<td>0x04</td>
<td>4</td>
<td>索引项的总大小</td>
</tr>
<tr>
<td>0x08</td>
<td>4</td>
<td>索引项的分配大小</td>
</tr>
<tr>
<td>0x0C</td>
<td>1</td>
<td>标志：当该字节为00时，表示其为小索引（适合于索引根）；当该字节为01时，表示其为大索引（适合于索引分配）</td>
</tr>
<tr>
<td>0x0D</td>
<td>3</td>
<td>无意义（填充到属性长度能被8整除）</td>
</tr>
</tbody></table>
<h3 id="索引项"><a href="#索引项" class="headerlink" title="索引项"></a>索引项</h3><p>索引头后面有着不同长度的索引项的序列，由一个带有最后一个索引项标志的特殊索引项来结束。当一个目录比较小，可以全部存储在索引根属性中时，该目录就只需要这一个属性来描述。而如果目录太大不能全部存储在索引根中时，就会有两个附加的属性出现：一个是索引分配属性，描述B＋树目录的子节点；另一个是索引位图属性，描述索引块的索引分配属性使用的虚拟簇号。根目录$Root包含它自身的一个索引项。</p>
<p><img src="https://s2.loli.net/2022/05/02/qzKN73T89ZIPj25.jpg" alt="90H（$INDEX_ROOT）属性分析-数据恢复迷"></p>
<center><b>索引项描述</b>

<table>
<thead>
<tr>
<th>字节偏移</th>
<th>字段长度（字节）</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>0x00</td>
<td>8</td>
<td>该文件的MFT参考号</td>
</tr>
<tr>
<td>0x08</td>
<td>2</td>
<td>索引项的大小（相对索引项开始的偏移）</td>
</tr>
<tr>
<td>0x0A</td>
<td>2</td>
<td>文件名属性体大小</td>
</tr>
<tr>
<td>0x0C</td>
<td>2</td>
<td>索引标志：此处为1表示这个索引项包含子节点；为2表示这是最后一个项</td>
</tr>
<tr>
<td>0x0E</td>
<td>2</td>
<td>用0填充，无意义</td>
</tr>
<tr>
<td>0x10</td>
<td>8</td>
<td>父目录的MFT文件参考号</td>
</tr>
<tr>
<td>0x18</td>
<td>8</td>
<td>文件创建时间</td>
</tr>
<tr>
<td>0x20</td>
<td>8</td>
<td>文件最后修改时间</td>
</tr>
<tr>
<td>0x28</td>
<td>8</td>
<td>文件记录最后修改时间</td>
</tr>
<tr>
<td>0x30</td>
<td>8</td>
<td>文件最后访问时间</td>
</tr>
<tr>
<td>0x38</td>
<td>8</td>
<td>文件的分配大小</td>
</tr>
<tr>
<td>0x40</td>
<td>8</td>
<td>文件的实际大小</td>
</tr>
<tr>
<td>0x48</td>
<td>8</td>
<td>文件标志</td>
</tr>
<tr>
<td>0x50</td>
<td>1</td>
<td>文件名的长度</td>
</tr>
<tr>
<td>0x51</td>
<td>1</td>
<td>文件名的命名空间</td>
</tr>
<tr>
<td>0x52</td>
<td>2F</td>
<td>文件名</td>
</tr>
<tr>
<td>2F＋0x52</td>
<td>P</td>
<td>填充到能被8整除（无意义）</td>
</tr>
<tr>
<td>P＋2F＋0x52</td>
<td>8</td>
<td>子节点的索引所在的VCN（需要有子节点时才有）</td>
</tr>
</tbody></table>
<p><img src="https://s2.loli.net/2022/05/02/wTJGALBXhUm1Hgx.jpg" alt="90H（$INDEX_ROOT）属性分析-数据恢复迷"></p>
<h2 id="A0H（NDEX-ALLOCATION）属性分析"><a href="#A0H（NDEX-ALLOCATION）属性分析" class="headerlink" title="A0H（NDEX_ALLOCATION）属性分析"></a>A0H（NDEX_ALLOCATION）属性分析</h2><p><a target="_blank" rel="noopener" href="https://www.dgxue.com/huifu/tag/a0h/">A0H</a>类型属性，即INDEX_ALLOCATION，它是索引分配属性，也是一个索引（如目录）的基本结构，存储着组成索引的B＋树目录所有子节点的定位信息。它总是非常驻属性，没有最大最小值限制。</p>
<center><b>A0H属性结构</b>

<table>
<thead>
<tr>
<th>字节偏移</th>
<th>字段长度（字节）</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>～</td>
<td>～</td>
<td>标准属性头（已分析过）</td>
</tr>
<tr>
<td>0x00</td>
<td>…</td>
<td>Data Run列表</td>
</tr>
</tbody></table>
<p><img src="https://s2.loli.net/2022/05/02/HKcMBVFLNfORZTJ.jpg" alt="A0H（NDEX_ALLOCATION）属性分析-数据恢复迷"></p>
<p>A0H属性的Run List所描述的数据流，也就是NTFS的B＋树结构的索引缓冲区。</p>
<h2 id="B0H（-BITMAP）属性分析"><a href="#B0H（-BITMAP）属性分析" class="headerlink" title="B0H（$BITMAP）属性分析"></a>B0H（$BITMAP）属性分析</h2><p><a target="_blank" rel="noopener" href="https://www.dgxue.com/huifu/tag/b0h/">B0H</a>类型属性即$BITMAP，也就是位图属性，该属性是由一系列的位构成的虚拟簇（VCN）使用情况表，它没有最大最小限制。该属性目前用在两个地方：索引和$MFT中。在索引中，每一位代表索引分配中的一个VCN；在$MFT中，每一位代表一个文件记录的使用情况。</p>
<center><b>B0H属性描述表</b>

</center>

<p><img src="https://s2.loli.net/2022/05/02/iIz3ubxBfym5gRj.jpg" alt="B0H（$BITMAP）属性分析-数据恢复迷"></p>
<p><img src="https://s2.loli.net/2022/05/02/QoYkIx7EypfheZG.jpg" alt="B0H（$BITMAP）属性分析-数据恢复迷"></p>
<h2 id="C0H（-REPARSE-POINT）属性分析"><a href="#C0H（-REPARSE-POINT）属性分析" class="headerlink" title="C0H（$REPARSE_POINT）属性分析"></a>C0H（$REPARSE_POINT）属性分析</h2><p><a target="_blank" rel="noopener" href="https://www.dgxue.com/huifu/tag/c0h/">C0H</a>类型属性，即$REPARSE_POINT，也就是重解析点属性。该属性没有最小字节数限制，但有最大字节数限制，其最大字节数为16 384字节。</p>
<p>文件或目录可以包含一个重解析点（用户定义数据的集合）。存储数据的程序和文件系统过滤器可以理解这种数据格式，所安装的这些程序和过滤器用于解释数据并处理文件。程序设置重解析点时，它会存储该数据和唯一标识所存储数据的重解析标记。当文件系统打开带有重解析点的文件时，它试图找到与由重解析标记标识的数据格式相联系的文件系统过滤器。如果找到了这样的文件系统过滤器，过滤器将在重分析数据的指导下处理文件。否则，打开文件的操作将会失败。</p>
<p>在Windwos 2003、Windows XP系统中可以用“fsutil reparsepoint ［query］ PathName”命令检索由指定的句柄识别的文件或目录的重分析点数据，也可以用“fsutil reparsepoint ［delete］ PathName”命令删除指定的文件或目录的重分析点。</p>
<p>重解析点中有一个称为“重解析数据”的数据块能够与文件或者目录相关联。重解析数据是用户定义的关于文件或者目录的数据。例如，文件的状态或者地址，创建这些数据的应用程序、文件系统过滤器驱动程序、I&#x2F;O管理器，都可以从重解析点读重解析数据。当NTFS在文件或者目录查找其间，遇到一个重解析点，它返回一个重解析状态代码，通知连接到卷上的文件系统过滤器驱动程序和I&#x2F;O管理器，检查重解析数据。每个重解析点类型有一个唯一的重解析标签。重解析标签允许负责转换重解析点的重解析数据的组件确认重解析点，而不用检查重解析数据。重解析标签的拥有者，是文件系统过滤器驱动程序或者I&#x2F;O管理器，在确认重解析数据时，可以选择以下的选项：</p>
<p>①重解析标签拥有者可以处理在文件I&#x2F;O操作中指定的跨越重解析点的路径名，并且用修改过的路径名重新发送I&#x2F;O操作。例如，连接就是利用这个方法重指向目录寻找。</p>
<p>②重解析标签拥有者可以从文件删除重解析点，以某些方法修改文件，然后重新发送文件I&#x2F;O操作。Windows 2003、Windows XP的分层存储管理（HSM）系统就是用这种方式使用重解析点。HSM将文件归档，将文件的内容转移到磁带，只剩下重解析点在它们的位置。当进程访问一个已经归档的文件，HSM过滤器驱动程序（*\System32\ Drivers\Rsfilter.sys）从文件删除重解析点，从归档的介质读文件的数据，重新发送访问请求。因此，对于访问归档文件的进程来说，获取离线数据是透明的。</p>
<center><b>C0H属性描述表</b>
| 字节偏移 | 字段长度（字节） | 描述                               |
| -------- | ---------------- | ---------------------------------- |
| ～       | ～               | 标准属性头（已分析过）             |
| 0x00     | 4                | 重解析类型（和标志）               |
| 0x04     | 2                | 重解析数据长度                     |
| 0x06     | 2                | 填充到能被8整除，无意义            |
| 0x08     | V                | 重解析数据，其结构取决于重解析类型 |

<center><b>重解析标志描述表</b>

<table>
<thead>
<tr>
<th>标志</th>
<th>描述</th>
<th>标志</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>0x20000000</td>
<td>别名</td>
<td>0x68000007</td>
<td>SIS</td>
</tr>
<tr>
<td>0x40000000</td>
<td>高潜伏</td>
<td>0x68000008</td>
<td>DFS</td>
</tr>
<tr>
<td>0x80000000</td>
<td>微软</td>
<td>0x88000003</td>
<td>装载点</td>
</tr>
<tr>
<td>0x68000005</td>
<td>NSS</td>
<td>0xA8000004</td>
<td>HSM</td>
</tr>
<tr>
<td>0x68000006</td>
<td>NSS recover</td>
<td>0xE8000000</td>
<td>符号连接</td>
</tr>
</tbody></table>
<h2 id="D0H（-EA-INFORMATION）属性分析"><a href="#D0H（-EA-INFORMATION）属性分析" class="headerlink" title="D0H（$EA_INFORMATION）属性分析"></a>D0H（$EA_INFORMATION）属性分析</h2><p><a target="_blank" rel="noopener" href="https://www.dgxue.com/huifu/tag/d0h/">D0H</a>类型属性，即$EA_INFORMATION，也就是扩充属性信息属性，它是为了在NTFS下实现用于HPFS的OS&#x2F;2子系统信息及Windows NT服务器的OS&#x2F;2客户端应用而设置的扩展属性。由于其数据流可以增长，所以该文件属性可能非常驻。该属性总是占8字节长度。</p>
<center><b>D0H类型属性描述表</b>

<table>
<thead>
<tr>
<th>字节偏移</th>
<th>字段长度（字节）</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>～</td>
<td>～</td>
<td>标准属性头（已分析过）</td>
</tr>
<tr>
<td>0x00</td>
<td>2</td>
<td>扩展属性填充尺寸</td>
</tr>
<tr>
<td>0x02</td>
<td>2</td>
<td>拥有NEED_EA设置的扩展属性数量</td>
</tr>
<tr>
<td>0x04</td>
<td>4</td>
<td>扩展属性非填充大小</td>
</tr>
</tbody></table>
<h2 id="E0H（-EA）属性分析"><a href="#E0H（-EA）属性分析" class="headerlink" title="E0H（$EA）属性分析"></a>E0H（$EA）属性分析</h2><p><a target="_blank" rel="noopener" href="https://www.dgxue.com/huifu/tag/e0h/">E0H</a>类型属性，即$EA，也就是扩展属性，它用于在NTFS下实现HPFS。由于其数据流可能增长，所以该文件属性可能是非常驻的。该属性没有最小字节数限制，但最大只能达到65 536字节。扩展属性由“名称”和“值”成对组成</p>
<center><b>E0H属性描述表</b>

<table>
<thead>
<tr>
<th>字节偏移</th>
<th>字段长度（字节）</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>～</td>
<td>～</td>
<td>标准属性头（已分析过）</td>
</tr>
<tr>
<td>0x00</td>
<td>4</td>
<td>下一个扩展属性的偏移，也就是本偏移的长度</td>
</tr>
<tr>
<td>0x04</td>
<td>1</td>
<td>标志，当其值为80H时表示需要扩展属性</td>
</tr>
<tr>
<td>0x05</td>
<td>1</td>
<td>名称长度（N）</td>
</tr>
<tr>
<td>0x06</td>
<td>2</td>
<td>值长度（V）</td>
</tr>
<tr>
<td>0x08</td>
<td>N</td>
<td>名称</td>
</tr>
<tr>
<td>N＋0x08</td>
<td>V</td>
<td>值</td>
</tr>
</tbody></table>
<h2 id="100H（-LOGGED-UTILITY-STREAM）属性分析"><a href="#100H（-LOGGED-UTILITY-STREAM）属性分析" class="headerlink" title="100H（$LOGGED_UTILITY_STREAM）属性分析"></a>100H（$LOGGED_UTILITY_STREAM）属性分析</h2><p><a target="_blank" rel="noopener" href="https://www.dgxue.com/huifu/tag/100h/">100H</a>类型属性，即$LOGGED_UTILITY_STREAM，即EFS加密属性。该属性主要用于存储实现EFS加密的有关加密信息，如合法用户列表、解码密钥等。正如$AttrDef所定义，该属性没有最小字节数限制，但最大只能到65 536字节。</p>
<center><b>100H类型属性描述表</b>

<table>
<thead>
<tr>
<th>字节偏移</th>
<th>字段长度（字节）</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>～</td>
<td>～</td>
<td>标准属性头（已分析过）</td>
</tr>
<tr>
<td>0x00</td>
<td></td>
<td>任意数据（EFS加密后的数据，或者是其Run List位置描述表）</td>
</tr>
</tbody></table>
<h2 id="元文件-MFTMirr分析"><a href="#元文件-MFTMirr分析" class="headerlink" title="元文件$MFTMirr分析"></a>元文件$MFTMirr分析</h2><p>$MFTMirr是系统以恢复为目的而创建的文件，它将$MFT文件中的几个记录做了备份。具体备份多少个文件记录取决于NTFS卷中每个簇的大小，至少需要做前4个文件记录的备份。当卷中簇远小于或等于4倍的文件记录大小（即小于或等于4KB）时，$MFTMirr就做前4个文件记录的备份。在Windows2003、Windows XP系统中默认的格式化簇的大小就是4KB，所以卷中的$MFTMirr大多只做了前4个文件记录的备份。如果簇的大小大于4KB时，那么$MFTMirr的数据流大小就等于一个簇，在一个簇中能备份多少个文件记录就会备份多少个，但一定是按文件记录的顺序进行备份的。</p>
<p>$MFTMirr的文件记录号为01H，一般由以下3种属性组成</p>
<p><img src="https://s2.loli.net/2022/05/02/62fmxkEw8vgnVsy.jpg" alt="元文件$MFTMirr分析-数据恢复迷"></p>
<h3 id="10H属性"><a href="#10H属性" class="headerlink" title="10H属性"></a>10H属性</h3><p>10H属性定义了$MFTMirr的创建时间、最后修改时间、该文件记录修改时间、文件最后访问时间及标志等信息。</p>
<h3 id="30H属性"><a href="#30H属性" class="headerlink" title="30H属性"></a>30H属性</h3><p>30H属性定义了$MFTMirr的父目录的文件参考号、系统分配给整个磁盘的MFTMirr的大小、实际使用的大小；再次定义了文件的标志为06H，表示其为隐藏、系统文件；定义了该文件名属性的文件名的长度为8个字、命名空间为3，即Win32 ＆ DOS；在属性的最后定义了该文件的文件名为Unicode字符串“$MFTMirr”</p>
<h3 id="80H属性"><a href="#80H属性" class="headerlink" title="80H属性"></a>80H属性</h3><p>80H属性定义了$MFTMirr数据流的起始VCN（本例中为0）、结束VCN（本例中为1）、起始LCN号（本例中为10H），以及所占的簇数（本例中为01H）等信息</p>
<blockquote>
<p>在80H属性之后跟着4个字节的“FF FF FF FF”，这是属性的结束标志，到此为止该文件记录中的属性就结束了。</p>
</blockquote>
<h2 id="元文件-LogFile分析"><a href="#元文件-LogFile分析" class="headerlink" title="元文件$LogFile分析"></a>元文件$LogFile分析</h2><p>日志文件的结构比较复杂，其日志区域由一系列4KB大小的日志记录组成，记录头固定标志是“RCRD”，其重启页的头部固定标志是“RSTR”，位于重启区域的开始部分。</p>
<p>当文件被写到磁盘上时，系统要做两件事，一是写文件本身的数据，二是更新和文件系统有关的一些数据（如文件创建时间）。如果此操作完成，则可以确认文件被写到存储单元上，并且文件系统处于正常状态。如果此操作未完成（如电源故障、系统瘫痪等），则文件系统处于非正常状态。NTFS系统将其恢复到正常状态的途径是在该特殊文件里记录日志，这个日志文件会记录某个操作的成功与失败。在系统故障后第一次进入磁盘时，系统读取日志文件并使其恢复到最后一次操作开始前的状态。当系统写日志文件时，操作必须是自动且即时的，可以在很短的时间内把卷恢复到正常状态，恢复时间与磁盘大小无关，只与失败任务的复杂程度有关。</p>
<h3 id="日志文件服务"><a href="#日志文件服务" class="headerlink" title="日志文件服务"></a>日志文件服务</h3><p>日志文件由格式化程序和日志文件服务（LogFile Service，LFS）共同创建。日志文件服务是一组NTFS驱动程序内的核心态程序。NTFS是通过LFS例程来访问日志文件的。</p>
<center><b>LFS结构示意图</b>

<p><img src="https://s2.loli.net/2022/05/02/ds1bka2nU6DNuVY.jpg" alt="元文件$LogFile分析-数据恢复迷"></p>
<p>LFS将日志文件分为两个区域：重启动区域（Restart Area）和无限记录区域（Infinite Logging Area）</p>
<center><b>日志文件结构</b>

</center>

<p><img src="https://s2.loli.net/2022/05/02/fUt1L6wRKPWXpmO.jpg" alt="元文件$LogFile分析-数据恢复迷"></p>
<p>NTFS使用重启动区域来存储系统故障后从哪里进行恢复的信息。在系统失败后的恢复过程中，NTFS将从这个位置开始读取信息。由于重启动区域的重要性，在紧随其后的磁盘空间上，LFS保存了它的一个副本。</p>
<p>在LFS重启动区域之后是记录区域，用于存放NTFS的日志记录，包含了改变文件系统数据和卷目录结构的I&#x2F;O操作的处理记录，由逻辑顺序号（Logical Sequence Numbers，LSN）来标识这些记录。LSN为64位，通过循环使用日志记录，LSN使日志文件看起来像是可以保存无限多的日志记录。</p>
<p>NTFS不会直接从日志文件中读&#x2F;写记录，而是通过LFS来读&#x2F;写记录。LFS提供了许多操作来处理日志文件，包括打开（Open）、写入（Write）、向前（Prev）、向后（Next）、更新（Update）等操作。在恢复过程中，NTFS通过向前读取日志记录，重做已在日志文件中记录的、系统失败时还没有及时刷新到磁盘上的所有事务；NTFS通过向后读取日志记录，撤销或是回退系统崩溃前没有完全记录在日志文件中的事务。当NTFS不再需要日志文件中较早的事务记录时，它就调用LFS来将日志文件的开始部分设置为一个具有更高LSN的记录，从而实现日志记录的“无限”使用。</p>
<p>NTFS为实现卷的可恢复性而执行的操作步骤：</p>
<p>①NTFS首先调用LFS在日志文件中记录所有改变卷结构的事务；</p>
<p>②NTFS执行在高速缓存中的更改卷结构的操作；</p>
<p>③高速缓存管理器调用LFS将日志文件刷新到磁盘；</p>
<p>④完成上一步之后，卷更改（事务本身）最后被刷新到磁盘上。</p>
<center><b>NTFS实现卷的可恢复性的操作步骤</b>

</center>

<p><img src="https://s2.loli.net/2022/05/02/XPsUjhA5rHZa62B.jpg" alt="元文件$LogFile分析-数据恢复迷"></p>
<h3 id="日志记录类型"><a href="#日志记录类型" class="headerlink" title="日志记录类型"></a>日志记录类型</h3><p>LFS允许用户在日志文件中写入任何类型的记录。<code>更新记录（Update Record）</code>和<code>检查点记录（Checkpoint Record）</code>是NTFS所支持的两种主要类型的日志记录，它们在系统的恢复过程中起了主要作用。</p>
<h3 id="更新记录"><a href="#更新记录" class="headerlink" title="更新记录"></a>更新记录</h3><p>NTFS为以下事务写入更新记录：</p>
<ul>
<li>创建文件</li>
<li>删除文件</li>
<li>扩展文件</li>
<li>截断文件</li>
<li>设置文件信息</li>
<li>重新命名文件</li>
<li>更改应用于文件的安全信息</li>
</ul>
<p>在更新记录中一般包含两种信息：</p>
<ol>
<li>重做信息：如果事务在高速缓存中的操作记录刷新到磁盘之前系统崩溃，如何重新执行这个对卷来说是已提交的事务子操作</li>
<li>撤销信息：当系统失败时，如何撤销这个对卷来说未提交的事务子操作</li>
</ol>
<center><b>日志文件中的更新记录</b>

</center>

<p><img src="https://s2.loli.net/2022/05/02/1DFrUdkiXonHSxB.jpg" alt="元文件$LogFile分析-数据恢复迷"></p>
<h3 id="检查点记录"><a href="#检查点记录" class="headerlink" title="检查点记录"></a>检查点记录</h3><p>NTFS在写入检查点记录以后，还在重启动区域存储记录的LSN。在发生系统失败后的恢复过程中，NTFS通过存储在检查点记录中的信息来定位日志文件中的恢复点</p>
<center><b>日志文件中的检查点记录</b>

</center>

<p><img src="https://s2.loli.net/2022/05/02/wG2Rj14OEhXTalI.jpg" alt="元文件$LogFile分析-数据恢复迷"></p>
<h3 id="可恢复性实现"><a href="#可恢复性实现" class="headerlink" title="可恢复性实现"></a>可恢复性实现</h3><ul>
<li><p>NTFS在内存中维护两张表：</p>
<p>①事务表。事务表跟踪已经启动但尚未提交的事务。在恢复过程中，必须从磁盘删除这些活动事务的子操作。</p>
<p>②脏页表。脏页表记录了在高速缓存中还未写入磁盘的包含改变NTFS卷结构操作的页面。在恢复过程中，这些改动必须刷新到磁盘上。</p>
<p>NTFS每隔5s向日志文件写入一个检查点记录，在此之前，NTFS调用LFS在日志文件中存储事务表和脏页表的一个当前副本。这样，NTFS写入的检查点记录就包含了已复制表的日志记录的LSN，当系统失败后开始恢复时，NTFS调用LFS来定位日志文件记录，这些日志记录包含了最近的检查点记录以及最近的事务表和脏页表的副本，然后，NTFS将这些表复制到内存。</p>
<p>在最近的检查点记录之后，日志文件通常包含更多的更新记录。这些更新记录显示了在最后的检查点记录写入后卷的更改。为此，NTFS必须更新事务表和脏页表，通过更新这些表和日志文件中的内容来更新卷本身。</p>
<p>要实现NTFS卷的恢复，NTFS要对日志文件进行三次扫描。</p>
<h3 id="分析扫描（Analysis-Pass）"><a href="#分析扫描（Analysis-Pass）" class="headerlink" title="分析扫描（Analysis Pass）"></a>分析扫描（Analysis Pass）</h3><p>NTFS从日志文件中最近的一个检查点操作的起点开始分析扫描。检查点操作起点之后的每一个更新记录都代表对事务表或脏页表的修改，如“事务提交”记录代表的事务必须从事务表中删除；“页面更新”记录则表示因为对一个文件系统数据结构做了修改，相应的脏页表也必须更新，如图4-440所示。</p>
<p><img src="https://s2.loli.net/2022/05/02/2crL173b9gOWTnz.jpg" alt="元文件$LogFile分析-数据恢复迷"></p>
<p>图4-440　分析扫描的过程</p>
<p>这两个表被复制到内存中以后，NTFS将搜索这两个表。事务表包含了未提交（不完整）事务的LSN，脏页表则包含了高速缓存中还未刷新到磁盘的记录的LSN。NTFS根据其中的信息来确定最早的更新记录（该记录记录了在磁盘上尚未进行的操作）的LSN，由此决定重做扫描的起点。当然，如果最近一个检查点记录更早，NTFS将从那里开始启动重做扫描，由此进入事务恢复的第二阶段。</p>
<h3 id="重做扫描（Redoing-Pass）"><a href="#重做扫描（Redoing-Pass）" class="headerlink" title="重做扫描（Redoing Pass）"></a>重做扫描（Redoing Pass）</h3><p>在重做扫描过程中，NTFS将从分析扫描得到的最早记录的LSN开始，在日志文件中向前扫描。NTFS将查找“页面更新”记录，这个记录包含了在系统失败前就已经写入的卷更新，但是这些卷的更改可能还未刷新到磁盘，NTFS将在高速缓存中重做这些更新。当NTFS到达日志文件的末端时，它已经利用必要的卷更改更新了高速缓存，高速缓存管理器的延迟写线程能够开始在后台向磁盘写入高速缓存的内容</p>
<p><img src="https://s2.loli.net/2022/05/02/yGqNxi6mnFp2Awh.jpg" alt="元文件$LogFile分析-数据恢复迷"></p>
<h3 id="撤销扫描（Undoing-Pass）"><a href="#撤销扫描（Undoing-Pass）" class="headerlink" title="撤销扫描（Undoing Pass）"></a>撤销扫描（Undoing Pass）</h3><p>在NTFS完成重做扫描后，它将开始撤销扫描。NTFS可以在这一扫描中回退系统失败时任何未提交的事务</p>
<p><img src="https://s2.loli.net/2022/05/02/ElScFhbzUDapj5X.jpg" alt="元文件$LogFile分析-数据恢复迷"></p>
<p>图4-442中有两个事务：事务1在断电时已经提交，事务2未提交。假设事务2创建一个文件，有3个子操作，它们之间通过指针连接。事务表为每个未提交的事务更新记录列出最后记录的LSN。</p>
<p>每个更新记录包含两种信息，一个是如何重做一个子操作，另一个是如何撤销子操作。NTFS在定位LSN1093后，执行撤销操作直到LSN1089，完成事务2的回退。当然，在日志文件中也要记录撤销操作，因为撤销时也可能发生系统崩溃。</p>
<p>恢复完成后，NTFS将高速缓存写入磁盘从而保证卷是最新的。最后，NTFS写入一个“空”到LFS重启动区，指明卷是一致的。这时，即使系统再次崩溃，也不必再恢复了。</p>
<p>由于NTFS使用的是“延迟提交”的算法，这意味着每次“事务提交”记录写入时，日志文件不能立即刷新到磁盘，而是被批处理写入的。同时，多个事务可能是平行操作的，它们的事务提交记录可能一部分被写入磁盘，而另一部分没有写入。这样就只能保证NTFS恢复到某一先前存在的一致状态，而不能保证NTFS恢复到刚巧系统崩溃时的状态。</p>
<p>NTFS还能够利用日志记录实现文件系统错误的恢复，因为NTFS日志记录了每个更改卷结构的事务，包括正常文件I&#x2F;O过程中发生的文件系统错误，所以日志文件可大大简化文件系统的错误处理代码。当然，一个程序收到的大多数I&#x2F;O错误不是文件系统错误，调用者必须适当地依次响应错误。</p>
<p><img src="https://s2.loli.net/2022/05/02/jRkTbhY6wqlpmSi.jpg" alt="元文件$LogFile分析-数据恢复迷"></p>
</li>
</ul>
<h3 id="日志文件的文件记录"><a href="#日志文件的文件记录" class="headerlink" title="日志文件的文件记录"></a>日志文件的文件记录</h3><p>$LogFile的文件记录号是02H，一般由3个属性构成。</p>
<p><img src="https://s2.loli.net/2022/05/02/djS6PK5ioLNVWBO.jpg" alt="元文件$LogFile分析-数据恢复迷"></p>
<h4 id="10H属性-1"><a href="#10H属性-1" class="headerlink" title="10H属性"></a>10H属性</h4><p>10H属性定义了$LogFile的创建时间、最后修改时间、该文件记录修改时间、文件最后访问时间及标志等信息</p>
<h4 id="30H属性-1"><a href="#30H属性-1" class="headerlink" title="30H属性"></a>30H属性</h4><p>30H属性定义了$LogFile的父目录的文件参考号为根目录；定义了系统分配给整个磁盘的日志文件的大小（本例中为04000000H字节）、实际使用的大小（本例中为04000000H字节）；并再次定义了文件的标志为06H，表示其为隐藏、系统文件，定义了文件名的长度为8个字，命名空间为3，也即Win32 ＆ DOS；在属性的最后定义了该文件的文件名为Unicode字符串“$LogFile”</p>
<h4 id="80H属性-1"><a href="#80H属性-1" class="headerlink" title="80H属性"></a>80H属性</h4><p>80H属性定义了日志文件的MFT的起始VCN（本例中为0）、结束VCN（本例中为3FFFH）、系统分配给该日志文件的大小（本例中为04000000H字节）、日志文件实际的大小（本例中为04000000H字节）、初始的属性大小（本例中为04000000H字节）、数据流的起始LCN（本例中为11H）、所占的簇数（本例中为4000H）等信息</p>
<p>在80H属性之后跟着4个字节的“FF FF FF FF”，这是属性的结束标志，到此为止该文件记录中的属性就结束了。</p>
<h3 id="日志文件的数据流"><a href="#日志文件的数据流" class="headerlink" title="日志文件的数据流"></a>日志文件的数据流</h3><p>系统用于记录日志操作的文件就是$Logfile文件的数据流部分。从其文件记录的80属性中可以看到$Logfile文件的数据流开始于11H簇，也就是十进制的17号簇，换算为扇区号为136扇区，该扇区就是其重启动记录</p>
<p><img src="https://s2.loli.net/2022/05/02/RjqTA1FZDU3BuhH.jpg" alt="元文件$LogFile分析-数据恢复迷"></p>
<p>重启动区域共有两份副本，每个大小为4KB，其结构见表4-78。</p>
<p>　重启动区域结构描述</p>
<table>
<thead>
<tr>
<th>字节偏移</th>
<th>字段长度（字节）</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>0x00</td>
<td>4</td>
<td>固定字符“RSTR”</td>
</tr>
<tr>
<td>0x1E</td>
<td>12</td>
<td>固定值</td>
</tr>
<tr>
<td>0x30</td>
<td>4</td>
<td>记录序列号a</td>
</tr>
<tr>
<td>0x58</td>
<td>4</td>
<td>记录序列号B</td>
</tr>
<tr>
<td>0x6C</td>
<td>1</td>
<td>卷干净标志</td>
</tr>
<tr>
<td>0x90</td>
<td>8</td>
<td>Unicode字符形式的“NTFS”</td>
</tr>
</tbody></table>
<p>无限记录区域的前4个字符一定是“RCRD”</p>
<p><img src="https://s2.loli.net/2022/05/02/ZnF1uWSjOVUxoC8.jpg" alt="元文件$LogFile分析-数据恢复迷"></p>
<h2 id="NTFS文件删除后的底层分析"><a href="#NTFS文件删除后的底层分析" class="headerlink" title="NTFS文件删除后的底层分析"></a>NTFS文件删除后的底层分析</h2><ul>
<li>数据区内容没有改变</li>
<li>文件记录的状态字节已经由01变为00（文件被删除)</li>
<li>30H属性中的文件名、80H属性中的文件大小、Runlist没有改变</li>
</ul>
<h3 id="删除后的恢复"><a href="#删除后的恢复" class="headerlink" title="删除后的恢复"></a>删除后的恢复</h3><p>将被删除的“huaban.jpg”文件的数据区的内容全部选中，并另存为一个新文件</p>
<h2 id="NTFS文件系统格式化的分析"><a href="#NTFS文件系统格式化的分析" class="headerlink" title="NTFS文件系统格式化的分析"></a>NTFS文件系统格式化的分析</h2><h3 id="格式化的底层分析"><a href="#格式化的底层分析" class="headerlink" title="格式化的底层分析"></a>格式化的底层分析</h3><p>• DBR里面的参数改变</p>
<p>•1号扇区里面的参数改变</p>
<p>•FAT1和FAT2被清空</p>
<p>•根目录也被清空，如果有卷标 那么会有一条卷标目录项</p>
<h2 id="NTFS文件系统DBR手工重建"><a href="#NTFS文件系统DBR手工重建" class="headerlink" title="NTFS文件系统DBR手工重建"></a>NTFS文件系统DBR手工重建</h2><p><img src="https://s2.loli.net/2022/05/03/R8pIiUdbyXrchD3.jpg" alt="NTFS文件系统DBR手工重建的实例-数据恢复迷"></p>
<p>这个分区“K”所在的硬盘没有任何物理故障，显然是文件系统遭到破坏，所以系统会提示分区未格式化。用WinHex打开分区“K”</p>
<p><img src="https://s2.loli.net/2022/05/03/ke1z8lGmPDTp2OV.jpg" alt="NTFS文件系统DBR手工重建的实例-数据恢复迷"></p>
<p>看来WinHex也无法打开分区“K”，可以断定<a target="_blank" rel="noopener" href="https://www.dgxue.com/huifu/tag/dbr/">DBR</a>一定有错误，只能用WinHex打开分区“K”所在的硬盘，然后跳转到“K”盘的DBR扇区</p>
<p>首先考虑到NTFS分区的DBR有一个备份，在分区的最后一个扇区，如果能把这个DBR找到，直接复制过来就可以了。</p>
<p>先用WinHex跳转到硬盘最后一个分区，然后向上搜索“55 AA”，寻找备份DBR，若查找不到说明备份DBR也已经损坏</p>
<p><img src="https://s2.loli.net/2022/05/03/HUuniTcgvlPNXoe.jpg" alt="NTFS文件系统DBR手工重建的实例-数据恢复迷"></p>
<h3 id="具体操作"><a href="#具体操作" class="headerlink" title="具体操作"></a>具体操作</h3><h4 id="第1步-复制同版本的DBR"><a href="#第1步-复制同版本的DBR" class="headerlink" title="第1步　复制同版本的DBR"></a>第1步　复制同版本的DBR</h4><p>先从其他NTFS分区中复制一个完好的DBR扇区，放到K盘的第一个扇区处，但不能把这个DBR当作K盘的DBR直接使用，因为虽然目前这个DBR在结构上没什么问题，但其中的参数与K盘的文件系统结构不匹配，所以无法用这个DBR访问K盘。</p>
<h4 id="第2步-计算并修改BPB参数"><a href="#第2步-计算并修改BPB参数" class="headerlink" title="第2步　计算并修改BPB参数"></a>第2步　计算并修改BPB参数</h4><p>NTFS文件系统的BPB中需要修改的参数有：</p>
<ul>
<li>每簇扇区数；</li>
<li>隐藏扇区数（也就是分区的相对开始扇区号）；</li>
<li>扇区总数（也就是分区大小）；</li>
<li>$MFT起始簇号；</li>
<li>$MFTMirr起始簇号；</li>
<li>文件记录的大小描述；</li>
<li>索引缓冲区的大小描述。</li>
</ul>
<p>这7个参数需要计算并修改，其他的就不用修改了。</p>
<p><img src="https://s2.loli.net/2022/05/03/pIuMaynsXEk8Pdw.jpg" alt="NTFS文件系统DBR手工重建的实例-数据恢复迷"></p>
<ol>
<li><h5 id="隐藏扇区数"><a href="#隐藏扇区数" class="headerlink" title="隐藏扇区数"></a>隐藏扇区数</h5>隐藏扇区数这个参数也就是分区的相对开始扇区号。如果硬盘的分区表没有被破坏，这个参数可以从分区表中查看。现在K盘的分区表并没有破坏，K盘是主扩展分区中的最后一个驱动器，找到它的EBR，用分区表模板查看这个分区表</li>
</ol>
<p><img src="https://www.dgxue.com/huifu/img/huifu/image01403.jpeg" alt="NTFS文件系统DBR手工重建的实例-数据恢复迷"></p>
<p>从分区表模板中可以看到“隐藏扇区数”为63。</p>
<h5 id="2-扇区总数"><a href="#2-扇区总数" class="headerlink" title="2. 扇区总数"></a>2. 扇区总数</h5><p>扇区总数也可以从分区表中看到，从上图的分区表模板可以看出扇区总数为132006042.因为是NTFS分区，所有DBR中记录的扇区总数比分区表少一个扇区，应该为132006041</p>
<h5 id="3-MFT起始蔟号"><a href="#3-MFT起始蔟号" class="headerlink" title="3. $MFT起始蔟号"></a>3. $MFT起始蔟号</h5><p>$MFT起始簇号可以通过搜索文件记录的方法获得，搜索文件记录的具体方法是搜索文件记录的头标志“46 49 4C 45”</p>
<p><img src="https://s2.loli.net/2022/05/03/peWPwgNM31smkvB.jpg" alt="NTFS文件系统DBR手工重建的实例-数据恢复迷"></p>
<p>$MFT的文件记录的80H属性中通过Run List描述$MFT文件的开始簇号。换算为十进制可以求出起始蔟号</p>
<h5 id="4-每簇扇区数"><a href="#4-每簇扇区数" class="headerlink" title="4. 每簇扇区数"></a>4. 每簇扇区数</h5><p>每簇扇区数的计算方法是找一个文件的文件记录，通过其非常驻的80H属性就可计算每簇扇区数。</p>
<p>找到“数据流分配大小和Runlist换算为十进制。用数据流分配的字节除以数据流占的簇数，结果就是每个簇的字节数，再除以512，就是每簇扇区数。</p>
<h5 id="5-文件记录大小的描述"><a href="#5-文件记录大小的描述" class="headerlink" title="5. 文件记录大小的描述"></a>5. 文件记录大小的描述</h5><p>文件记录的大小描述用来说明每个文件记录的簇数，该参数为带符号数。当每个文件记录的大小小于每簇扇区数，该值就是负数。在这种情况下，文件记录的大小用字节数表示。计算方法为：文件记录的字节数＝2-1×文件记录的大小描述。</p>
<h5 id="6-索引缓冲区的大小描述"><a href="#6-索引缓冲区的大小描述" class="headerlink" title="6. 索引缓冲区的大小描述"></a>6. 索引缓冲区的大小描述</h5><p>索引缓冲的大小描述用来说明每个索引缓冲区的簇数，该参数也是带符号数。当每个索引缓冲的大小小于每簇扇区数时，就为负值。</p>
<p>索引缓冲区的大小一般固定为8扇区，而该分区簇大小也是8扇区，所以每个索引缓冲区为1簇。</p>
<h5 id="7-MFTMirr起始蔟号"><a href="#7-MFTMirr起始蔟号" class="headerlink" title="7. $MFTMirr起始蔟号"></a>7. $MFTMirr起始蔟号</h5><p>刚才通过搜索找到了$MFT的文件记录，该记录的下一个记录也就是$MFTMirr的文件记录了，从$MFTMirr文件记录的80H属性中就能查看到$MFTMirr起始簇号。</p>
<h4 id="3-保存修改的BPB参数"><a href="#3-保存修改的BPB参数" class="headerlink" title="3.保存修改的BPB参数"></a>3.保存修改的BPB参数</h4><p>将计算好的7个BPB参数填入DBR中，如果有模板就用模板填，没有模板也可以直接在DBR中填写，但要注意，在模板中按照十进制填写，在DBR中直接填写则需要按照Little-Endian字节序填十六进制。填写好存盘，再双击就可以打开了。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://github.com/HKingDragon/hkingdragon.github.io">Dragon</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://github.com/HKingDragon/hkingdragon.github.io/2022/04/26/NTFS%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/">https://github.com/HKingDragon/hkingdragon.github.io/2022/04/26/NTFS%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://github.com/HKingDragon/hkingdragon.github.io" target="_blank">Dragon's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/">文件系统</a></div><div class="post_share"><div class="social-share" data-image="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fdingyue.ws.126.net%2FjMj41EmkgbPDElqsjRm3MQO40zxMIMYLV5nFaB2raLTvY1539634712768compressflag.jpg&amp;refer=http%3A%2F%2Fdingyue.ws.126.net&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1654651194&amp;t=ac0893148782493a12e7667b3be7325f" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/gh/overtrue/share.js@master/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2022/04/26/FAT32%E7%B3%BB%E7%BB%9F/"><img class="next-cover" src="https://img0.baidu.com/it/u=1587130506,2748293553&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=500&amp;h=500" onerror="onerror=null;src='https://img0.baidu.com/it/u=1284263657,456284223&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=875&amp;h=500'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">FAT32系统</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/04/26/FAT32%E7%B3%BB%E7%BB%9F/" title="FAT32系统"><img class="cover" src="https://img0.baidu.com/it/u=1587130506,2748293553&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-26</div><div class="title">FAT32系统</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fww2.sinaimg.cn%2Flarge%2Fc1608aa0gw1euctw87ul7g20b40b4mzl.gif&amp;refer=http%3A%2F%2Fwww.sina.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1653544265&amp;t=ac0fd90b3540bb1abf4de1135021b748" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Dragon</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">4</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">3</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><a id="card-info-btn" href="https://github.com/HKingDragon"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/HKingDragon" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:3173957575@QQ.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎访问我的博客</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#NTFS%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.</span> <span class="toc-text">NTFS文件系统</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#NTFS%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.</span> <span class="toc-text">NTFS文件系统基本介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E7%82%B9"><span class="toc-number">1.1.1.</span> <span class="toc-text">特点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NTFS%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84%E6%80%BB%E8%A7%88"><span class="toc-number">1.2.</span> <span class="toc-text">NTFS文件系统结构总览</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NTFS%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%BC%95%E5%AF%BC%E6%89%87%E5%8C%BA%E5%88%86%E6%9E%90"><span class="toc-number">1.3.</span> <span class="toc-text">NTFS文件系统引导扇区分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%B3%E8%BD%AC%E6%8C%87%E4%BB%A4"><span class="toc-number">1.3.1.</span> <span class="toc-text">跳转指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OEM%E4%BB%A3%E5%8F%B7"><span class="toc-number">1.3.2.</span> <span class="toc-text">OEM代号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BPB%EF%BC%88BIOS%E5%8F%82%E6%95%B0%E5%9D%97%EF%BC%89"><span class="toc-number">1.3.3.</span> <span class="toc-text">BPB（BIOS参数块）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E5%AF%BC%E7%A8%8B%E5%BA%8F"><span class="toc-number">1.3.4.</span> <span class="toc-text">引导程序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E6%9D%9F%E6%A0%87%E5%BF%97"><span class="toc-number">1.3.5.</span> <span class="toc-text">结束标志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.3.6.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%83%E6%96%87%E4%BB%B6-MFT%E5%88%86%E6%9E%90"><span class="toc-number">1.4.</span> <span class="toc-text">元文件$MFT分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#NTFS%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%85%83%E6%96%87%E4%BB%B6"><span class="toc-number">1.4.1.</span> <span class="toc-text">NTFS文件系统的元文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MFT%E6%96%87%E4%BB%B6%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.4.2.</span> <span class="toc-text">$MFT文件介绍</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E8%AE%B0%E5%BD%95%E5%88%86%E6%9E%90"><span class="toc-number">1.5.</span> <span class="toc-text">文件记录分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E8%AE%B0%E5%BD%95%E7%9A%84%E7%BB%93%E6%9E%84"><span class="toc-number">1.5.1.</span> <span class="toc-text">文件记录的结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E8%AE%B0%E5%BD%95%E5%A4%B4%E7%9A%84%E7%BB%93%E6%9E%84"><span class="toc-number">1.5.2.</span> <span class="toc-text">文件记录头的结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E8%AE%B0%E5%BD%95%E4%B8%AD%E5%B1%9E%E6%80%A7%E7%9A%84%E7%BB%93%E6%9E%84"><span class="toc-number">1.5.3.</span> <span class="toc-text">文件记录中属性的结构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.5.3.1.</span> <span class="toc-text">属性的类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E7%9A%84%E5%B1%9E%E6%80%A7%E5%A4%B4"><span class="toc-number">1.5.3.2.</span> <span class="toc-text">属性的属性头</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%B8%B8%E9%A9%BB%E6%B2%A1%E6%9C%89%E5%B1%9E%E6%80%A7%E5%90%8D%E7%9A%84%E5%B1%9E%E6%80%A7%E5%A4%B4%E7%BB%93%E6%9E%84"><span class="toc-number">1.5.3.2.1.</span> <span class="toc-text">1.常驻没有属性名的属性头结构</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%B8%B8%E9%A9%BB%E6%9C%89%E5%B1%9E%E6%80%A7%E5%90%8D%E7%9A%84%E5%B1%9E%E6%80%A7%E5%A4%B4%E7%BB%93%E6%9E%84"><span class="toc-number">1.5.3.2.2.</span> <span class="toc-text">2.常驻有属性名的属性头结构</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E9%9D%9E%E5%B8%B8%E9%A9%BB%E6%B2%A1%E6%9C%89%E5%B1%9E%E6%80%A7%E5%90%8D%E7%9A%84%E5%B1%9E%E6%80%A7%E5%A4%B4%E7%BB%93%E6%9E%84"><span class="toc-number">1.5.3.2.3.</span> <span class="toc-text">3.非常驻没有属性名的属性头结构</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E9%9D%9E%E5%B8%B8%E9%A9%BB%E6%9C%89%E5%B1%9E%E6%80%A7%E5%90%8D%E7%9A%84%E5%B1%9E%E6%80%A7%E5%A4%B4%E7%BB%93%E6%9E%84"><span class="toc-number">1.5.3.2.4.</span> <span class="toc-text">4.非常驻有属性名的属性头结构</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10H%EF%BC%88-STANDARD-INFORMATION%EF%BC%89%E5%B1%9E%E6%80%A7%E5%88%86%E6%9E%90"><span class="toc-number">1.6.</span> <span class="toc-text">10H（$STANDARD_INFORMATION）属性分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E"><span class="toc-number">1.6.1.</span> <span class="toc-text">说明</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#20H%EF%BC%88-ATTRIBUTE-LIST%EF%BC%89%E5%B1%9E%E6%80%A7%E5%88%86%E6%9E%90"><span class="toc-number">1.7.</span> <span class="toc-text">20H（$ATTRIBUTE_LIST）属性分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#30H%EF%BC%88-FILE-NAME%EF%BC%89%E5%B1%9E%E6%80%A7%E5%88%86%E6%9E%90"><span class="toc-number">1.8.</span> <span class="toc-text">30H（$FILE_NAME）属性分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#30H%E5%B1%9E%E6%80%A7%E7%9A%84%E6%96%87%E4%BB%B6%E6%A0%87%E5%BF%97%E5%90%AB%E4%B9%89"><span class="toc-number">1.8.1.</span> <span class="toc-text">30H属性的文件标志含义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#30H%E5%B1%9E%E6%80%A7%E7%9A%84%E6%96%87%E4%BB%B6%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4"><span class="toc-number">1.8.2.</span> <span class="toc-text">30H属性的文件命名空间</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#40H%EF%BC%88-OBJECT-ID%EF%BC%89%E5%B1%9E%E6%80%A7%E5%88%86%E6%9E%90"><span class="toc-number">1.9.</span> <span class="toc-text">40H（$OBJECT_ID）属性分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#50H%EF%BC%88-SECURITY-DESCRIPTOR%EF%BC%89%E5%B1%9E%E6%80%A7%E5%88%86%E6%9E%90"><span class="toc-number">1.10.</span> <span class="toc-text">50H（$SECURITY_DESCRIPTOR）属性分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#50H%E5%B1%9E%E6%80%A7%E4%B8%AD%E5%B1%9E%E6%80%A7%E5%A4%B4%E7%9A%84%E7%BB%93%E6%9E%84"><span class="toc-number">1.10.1.</span> <span class="toc-text">50H属性中属性头的结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#50H%E5%B1%9E%E6%80%A7%E4%B8%ADACL%E7%9A%84%E7%BB%93%E6%9E%84"><span class="toc-number">1.10.2.</span> <span class="toc-text">50H属性中ACL的结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#50H%E5%B1%9E%E6%80%A7%E4%B8%ADACE%E7%9A%84%E7%BB%93%E6%9E%84"><span class="toc-number">1.10.3.</span> <span class="toc-text">50H属性中ACE的结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#50H%E5%B1%9E%E6%80%A7%E4%B8%ADSID%E7%9A%84%E7%BB%93%E6%9E%84"><span class="toc-number">1.10.4.</span> <span class="toc-text">50H属性中SID的结构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#60H%EF%BC%88-VOLUME-NAME%EF%BC%89%E5%B1%9E%E6%80%A7%E5%88%86%E6%9E%90"><span class="toc-number">1.11.</span> <span class="toc-text">60H（$VOLUME_NAME）属性分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#60H%E7%B1%BB%E5%9E%8B%E5%B1%9E%E6%80%A7%E6%8F%8F%E8%BF%B0"><span class="toc-number">1.11.1.</span> <span class="toc-text">60H类型属性描述</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#70H%EF%BC%88-VOLUME-INFORMATION%EF%BC%89%E5%B1%9E%E6%80%A7%E5%88%86%E6%9E%90"><span class="toc-number">1.12.</span> <span class="toc-text">70H（$VOLUME_INFORMATION）属性分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#70H%E7%B1%BB%E5%9E%8B%E5%B1%9E%E6%80%A7%E6%8F%8F%E8%BF%B0"><span class="toc-number">1.12.1.</span> <span class="toc-text">70H类型属性描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#70H%E5%B1%9E%E6%80%A7%E6%A0%87%E5%BF%97%E7%9A%84%E5%90%AB%E4%B9%89"><span class="toc-number">1.12.2.</span> <span class="toc-text">70H属性标志的含义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#70H%E5%B1%9E%E6%80%A7%E7%9A%84%E7%89%88%E6%9C%AC%E5%8F%B7"><span class="toc-number">1.12.3.</span> <span class="toc-text">70H属性的版本号</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#80H%EF%BC%88-DATA%EF%BC%89%E5%B1%9E%E6%80%A7%E5%88%86%E6%9E%90"><span class="toc-number">1.13.</span> <span class="toc-text">80H（$DATA）属性分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E9%A9%BB80H%E7%B1%BB%E5%9E%8B%E5%B1%9E%E6%80%A7%E7%BB%93%E6%9E%84"><span class="toc-number">1.13.1.</span> <span class="toc-text">常驻80H类型属性结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%9E%E5%B8%B8%E9%A9%BB80H%E5%B1%9E%E6%80%A7%E7%BB%93%E6%9E%84"><span class="toc-number">1.13.2.</span> <span class="toc-text">非常驻80H属性结构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%AA%E5%91%BD%E5%90%8D%E6%95%B0%E6%8D%AE%E6%B5%81"><span class="toc-number">1.13.2.1.</span> <span class="toc-text">未命名数据流</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%9A%84%E6%91%98%E8%A6%81%E4%BF%A1%E6%81%AF"><span class="toc-number">1.13.3.</span> <span class="toc-text">文件的摘要信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MountMgrDatabase-Data-Stream"><span class="toc-number">1.13.4.</span> <span class="toc-text">$MountMgrDatabase Data Stream</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bad"><span class="toc-number">1.13.5.</span> <span class="toc-text">$Bad</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SDS"><span class="toc-number">1.13.6.</span> <span class="toc-text">$SDS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#J%E3%80%81-Max"><span class="toc-number">1.13.7.</span> <span class="toc-text">$J、$Max</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#90H%EF%BC%88-INDEX-ROOT%EF%BC%89%E5%B1%9E%E6%80%A7%E5%88%86%E6%9E%90"><span class="toc-number">1.14.</span> <span class="toc-text">90H（$INDEX_ROOT）属性分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E6%A0%B9"><span class="toc-number">1.14.1.</span> <span class="toc-text">索引根</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E5%A4%B4"><span class="toc-number">1.14.2.</span> <span class="toc-text">索引头</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E9%A1%B9"><span class="toc-number">1.14.3.</span> <span class="toc-text">索引项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#A0H%EF%BC%88NDEX-ALLOCATION%EF%BC%89%E5%B1%9E%E6%80%A7%E5%88%86%E6%9E%90"><span class="toc-number">1.15.</span> <span class="toc-text">A0H（NDEX_ALLOCATION）属性分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#B0H%EF%BC%88-BITMAP%EF%BC%89%E5%B1%9E%E6%80%A7%E5%88%86%E6%9E%90"><span class="toc-number">1.16.</span> <span class="toc-text">B0H（$BITMAP）属性分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#C0H%EF%BC%88-REPARSE-POINT%EF%BC%89%E5%B1%9E%E6%80%A7%E5%88%86%E6%9E%90"><span class="toc-number">1.17.</span> <span class="toc-text">C0H（$REPARSE_POINT）属性分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#D0H%EF%BC%88-EA-INFORMATION%EF%BC%89%E5%B1%9E%E6%80%A7%E5%88%86%E6%9E%90"><span class="toc-number">1.18.</span> <span class="toc-text">D0H（$EA_INFORMATION）属性分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#E0H%EF%BC%88-EA%EF%BC%89%E5%B1%9E%E6%80%A7%E5%88%86%E6%9E%90"><span class="toc-number">1.19.</span> <span class="toc-text">E0H（$EA）属性分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#100H%EF%BC%88-LOGGED-UTILITY-STREAM%EF%BC%89%E5%B1%9E%E6%80%A7%E5%88%86%E6%9E%90"><span class="toc-number">1.20.</span> <span class="toc-text">100H（$LOGGED_UTILITY_STREAM）属性分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%83%E6%96%87%E4%BB%B6-MFTMirr%E5%88%86%E6%9E%90"><span class="toc-number">1.21.</span> <span class="toc-text">元文件$MFTMirr分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10H%E5%B1%9E%E6%80%A7"><span class="toc-number">1.21.1.</span> <span class="toc-text">10H属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#30H%E5%B1%9E%E6%80%A7"><span class="toc-number">1.21.2.</span> <span class="toc-text">30H属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#80H%E5%B1%9E%E6%80%A7"><span class="toc-number">1.21.3.</span> <span class="toc-text">80H属性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%83%E6%96%87%E4%BB%B6-LogFile%E5%88%86%E6%9E%90"><span class="toc-number">1.22.</span> <span class="toc-text">元文件$LogFile分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.22.1.</span> <span class="toc-text">日志文件服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.22.2.</span> <span class="toc-text">日志记录类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E8%AE%B0%E5%BD%95"><span class="toc-number">1.22.3.</span> <span class="toc-text">更新记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E7%82%B9%E8%AE%B0%E5%BD%95"><span class="toc-number">1.22.4.</span> <span class="toc-text">检查点记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E6%81%A2%E5%A4%8D%E6%80%A7%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.22.5.</span> <span class="toc-text">可恢复性实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E6%9E%90%E6%89%AB%E6%8F%8F%EF%BC%88Analysis-Pass%EF%BC%89"><span class="toc-number">1.22.6.</span> <span class="toc-text">分析扫描（Analysis Pass）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%81%9A%E6%89%AB%E6%8F%8F%EF%BC%88Redoing-Pass%EF%BC%89"><span class="toc-number">1.22.7.</span> <span class="toc-text">重做扫描（Redoing Pass）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%92%A4%E9%94%80%E6%89%AB%E6%8F%8F%EF%BC%88Undoing-Pass%EF%BC%89"><span class="toc-number">1.22.8.</span> <span class="toc-text">撤销扫描（Undoing Pass）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E7%9A%84%E6%96%87%E4%BB%B6%E8%AE%B0%E5%BD%95"><span class="toc-number">1.22.9.</span> <span class="toc-text">日志文件的文件记录</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10H%E5%B1%9E%E6%80%A7-1"><span class="toc-number">1.22.9.1.</span> <span class="toc-text">10H属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#30H%E5%B1%9E%E6%80%A7-1"><span class="toc-number">1.22.9.2.</span> <span class="toc-text">30H属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#80H%E5%B1%9E%E6%80%A7-1"><span class="toc-number">1.22.9.3.</span> <span class="toc-text">80H属性</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E7%9A%84%E6%95%B0%E6%8D%AE%E6%B5%81"><span class="toc-number">1.22.10.</span> <span class="toc-text">日志文件的数据流</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NTFS%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4%E5%90%8E%E7%9A%84%E5%BA%95%E5%B1%82%E5%88%86%E6%9E%90"><span class="toc-number">1.23.</span> <span class="toc-text">NTFS文件删除后的底层分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%90%8E%E7%9A%84%E6%81%A2%E5%A4%8D"><span class="toc-number">1.23.1.</span> <span class="toc-text">删除后的恢复</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NTFS%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%A0%BC%E5%BC%8F%E5%8C%96%E7%9A%84%E5%88%86%E6%9E%90"><span class="toc-number">1.24.</span> <span class="toc-text">NTFS文件系统格式化的分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%BC%E5%BC%8F%E5%8C%96%E7%9A%84%E5%BA%95%E5%B1%82%E5%88%86%E6%9E%90"><span class="toc-number">1.24.1.</span> <span class="toc-text">格式化的底层分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NTFS%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9FDBR%E6%89%8B%E5%B7%A5%E9%87%8D%E5%BB%BA"><span class="toc-number">1.25.</span> <span class="toc-text">NTFS文件系统DBR手工重建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B7%E4%BD%93%E6%93%8D%E4%BD%9C"><span class="toc-number">1.25.1.</span> <span class="toc-text">具体操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC1%E6%AD%A5-%E5%A4%8D%E5%88%B6%E5%90%8C%E7%89%88%E6%9C%AC%E7%9A%84DBR"><span class="toc-number">1.25.1.1.</span> <span class="toc-text">第1步　复制同版本的DBR</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC2%E6%AD%A5-%E8%AE%A1%E7%AE%97%E5%B9%B6%E4%BF%AE%E6%94%B9BPB%E5%8F%82%E6%95%B0"><span class="toc-number">1.25.1.2.</span> <span class="toc-text">第2步　计算并修改BPB参数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%9A%90%E8%97%8F%E6%89%87%E5%8C%BA%E6%95%B0"><span class="toc-number">1.25.1.2.1.</span> <span class="toc-text">隐藏扇区数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%89%87%E5%8C%BA%E6%80%BB%E6%95%B0"><span class="toc-number">1.25.1.2.2.</span> <span class="toc-text">2. 扇区总数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-MFT%E8%B5%B7%E5%A7%8B%E8%94%9F%E5%8F%B7"><span class="toc-number">1.25.1.2.3.</span> <span class="toc-text">3. $MFT起始蔟号</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E6%AF%8F%E7%B0%87%E6%89%87%E5%8C%BA%E6%95%B0"><span class="toc-number">1.25.1.2.4.</span> <span class="toc-text">4. 每簇扇区数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-%E6%96%87%E4%BB%B6%E8%AE%B0%E5%BD%95%E5%A4%A7%E5%B0%8F%E7%9A%84%E6%8F%8F%E8%BF%B0"><span class="toc-number">1.25.1.2.5.</span> <span class="toc-text">5. 文件记录大小的描述</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-%E7%B4%A2%E5%BC%95%E7%BC%93%E5%86%B2%E5%8C%BA%E7%9A%84%E5%A4%A7%E5%B0%8F%E6%8F%8F%E8%BF%B0"><span class="toc-number">1.25.1.2.6.</span> <span class="toc-text">6. 索引缓冲区的大小描述</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7-MFTMirr%E8%B5%B7%E5%A7%8B%E8%94%9F%E5%8F%B7"><span class="toc-number">1.25.1.2.7.</span> <span class="toc-text">7. $MFTMirr起始蔟号</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E4%BF%9D%E5%AD%98%E4%BF%AE%E6%94%B9%E7%9A%84BPB%E5%8F%82%E6%95%B0"><span class="toc-number">1.25.1.3.</span> <span class="toc-text">3.保存修改的BPB参数</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/05/05/Samba%E6%9C%8D%E5%8A%A1/" title="Samba服务"><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Ftm-image.tianyancha.com%2Ftm%2Fa188ff1bd3b4f8c29e7a3dfbf7fdd438.jpg&amp;refer=http%3A%2F%2Ftm-image.tianyancha.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1654651005&amp;t=1c060a820a8e2bdcc4588e82014995be" onerror="this.onerror=null;this.src='https://img0.baidu.com/it/u=1284263657,456284223&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=875&amp;h=500'" alt="Samba服务"/></a><div class="content"><a class="title" href="/2022/05/05/Samba%E6%9C%8D%E5%8A%A1/" title="Samba服务">Samba服务</a><time datetime="2022-05-05T02:34:32.000Z" title="发表于 2022-05-05 10:34:32">2022-05-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/27/Linux%E5%85%A5%E9%97%A8/" title="Linux入门"><img src="https://img2.baidu.com/it/u=2966175686,3062117491&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=640&amp;h=327" onerror="this.onerror=null;this.src='https://img0.baidu.com/it/u=1284263657,456284223&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=875&amp;h=500'" alt="Linux入门"/></a><div class="content"><a class="title" href="/2022/04/27/Linux%E5%85%A5%E9%97%A8/" title="Linux入门">Linux入门</a><time datetime="2022-04-27T11:30:41.000Z" title="发表于 2022-04-27 19:30:41">2022-04-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/26/FAT32%E7%B3%BB%E7%BB%9F/" title="FAT32系统"><img src="https://img0.baidu.com/it/u=1587130506,2748293553&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=500&amp;h=500" onerror="this.onerror=null;this.src='https://img0.baidu.com/it/u=1284263657,456284223&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=875&amp;h=500'" alt="FAT32系统"/></a><div class="content"><a class="title" href="/2022/04/26/FAT32%E7%B3%BB%E7%BB%9F/" title="FAT32系统">FAT32系统</a><time datetime="2022-04-26T11:38:48.000Z" title="发表于 2022-04-26 19:38:48">2022-04-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/26/NTFS%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" title="NTFS文件系统"><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fdingyue.ws.126.net%2FjMj41EmkgbPDElqsjRm3MQO40zxMIMYLV5nFaB2raLTvY1539634712768compressflag.jpg&amp;refer=http%3A%2F%2Fdingyue.ws.126.net&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1654651194&amp;t=ac0893148782493a12e7667b3be7325f" onerror="this.onerror=null;this.src='https://img0.baidu.com/it/u=1284263657,456284223&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=875&amp;h=500'" alt="NTFS文件系统"/></a><div class="content"><a class="title" href="/2022/04/26/NTFS%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" title="NTFS文件系统">NTFS文件系统</a><time datetime="2022-04-26T10:07:55.000Z" title="发表于 2022-04-26 18:07:55">2022-04-26</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 By Dragon</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">This is Dragon's Blog</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (true){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" data-mobile="false" data-text="I,LOVE,YOU" data-fontsize="15px" data-random="false" async="async"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"]):not([href="/music/"]):not([href="/no-pjax/"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>